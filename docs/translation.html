<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>21 Translating R code | Advanced R</title>
  <meta name="description" content="21 Translating R code | Advanced R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="21 Translating R code | Advanced R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="21 Translating R code | Advanced R" />
  
  
  

<meta name="author" content="Hadley Wickham" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="evaluation.html"/>
<link rel="next" href="techniques.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141212623-1');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a>
<ul>
<li class="chapter" data-level="2.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Missing values</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercion"><i class="fa fa-check"></i><b>3.2.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.2.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#durations"><i class="fa fa-check"></i><b>3.4.4</b> Durations</a></li>
<li class="chapter" data-level="3.4.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#subsetting-oob"><i class="fa fa-check"></i><b>4.3.3</b> Missing and out-of-bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samples-and-bootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples and bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character )</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-versus-sets-logical-and-integer"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra versus sets (logical and integer )</a></li>
<li class="chapter" data-level="4.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control flow</a>
<ul>
<li class="chapter" data-level="5.1" data-path="control-flow.html"><a href="control-flow.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-flow.html"><a href="control-flow.html#choices"><i class="fa fa-check"></i><b>5.2</b> Choices</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="control-flow.html"><a href="control-flow.html#invalid-inputs"><i class="fa fa-check"></i><b>5.2.1</b> Invalid inputs</a></li>
<li class="chapter" data-level="5.2.2" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i><b>5.2.2</b> Vectorised if</a></li>
<li class="chapter" data-level="5.2.3" data-path="control-flow.html"><a href="control-flow.html#switch"><i class="fa fa-check"></i><b>5.2.3</b> <code>switch()</code> statement</a></li>
<li class="chapter" data-level="5.2.4" data-path="control-flow.html"><a href="control-flow.html#exercises-12"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i><b>5.3.1</b> Common pitfalls</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-flow.html"><a href="control-flow.html#for-family"><i class="fa fa-check"></i><b>5.3.2</b> Related tools</a></li>
<li class="chapter" data-level="5.3.3" data-path="control-flow.html"><a href="control-flow.html#exercises-13"><i class="fa fa-check"></i><b>5.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-flow.html"><a href="control-flow.html#control-flow-answers"><i class="fa fa-check"></i><b>5.4</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#fun-components"><i class="fa fa-check"></i><b>6.2.1</b> Function components</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.2</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.3</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.2.4</b> Invoking a function</a></li>
<li class="chapter" data-level="6.2.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>6.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>6.3</b> Function composition</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.4</b> Lexical scoping</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.4.1</b> Name masking</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#functions-versus-variables"><i class="fa fa-check"></i><b>6.4.2</b> Functions versus variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.4.5" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.5</b> Lazy evaluation</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.5.1</b> Promises</a></li>
<li class="chapter" data-level="6.5.2" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.5.2</b> Default arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.5.3</b> Missing arguments</a></li>
<li class="chapter" data-level="6.5.4" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>6.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>6.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.7</b> Exiting a function</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#implicit-versus-explicit-returns"><i class="fa fa-check"></i><b>6.7.1</b> Implicit versus explicit returns</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#invisible"><i class="fa fa-check"></i><b>6.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.7.3</b> Errors</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.7.5" data-path="functions.html"><a href="functions.html#exercises-18"><i class="fa fa-check"></i><b>6.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.8</b> Function forms</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#prefix-transform"><i class="fa fa-check"></i><b>6.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>6.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="6.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.8.5</b> Special forms</a></li>
<li class="chapter" data-level="6.8.6" data-path="functions.html"><a href="functions.html#exercises-19"><i class="fa fa-check"></i><b>6.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a>
<ul>
<li class="chapter" data-level="7.1" data-path="environments.html"><a href="environments.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#super-assignment--"><i class="fa fa-check"></i><b>7.2.4</b> Super assignment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>7.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#iteration-versus-recursion"><i class="fa fa-check"></i>Iteration versus recursion</a></li>
<li class="chapter" data-level="7.3.1" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#special-environments"><i class="fa fa-check"></i><b>7.4</b> Special environments</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="environments.html"><a href="environments.html#exercises-22"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>7.5</b> Call stacks</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-stack"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-call-stack"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="environments.html"><a href="environments.html#exercises-23"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditions.html"><a href="conditions.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-6"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="8.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="conditions.html"><a href="conditions.html#exercises-26"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="conditions.html"><a href="conditions.html#exercises-27"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a>
<ul>
<li class="chapter" data-level="9.1" data-path="functionals.html"><a href="functionals.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#map-atomic"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#purrr-shortcuts"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#map-variants"><i class="fa fa-check"></i><b>9.4</b> Map variants</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce family</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="functionals.html"><a href="functionals.html#basics-1"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#base-functionals"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#mathematical-concerns"><i class="fa fa-check"></i><b>9.7.2</b> Mathematical concerns</a></li>
<li class="chapter" data-level="9.7.3" data-path="functionals.html"><a href="functionals.html#exercises-31"><i class="fa fa-check"></i><b>9.7.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a>
<ul>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i><b>10.2.3</b> Forcing evaluation</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.4</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.5</b> Garbage collection</a></li>
<li class="chapter" data-level="10.2.6" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> <code>ggsave()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-34"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="function-factories.html"><a href="function-factories.html#exercises-35"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a>
<ul>
<li class="chapter" data-level="11.1" data-path="function-operators.html"><a href="function-operators.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing function operators</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="function-operators.html"><a href="function-operators.html#exercises-36"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: Creating your own function operators</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="function-operators.html"><a href="function-operators.html#exercises-37"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object-oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a>
<ul>
<li class="chapter" data-level="12.1" data-path="base-types.html"><a href="base-types.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base versus OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a>
<ul>
<li class="chapter" data-level="13.1" data-path="s3.html"><a href="s3.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="s3.html"><a href="s3.html#exercises-38"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constructor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="s3.html"><a href="s3.html#exercises-42"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="s3.html"><a href="s3.html#exercises-43"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a>
<ul>
<li class="chapter" data-level="14.1" data-path="r6.html"><a href="r6.html#introduction-13"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#r6-important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="r6.html"><a href="r6.html#exercises-44"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="r6.html"><a href="r6.html#exercises-45"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="r6.html"><a href="r6.html#exercises-46"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a>
<ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-14"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#inheritance-1"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.2</b> Introspection</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.3</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.4</b> Helper</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.5</b> Validator</a></li>
<li class="chapter" data-level="15.3.6" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#exercises-49"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="s4.html"><a href="s4.html#exercises-50"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="s4.html"><a href="s4.html#exercises-51"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a>
<ul>
<li class="chapter" data-level="16.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-15"><i class="fa fa-check"></i><b>16.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 versus S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 versus S3</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="metaprogramming.html"><a href="metaprogramming.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="17" data-path="meta-big-picture.html"><a href="meta-big-picture.html"><i class="fa fa-check"></i><b>17</b> Big picture</a>
<ul>
<li class="chapter" data-level="17.1" data-path="meta-big-picture.html"><a href="meta-big-picture.html#introduction-16"><i class="fa fa-check"></i><b>17.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-data"><i class="fa fa-check"></i><b>17.2</b> Code is data</a></li>
<li class="chapter" data-level="17.3" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-tree"><i class="fa fa-check"></i><b>17.3</b> Code is a tree</a></li>
<li class="chapter" data-level="17.4" data-path="meta-big-picture.html"><a href="meta-big-picture.html#coding-code"><i class="fa fa-check"></i><b>17.4</b> Code can generate code</a></li>
<li class="chapter" data-level="17.5" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-intro"><i class="fa fa-check"></i><b>17.5</b> Evaluation runs code</a></li>
<li class="chapter" data-level="17.6" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-funs"><i class="fa fa-check"></i><b>17.6</b> Customising evaluation with functions</a></li>
<li class="chapter" data-level="17.7" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-data"><i class="fa fa-check"></i><b>17.7</b> Customising evaluation with data</a></li>
<li class="chapter" data-level="17.8" data-path="meta-big-picture.html"><a href="meta-big-picture.html#quosure-intro"><i class="fa fa-check"></i><b>17.8</b> Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#introduction-17"><i class="fa fa-check"></i><b>18.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#ast"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#drawing"><i class="fa fa-check"></i><b>18.2.1</b> Drawing</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#non-code-components"><i class="fa fa-check"></i><b>18.2.2</b> Non-code components</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#infix-calls"><i class="fa fa-check"></i><b>18.2.3</b> Infix calls</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#expression-details"><i class="fa fa-check"></i><b>18.3</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.3.1</b> Constants</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.3.2</b> Symbols</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.3</b> Calls</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>18.3.4</b> Summary</a></li>
<li class="chapter" data-level="18.3.5" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>18.4</b> Parsing and grammar</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.4.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.4.2</b> Associativity</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#parsing"><i class="fa fa-check"></i><b>18.4.3</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="18.4.4" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>18.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Walking AST with recursive functions</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="expressions.html"><a href="expressions.html#exercises-55"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#expression-special"><i class="fa fa-check"></i><b>18.6</b> Specialised data structures</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.6.1</b> Pairlists</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#empty-symbol"><i class="fa fa-check"></i><b>18.6.2</b> Missing arguments</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#expression-vectors"><i class="fa fa-check"></i><b>18.6.3</b> Expression vectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a>
<ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-18"><i class="fa fa-check"></i><b>19.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#related-work"><i class="fa fa-check"></i>Related work</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-motivation"><i class="fa fa-check"></i><b>19.2</b> Motivation</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-56"><i class="fa fa-check"></i><b>19.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quoting"><i class="fa fa-check"></i><b>19.3</b> Quoting</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-expressions"><i class="fa fa-check"></i><b>19.3.1</b> Capturing expressions</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-symbols"><i class="fa fa-check"></i><b>19.3.2</b> Capturing symbols</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.3</b> With base R</a></li>
<li class="chapter" data-level="19.3.4" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i><b>19.3.4</b> Substitution</a></li>
<li class="chapter" data-level="19.3.5" data-path="quasiquotation.html"><a href="quasiquotation.html#summary-1"><i class="fa fa-check"></i><b>19.3.5</b> Summary</a></li>
<li class="chapter" data-level="19.3.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting"><i class="fa fa-check"></i><b>19.4</b> Unquoting</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-one-argument"><i class="fa fa-check"></i><b>19.4.1</b> Unquoting one argument</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-a-function"><i class="fa fa-check"></i><b>19.4.2</b> Unquoting a function</a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-missing"><i class="fa fa-check"></i><b>19.4.3</b> Unquoting a missing argument</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-in-special-forms"><i class="fa fa-check"></i><b>19.4.4</b> Unquoting in special forms</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-many-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Unquoting many arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.6</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.7" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-ast"><i class="fa fa-check"></i><b>19.4.7</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.8" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>19.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#base-nonquote"><i class="fa fa-check"></i><b>19.5</b> Non-quoting</a></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#tidy-dots"><i class="fa fa-check"></i><b>19.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#examples"><i class="fa fa-check"></i><b>19.6.1</b> Examples</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exec"><i class="fa fa-check"></i><b>19.6.2</b> <code>exec()</code></a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#do-call"><i class="fa fa-check"></i><b>19.6.4</b> With base R</a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#expr-case-studies"><i class="fa fa-check"></i><b>19.7</b> Case studies</a>
<ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#lobstrast"><i class="fa fa-check"></i><b>19.7.1</b> <code>lobstr::ast()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.7.2</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.7.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#new-function"><i class="fa fa-check"></i><b>19.7.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-60"><i class="fa fa-check"></i><b>19.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="quasiquotation.html"><a href="quasiquotation.html#history"><i class="fa fa-check"></i><b>19.8</b> History</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a>
<ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-19"><i class="fa fa-check"></i><b>20.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-13"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#exercises-61"><i class="fa fa-check"></i><b>20.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#creating"><i class="fa fa-check"></i><b>20.3.1</b> Creating</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.2</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#quosure-dots"><i class="fa fa-check"></i><b>20.3.3</b> Dots</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#quosure-impl"><i class="fa fa-check"></i><b>20.3.4</b> Under the hood</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#nested-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Nested quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4</b> Data masks</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#basics-3"><i class="fa fa-check"></i><b>20.4.1</b> Basics</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#pronouns"><i class="fa fa-check"></i><b>20.4.2</b> Pronouns</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-transform"><i class="fa fa-check"></i><b>20.4.4</b> Application: transform</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#select"><i class="fa fa-check"></i><b>20.4.5</b> Application: <code>select()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.5</b> Using tidy evaluation</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#quoting-and-unquoting"><i class="fa fa-check"></i><b>20.5.1</b> Quoting and unquoting</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i><b>20.5.2</b> Handling ambiguity</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#quoting-and-ambiguity"><i class="fa fa-check"></i><b>20.5.3</b> Quoting and ambiguity</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#exercises-64"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluation.html"><a href="evaluation.html#base-evaluation"><i class="fa fa-check"></i><b>20.6</b> Base evaluation</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i><b>20.6.1</b> <code>substitute()</code></a></li>
<li class="chapter" data-level="20.6.2" data-path="evaluation.html"><a href="evaluation.html#match.call"><i class="fa fa-check"></i><b>20.6.2</b> <code>match.call()</code></a></li>
<li class="chapter" data-level="20.6.3" data-path="evaluation.html"><a href="evaluation.html#exercises-65"><i class="fa fa-check"></i><b>20.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a>
<ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#introduction-20"><i class="fa fa-check"></i><b>21.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prerequisites-14"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#html-env"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#exercises-66"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code>()</a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="translation.html"><a href="translation.html#exercises-67"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="" data-path="techniques.html"><a href="techniques.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a>
<ul>
<li class="chapter" data-level="22.1" data-path="debugging.html"><a href="debugging.html#introduction-21"><i class="fa fa-check"></i><b>22.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-20"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-strategy"><i class="fa fa-check"></i><b>22.2</b> Overall approach</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>22.3</b> Locating errors</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#debug-lazy"><i class="fa fa-check"></i><b>22.3.1</b> Lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="debugging.html"><a href="debugging.html#browser"><i class="fa fa-check"></i><b>22.4</b> Interactive debugger</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="debugging.html"><a href="debugging.html#browser-commands"><i class="fa fa-check"></i><b>22.4.1</b> <code>browser()</code> commands</a></li>
<li class="chapter" data-level="22.4.2" data-path="debugging.html"><a href="debugging.html#alternatives"><i class="fa fa-check"></i><b>22.4.2</b> Alternatives</a></li>
<li class="chapter" data-level="22.4.3" data-path="debugging.html"><a href="debugging.html#debug-compiled"><i class="fa fa-check"></i><b>22.4.3</b> Compiled code</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="debugging.html"><a href="debugging.html#non-interactive-debugging"><i class="fa fa-check"></i><b>22.5</b> Non-interactive debugging</a>
<ul>
<li class="chapter" data-level="22.5.1" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>22.5.1</b> <code>dump.frames()</code></a></li>
<li class="chapter" data-level="22.5.2" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>22.5.2</b> Print debugging</a></li>
<li class="chapter" data-level="22.5.3" data-path="debugging.html"><a href="debugging.html#rmarkdown"><i class="fa fa-check"></i><b>22.5.3</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="debugging.html"><a href="debugging.html#non-error-failures"><i class="fa fa-check"></i><b>22.6</b> Non-error failures</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="perf-measure.html"><a href="perf-measure.html"><i class="fa fa-check"></i><b>23</b> Measuring performance</a>
<ul>
<li class="chapter" data-level="23.1" data-path="perf-measure.html"><a href="perf-measure.html#introduction-22"><i class="fa fa-check"></i><b>23.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#outline-21"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#prerequisites-15"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="perf-measure.html"><a href="perf-measure.html#profiling"><i class="fa fa-check"></i><b>23.2</b> Profiling</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="perf-measure.html"><a href="perf-measure.html#visualising-profiles"><i class="fa fa-check"></i><b>23.2.1</b> Visualising profiles</a></li>
<li class="chapter" data-level="23.2.2" data-path="perf-measure.html"><a href="perf-measure.html#memory-profiling"><i class="fa fa-check"></i><b>23.2.2</b> Memory profiling</a></li>
<li class="chapter" data-level="23.2.3" data-path="perf-measure.html"><a href="perf-measure.html#limitations"><i class="fa fa-check"></i><b>23.2.3</b> Limitations</a></li>
<li class="chapter" data-level="23.2.4" data-path="perf-measure.html"><a href="perf-measure.html#exercises-68"><i class="fa fa-check"></i><b>23.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="perf-measure.html"><a href="perf-measure.html#microbenchmarking"><i class="fa fa-check"></i><b>23.3</b> Microbenchmarking</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="perf-measure.html"><a href="perf-measure.html#benchmark-results"><i class="fa fa-check"></i><b>23.3.1</b> <code>bench::mark()</code> results</a></li>
<li class="chapter" data-level="23.3.2" data-path="perf-measure.html"><a href="perf-measure.html#interpreting-results"><i class="fa fa-check"></i><b>23.3.2</b> Interpreting results</a></li>
<li class="chapter" data-level="23.3.3" data-path="perf-measure.html"><a href="perf-measure.html#exercises-69"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="perf-improve.html"><a href="perf-improve.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a>
<ul>
<li class="chapter" data-level="24.1" data-path="perf-improve.html"><a href="perf-improve.html#introduction-23"><i class="fa fa-check"></i><b>24.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#outline-22"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#prerequisites-16"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="perf-improve.html"><a href="perf-improve.html#code-organisation"><i class="fa fa-check"></i><b>24.2</b> Code organisation</a></li>
<li class="chapter" data-level="24.3" data-path="perf-improve.html"><a href="perf-improve.html#already-solved"><i class="fa fa-check"></i><b>24.3</b> Checking for existing solutions</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-70"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="perf-improve.html"><a href="perf-improve.html#be-lazy"><i class="fa fa-check"></i><b>24.4</b> Doing as little as possible</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="perf-improve.html"><a href="perf-improve.html#mean"><i class="fa fa-check"></i><b>24.4.1</b> <code>mean()</code></a></li>
<li class="chapter" data-level="24.4.2" data-path="perf-improve.html"><a href="perf-improve.html#as.data.frame"><i class="fa fa-check"></i><b>24.4.2</b> <code>as.data.frame()</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="perf-improve.html"><a href="perf-improve.html#exercises-71"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="perf-improve.html"><a href="perf-improve.html#vectorise"><i class="fa fa-check"></i><b>24.5</b> Vectorise</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-72"><i class="fa fa-check"></i><b>24.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="perf-improve.html"><a href="perf-improve.html#avoid-copies"><i class="fa fa-check"></i><b>24.6</b> Avoiding copies</a></li>
<li class="chapter" data-level="24.7" data-path="perf-improve.html"><a href="perf-improve.html#t-test"><i class="fa fa-check"></i><b>24.7</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.8" data-path="perf-improve.html"><a href="perf-improve.html#more-techniques"><i class="fa fa-check"></i><b>24.8</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rcpp.html"><a href="rcpp.html#introduction-24"><i class="fa fa-check"></i><b>25.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-23"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequisites-17"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.5</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#exercise-started"><i class="fa fa-check"></i><b>25.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Other classes</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="rcpp.html"><a href="rcpp.html#attributes-1"><i class="fa fa-check"></i><b>25.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-73"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.5</b> Standard Template Library</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.5.3</b> Data structures</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.5.4</b> Vectors</a></li>
<li class="chapter" data-level="25.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.5.5</b> Sets</a></li>
<li class="chapter" data-level="25.5.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>25.5.6</b> Map</a></li>
<li class="chapter" data-level="25.5.7" data-path="rcpp.html"><a href="rcpp.html#exercises-74"><i class="fa fa-check"></i><b>25.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.6</b> Case studies</a>
<ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-versus-c-vectorisation"><i class="fa fa-check"></i><b>25.6.2</b> R vectorisation versus C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.8</b> Learning more</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.9</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="translation" class="section level1" number="21">
<h1><span class="header-section-number">21</span> Translating R code</h1>
<div id="introduction-20" class="section level2" number="21.1">
<h2><span class="header-section-number">21.1</span> Introduction</h2>
<p>The combination of first-class environments, lexical scoping, and metaprogramming gives us a powerful toolkit for translating R code into other languages. One fully-fledged example of this idea is dbplyr, which powers the database backends for dplyr, allowing you to express data manipulation in R and automatically translate it into SQL. You can see the key idea in <code>translate_sql()</code> which takes R code and returns the equivalent SQL:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="translation.html#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb919-2"><a href="translation.html#cb919-2" aria-hidden="true" tabindex="-1"></a><span class="fu">translate_sql</span>(x <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb919-3"><a href="translation.html#cb919-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;SQL&gt; POWER(`x`, 2.0)</span></span>
<span id="cb919-4"><a href="translation.html#cb919-4" aria-hidden="true" tabindex="-1"></a><span class="fu">translate_sql</span>(x <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x))</span>
<span id="cb919-5"><a href="translation.html#cb919-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;SQL&gt; `x` &lt; 5.0 AND NOT(((`x`) IS NULL))</span></span>
<span id="cb919-6"><a href="translation.html#cb919-6" aria-hidden="true" tabindex="-1"></a><span class="fu">translate_sql</span>(<span class="sc">!</span>first <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Roger&quot;</span>, <span class="st">&quot;Robert&quot;</span>))</span>
<span id="cb919-7"><a href="translation.html#cb919-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;SQL&gt; NOT(`first` IN (&#39;John&#39;, &#39;Roger&#39;, &#39;Robert&#39;))</span></span>
<span id="cb919-8"><a href="translation.html#cb919-8" aria-hidden="true" tabindex="-1"></a><span class="fu">translate_sql</span>(select <span class="sc">==</span> <span class="dv">7</span>)</span>
<span id="cb919-9"><a href="translation.html#cb919-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;SQL&gt; `select` = 7.0</span></span></code></pre></div>
<p>Translating R to SQL is complex because of the many idiosyncrasies of SQL dialects, so here Ill develop two simple, but useful, domain specific languages (DSL): one to generate HTML, and the other to generate mathematical equations in LaTeX.</p>
<p>If youre interested in learning more about domain specific languages in general, I highly recommend <em>Domain Specific Languages</em>.<span class="citation"><a href="#fn106" class="footnote-ref" id="fnref106"><sup>106</sup></a></span> It discusses many options for creating a DSL and provides many examples of different languages.</p>
<div id="outline-19" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="translation.html#html">21.2</a> creates a DSL for generating HTML, using quasiquotation
and purrr to generate a function for each HTML tag, then tidy evaluation to
easily access them.</p></li>
<li><p>Section <a href="translation.html#latex">21.3</a> transforms mathematically R code into its LaTeX
equivalent using a combination of tidy evaluation and expression walking.</p></li>
</ul>
</div>
<div id="prerequisites-14" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>This chapter pulls together many techniques discussed elsewhere in the book. In particular, youll need to understand environments, expressions, tidy evaluation, and a little functional programming and S3. Well use <a href="https://rlang.r-lib.org">rlang</a> for metaprogramming tools, and <a href="https://purrr.tidyverse.org">purrr</a> for functional programming.</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="translation.html#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb920-2"><a href="translation.html#cb920-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
</div>
</div>
<div id="html" class="section level2" number="21.2">
<h2><span class="header-section-number">21.2</span> HTML</h2>
<p></p>
<p>HTML (HyperText Markup Language) underlies the majority of the web. Its a special case of SGML (Standard Generalised Markup Language), and its similar but not identical to XML (eXtensible Markup Language). HTML looks like this:</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb921-1"><a href="translation.html#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb921-2"><a href="translation.html#cb921-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;h1</span><span class="ot"> id=</span><span class="st">&#39;first&#39;</span><span class="kw">&gt;</span>A heading<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb921-3"><a href="translation.html#cb921-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;p&gt;</span>Some text <span class="dv">&amp;amp;</span> <span class="kw">&lt;b&gt;</span>some bold text.<span class="kw">&lt;/b&gt;&lt;/p&gt;</span></span>
<span id="cb921-4"><a href="translation.html#cb921-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;img</span><span class="ot"> src=</span><span class="st">&#39;myimg.png&#39;</span><span class="ot"> width=</span><span class="st">&#39;100&#39;</span><span class="ot"> height=</span><span class="st">&#39;100&#39;</span> <span class="kw">/&gt;</span></span>
<span id="cb921-5"><a href="translation.html#cb921-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span></code></pre></div>
<p>Even if youve never looked at HTML before, you can still see that the key component of its coding structure is tags, which look like <code>&lt;tag&gt;&lt;/tag&gt;</code> or <code>&lt;tag /&gt;</code>. Tags can be nested within other tags and intermingled with text. There are over 100 HTML tags, but in this chapter well focus on just a handful:</p>
<ul>
<li><code>&lt;body&gt;</code> is the top-level tag that contains all content.</li>
<li><code>&lt;h1&gt;</code> defines a top level heading.</li>
<li><code>&lt;p&gt;</code> defines a paragraph.</li>
<li><code>&lt;b&gt;</code> emboldens text.</li>
<li><code>&lt;img&gt;</code> embeds an image.</li>
</ul>
<p>Tags can have named <strong>attributes</strong> which look like <code>&lt;tag name1='value1' name2='value2'&gt;&lt;/tag&gt;</code>. Two of the most important attributes are <code>id</code> and <code>class</code>, which are used in conjunction with CSS (Cascading Style Sheets) to control the visual appearance of the page.</p>
<p><strong>Void tags</strong>, like <code>&lt;img&gt;</code>, dont have any children, and are written <code>&lt;img /&gt;</code>, not <code>&lt;img&gt;&lt;/img&gt;</code>. Since they have no content, attributes are more important, and <code>img</code> has three that are used with almost every image: <code>src</code> (where the image lives), <code>width</code>, and <code>height</code>.</p>
<p>Because <code>&lt;</code> and <code>&gt;</code> have special meanings in HTML, you cant write them directly. Instead you have to use the HTML <strong>escapes</strong>: <code>&amp;gt;</code> and <code>&amp;lt;</code>. And since those escapes use <code>&amp;</code>, if you want a literal ampersand you have to escape it as <code>&amp;amp;</code>.</p>
<div id="goal" class="section level3" number="21.2.1">
<h3><span class="header-section-number">21.2.1</span> Goal</h3>
<p>Our goal is to make it easy to generate HTML from R. To give a concrete example, we want to generate the following HTML:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb922-1"><a href="translation.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb922-2"><a href="translation.html#cb922-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;h1</span><span class="ot"> id=</span><span class="st">&#39;first&#39;</span><span class="kw">&gt;</span>A heading<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb922-3"><a href="translation.html#cb922-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;p&gt;</span>Some text <span class="dv">&amp;amp;</span> <span class="kw">&lt;b&gt;</span>some bold text.<span class="kw">&lt;/b&gt;&lt;/p&gt;</span></span>
<span id="cb922-4"><a href="translation.html#cb922-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;img</span><span class="ot"> src=</span><span class="st">&#39;myimg.png&#39;</span><span class="ot"> width=</span><span class="st">&#39;100&#39;</span><span class="ot"> height=</span><span class="st">&#39;100&#39;</span> <span class="kw">/&gt;</span></span>
<span id="cb922-5"><a href="translation.html#cb922-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/body&gt;</span></span></code></pre></div>
<p>Using the following code that matches the structure of the HTML as closely as possible:</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="translation.html#cb923-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with_html</span>(</span>
<span id="cb923-2"><a href="translation.html#cb923-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body</span>(</span>
<span id="cb923-3"><a href="translation.html#cb923-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">&quot;A heading&quot;</span>, <span class="at">id =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb923-4"><a href="translation.html#cb923-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p</span>(<span class="st">&quot;Some text &amp;&quot;</span>, <span class="fu">b</span>(<span class="st">&quot;some bold text.&quot;</span>)),</span>
<span id="cb923-5"><a href="translation.html#cb923-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;myimg.png&quot;</span>, <span class="at">width =</span> <span class="dv">100</span>, <span class="at">height =</span> <span class="dv">100</span>)</span>
<span id="cb923-6"><a href="translation.html#cb923-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb923-7"><a href="translation.html#cb923-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This DSL has the following three properties:</p>
<ul>
<li><p>The nesting of function calls matches the nesting of tags.</p></li>
<li><p>Unnamed arguments become the content of the tag, and named arguments
become their attributes.</p></li>
<li><p><code>&amp;</code> and other special characters are automatically escaped.</p></li>
</ul>
</div>
<div id="escaping" class="section level3" number="21.2.2">
<h3><span class="header-section-number">21.2.2</span> Escaping</h3>
<p></p>
<p>Escaping is so fundamental to translation that itll be our first topic. There are two related challenges:</p>
<ul>
<li><p>In user input, we need to automatically escape <code>&amp;</code>, <code>&lt;</code> and <code>&gt;</code>.</p></li>
<li><p>At the same time we need to make sure that the <code>&amp;</code>, <code>&lt;</code> and <code>&gt;</code> we generate
are not double-escaped (i.e.that we dont accidentally generate <code>&amp;amp;amp;</code>, <code>&amp;amp;lt;</code> and <code>&amp;amp;gt;</code>).</p></li>
</ul>
<p>The easiest way to do this is to create an S3 class (Section <a href="s3.html#s3-classes">13.3</a>) that distinguishes between regular text (that needs escaping) and HTML (that doesnt).</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="translation.html#cb924-1" aria-hidden="true" tabindex="-1"></a>html <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">structure</span>(x, <span class="at">class =</span> <span class="st">&quot;advr_html&quot;</span>)</span>
<span id="cb924-2"><a href="translation.html#cb924-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb924-3"><a href="translation.html#cb924-3" aria-hidden="true" tabindex="-1"></a>print.advr_html <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb924-4"><a href="translation.html#cb924-4" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;&lt;HTML&gt; &quot;</span>, x)</span>
<span id="cb924-5"><a href="translation.html#cb924-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">strwrap</span>(out), <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb924-6"><a href="translation.html#cb924-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We then write an escape generic. It has two important methods:</p>
<ul>
<li><p><code>escape.character()</code> takes a regular character vector and returns an HTML
vector with special characters (<code>&amp;</code>, <code>&lt;</code>, <code>&gt;</code>) escaped.</p></li>
<li><p><code>escape.advr_html()</code> leaves already escaped HTML alone.</p></li>
</ul>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="translation.html#cb925-1" aria-hidden="true" tabindex="-1"></a>escape <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">UseMethod</span>(<span class="st">&quot;escape&quot;</span>)</span>
<span id="cb925-2"><a href="translation.html#cb925-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-3"><a href="translation.html#cb925-3" aria-hidden="true" tabindex="-1"></a>escape.character <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb925-4"><a href="translation.html#cb925-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;&amp;&quot;</span>, <span class="st">&quot;&amp;amp;&quot;</span>, x)</span>
<span id="cb925-5"><a href="translation.html#cb925-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;&lt;&quot;</span>, <span class="st">&quot;&amp;lt;&quot;</span>, x)</span>
<span id="cb925-6"><a href="translation.html#cb925-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;&gt;&quot;</span>, <span class="st">&quot;&amp;gt;&quot;</span>, x)</span>
<span id="cb925-7"><a href="translation.html#cb925-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-8"><a href="translation.html#cb925-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html</span>(x)</span>
<span id="cb925-9"><a href="translation.html#cb925-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb925-10"><a href="translation.html#cb925-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb925-11"><a href="translation.html#cb925-11" aria-hidden="true" tabindex="-1"></a>escape.advr_html <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x</span></code></pre></div>
<p>Now we check that it works</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="translation.html#cb926-1" aria-hidden="true" tabindex="-1"></a><span class="fu">escape</span>(<span class="st">&quot;This is some text.&quot;</span>)</span>
<span id="cb926-2"><a href="translation.html#cb926-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; This is some text.</span></span>
<span id="cb926-3"><a href="translation.html#cb926-3" aria-hidden="true" tabindex="-1"></a><span class="fu">escape</span>(<span class="st">&quot;x &gt; 1 &amp; y &lt; 2&quot;</span>)</span>
<span id="cb926-4"><a href="translation.html#cb926-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; x &amp;gt; 1 &amp;amp; y &amp;lt; 2</span></span>
<span id="cb926-5"><a href="translation.html#cb926-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-6"><a href="translation.html#cb926-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Double escaping is not a problem</span></span>
<span id="cb926-7"><a href="translation.html#cb926-7" aria-hidden="true" tabindex="-1"></a><span class="fu">escape</span>(<span class="fu">escape</span>(<span class="st">&quot;This is some text. 1 &gt; 2&quot;</span>))</span>
<span id="cb926-8"><a href="translation.html#cb926-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; This is some text. 1 &amp;gt; 2</span></span>
<span id="cb926-9"><a href="translation.html#cb926-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb926-10"><a href="translation.html#cb926-10" aria-hidden="true" tabindex="-1"></a><span class="co"># And text we know is HTML doesn&#39;t get escaped.</span></span>
<span id="cb926-11"><a href="translation.html#cb926-11" aria-hidden="true" tabindex="-1"></a><span class="fu">escape</span>(<span class="fu">html</span>(<span class="st">&quot;&lt;hr /&gt;&quot;</span>))</span>
<span id="cb926-12"><a href="translation.html#cb926-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;hr /&gt;</span></span></code></pre></div>
<p>Conveniently, this also allows a user to opt out of our escaping if they know the content is already escaped.</p>
</div>
<div id="basic-tag-functions" class="section level3" number="21.2.3">
<h3><span class="header-section-number">21.2.3</span> Basic tag functions</h3>
<p>Next, well write a one-tag function by hand, then figure out how to generalise it so we can generate a function for every tag with code.</p>
<p>Lets start with <code>&lt;p&gt;</code>. HTML tags can have both attributes (e.g., id or class) and children (like <code>&lt;b&gt;</code> or <code>&lt;i&gt;</code>). We need some way of separating these in the function call. Given that attributes are named and children are not, it seems natural to use named and unnamed arguments for them respectively. For example, a call to <code>p()</code> might look like:</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="translation.html#cb927-1" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">&quot;Some text. &quot;</span>, <span class="fu">b</span>(<span class="fu">i</span>(<span class="st">&quot;some bold italic text&quot;</span>)), <span class="at">class =</span> <span class="st">&quot;mypara&quot;</span>)</span></code></pre></div>
<p>We could list all the possible attributes of the <code>&lt;p&gt;</code> tag in the function definition, but thats hard because there are many attributes, and because its possible to use <a href="http://html5doctor.com/html5-custom-data-attributes/">custom attributes</a>. Instead, well use <code>...</code> and separate the components based on whether or not they are named. With this in mind, we create a helper function that wraps around <code>rlang::list2()</code> (Section <a href="quasiquotation.html#tidy-dots">19.6</a>) and returns named and unnamed components separately:</p>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb928-1"><a href="translation.html#cb928-1" aria-hidden="true" tabindex="-1"></a>dots_partition <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb928-2"><a href="translation.html#cb928-2" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">list2</span>(...)</span>
<span id="cb928-3"><a href="translation.html#cb928-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb928-4"><a href="translation.html#cb928-4" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">names</span>(dots))) {</span>
<span id="cb928-5"><a href="translation.html#cb928-5" aria-hidden="true" tabindex="-1"></a>  is_named <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="fu">length</span>(dots))</span>
<span id="cb928-6"><a href="translation.html#cb928-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb928-7"><a href="translation.html#cb928-7" aria-hidden="true" tabindex="-1"></a>  is_named <span class="ot">&lt;-</span> <span class="fu">names</span>(dots) <span class="sc">!=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb928-8"><a href="translation.html#cb928-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb928-9"><a href="translation.html#cb928-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb928-10"><a href="translation.html#cb928-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb928-11"><a href="translation.html#cb928-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">named =</span> dots[is_named],</span>
<span id="cb928-12"><a href="translation.html#cb928-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">unnamed =</span> dots[<span class="sc">!</span>is_named]</span>
<span id="cb928-13"><a href="translation.html#cb928-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb928-14"><a href="translation.html#cb928-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb928-15"><a href="translation.html#cb928-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb928-16"><a href="translation.html#cb928-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">dots_partition</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="at">b =</span> <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb928-17"><a href="translation.html#cb928-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb928-18"><a href="translation.html#cb928-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ named  :List of 2</span></span>
<span id="cb928-19"><a href="translation.html#cb928-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ a: num 1</span></span>
<span id="cb928-20"><a href="translation.html#cb928-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ b: num 3</span></span>
<span id="cb928-21"><a href="translation.html#cb928-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ unnamed:List of 2</span></span>
<span id="cb928-22"><a href="translation.html#cb928-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ : num 2</span></span>
<span id="cb928-23"><a href="translation.html#cb928-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ..$ : num 4</span></span></code></pre></div>
<p>We can now create our <code>p()</code> function. Notice that theres one new function here: <code>html_attributes()</code>. It takes a named list and returns the HTML attribute specification as a string. Its a little complicated (in part, because it deals with some idiosyncrasies of HTML that I havent mentioned here), but its not that important and doesnt introduce any new programming ideas, so I wont discuss it in detail. You can find the <a href="https://github.com/hadley/adv-r/blob/master/dsl-html-attributes.r">source online</a> if you want to work through it yourself.</p>
<!-- GVW: possible/useful to show a very simple version of `html_attributes`, then point out one or two cases for which it fails, then tell them to read the source? I'm always nervous when someone tells me "you don't need to worry about the details of this" -->
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="translation.html#cb929-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;dsl-html-attributes.r&quot;</span>)</span>
<span id="cb929-2"><a href="translation.html#cb929-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb929-3"><a href="translation.html#cb929-3" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">dots_partition</span>(...)</span>
<span id="cb929-4"><a href="translation.html#cb929-4" aria-hidden="true" tabindex="-1"></a>  attribs <span class="ot">&lt;-</span> <span class="fu">html_attributes</span>(dots<span class="sc">$</span>named)</span>
<span id="cb929-5"><a href="translation.html#cb929-5" aria-hidden="true" tabindex="-1"></a>  children <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(dots<span class="sc">$</span>unnamed, escape)</span>
<span id="cb929-6"><a href="translation.html#cb929-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb929-7"><a href="translation.html#cb929-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html</span>(<span class="fu">paste0</span>(</span>
<span id="cb929-8"><a href="translation.html#cb929-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&lt;p&quot;</span>, attribs, <span class="st">&quot;&gt;&quot;</span>,</span>
<span id="cb929-9"><a href="translation.html#cb929-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(children, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb929-10"><a href="translation.html#cb929-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&lt;/p&gt;&quot;</span></span>
<span id="cb929-11"><a href="translation.html#cb929-11" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb929-12"><a href="translation.html#cb929-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb929-13"><a href="translation.html#cb929-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb929-14"><a href="translation.html#cb929-14" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">&quot;Some text&quot;</span>)</span>
<span id="cb929-15"><a href="translation.html#cb929-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;p&gt;Some text&lt;/p&gt;</span></span>
<span id="cb929-16"><a href="translation.html#cb929-16" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">&quot;Some text&quot;</span>, <span class="at">id =</span> <span class="st">&quot;myid&quot;</span>)</span>
<span id="cb929-17"><a href="translation.html#cb929-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;p id=&#39;myid&#39;&gt;Some text&lt;/p&gt;</span></span>
<span id="cb929-18"><a href="translation.html#cb929-18" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">&quot;Some text&quot;</span>, <span class="at">class =</span> <span class="st">&quot;important&quot;</span>, <span class="st">`</span><span class="at">data-value</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">10</span>)</span>
<span id="cb929-19"><a href="translation.html#cb929-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;p class=&#39;important&#39; data-value=&#39;10&#39;&gt;Some text&lt;/p&gt;</span></span></code></pre></div>
</div>
<div id="tag-functions" class="section level3" number="21.2.4">
<h3><span class="header-section-number">21.2.4</span> Tag functions</h3>
<p>Its straightforward to adapt <code>p()</code> to other tags: we just need to replace <code>"p"</code> with the name of the tag. One elegant way to do that is to create a function with <code>rlang::new_function()</code> (Section <a href="quasiquotation.html#new-function">19.7.4</a>), using unquoting and <code>paste0()</code> to generate the starting and ending tags.</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="translation.html#cb930-1" aria-hidden="true" tabindex="-1"></a>tag <span class="ot">&lt;-</span> <span class="cf">function</span>(tag) {</span>
<span id="cb930-2"><a href="translation.html#cb930-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb930-3"><a href="translation.html#cb930-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">... =</span> ),</span>
<span id="cb930-4"><a href="translation.html#cb930-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>({</span>
<span id="cb930-5"><a href="translation.html#cb930-5" aria-hidden="true" tabindex="-1"></a>      dots <span class="ot">&lt;-</span> <span class="fu">dots_partition</span>(...)</span>
<span id="cb930-6"><a href="translation.html#cb930-6" aria-hidden="true" tabindex="-1"></a>      attribs <span class="ot">&lt;-</span> <span class="fu">html_attributes</span>(dots<span class="sc">$</span>named)</span>
<span id="cb930-7"><a href="translation.html#cb930-7" aria-hidden="true" tabindex="-1"></a>      children <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(dots<span class="sc">$</span>unnamed, escape)</span>
<span id="cb930-8"><a href="translation.html#cb930-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb930-9"><a href="translation.html#cb930-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span>(<span class="fu">paste0</span>(</span>
<span id="cb930-10"><a href="translation.html#cb930-10" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;&lt;&quot;</span>, tag), attribs, <span class="st">&quot;&gt;&quot;</span>,</span>
<span id="cb930-11"><a href="translation.html#cb930-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(children, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb930-12"><a href="translation.html#cb930-12" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;&lt;/&quot;</span>, tag, <span class="st">&quot;&gt;&quot;</span>)</span>
<span id="cb930-13"><a href="translation.html#cb930-13" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb930-14"><a href="translation.html#cb930-14" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb930-15"><a href="translation.html#cb930-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">caller_env</span>()</span>
<span id="cb930-16"><a href="translation.html#cb930-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb930-17"><a href="translation.html#cb930-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb930-18"><a href="translation.html#cb930-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tag</span>(<span class="st">&quot;b&quot;</span>)</span>
<span id="cb930-19"><a href="translation.html#cb930-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (...) </span></span>
<span id="cb930-20"><a href="translation.html#cb930-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb930-21"><a href="translation.html#cb930-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     dots &lt;- dots_partition(...)</span></span>
<span id="cb930-22"><a href="translation.html#cb930-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     attribs &lt;- html_attributes(dots$named)</span></span>
<span id="cb930-23"><a href="translation.html#cb930-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     children &lt;- map_chr(dots$unnamed, escape)</span></span>
<span id="cb930-24"><a href="translation.html#cb930-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     html(paste0(&quot;&lt;b&quot;, attribs, &quot;&gt;&quot;, paste(children, collapse = &quot;&quot;), </span></span>
<span id="cb930-25"><a href="translation.html#cb930-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &quot;&lt;/b&gt;&quot;))</span></span>
<span id="cb930-26"><a href="translation.html#cb930-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>We need the weird <code>exprs(... = )</code> syntax to generate the empty <code>...</code> argument in the tag function. See Section <a href="expressions.html#empty-symbol">18.6.2</a> for more details.</p>
<p>Now we can run our earlier example:</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="translation.html#cb931-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">tag</span>(<span class="st">&quot;p&quot;</span>)</span>
<span id="cb931-2"><a href="translation.html#cb931-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">tag</span>(<span class="st">&quot;b&quot;</span>)</span>
<span id="cb931-3"><a href="translation.html#cb931-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">tag</span>(<span class="st">&quot;i&quot;</span>)</span>
<span id="cb931-4"><a href="translation.html#cb931-4" aria-hidden="true" tabindex="-1"></a><span class="fu">p</span>(<span class="st">&quot;Some text. &quot;</span>, <span class="fu">b</span>(<span class="fu">i</span>(<span class="st">&quot;some bold italic text&quot;</span>)), <span class="at">class =</span> <span class="st">&quot;mypara&quot;</span>)</span>
<span id="cb931-5"><a href="translation.html#cb931-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;p class=&#39;mypara&#39;&gt;Some text. &lt;b&gt;&lt;i&gt;some bold italic</span></span>
<span id="cb931-6"><a href="translation.html#cb931-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; text&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;</span></span></code></pre></div>
<p>Before we generate functions for every possible HTML tag, we need to create a variant that handles void tags. <code>void_tag()</code> is quite similar to <code>tag()</code>, but it throws an error if there are any unnamed tags, and the tag itself looks a little different.</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="translation.html#cb932-1" aria-hidden="true" tabindex="-1"></a>void_tag <span class="ot">&lt;-</span> <span class="cf">function</span>(tag) {</span>
<span id="cb932-2"><a href="translation.html#cb932-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb932-3"><a href="translation.html#cb932-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">... =</span> ),</span>
<span id="cb932-4"><a href="translation.html#cb932-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>({</span>
<span id="cb932-5"><a href="translation.html#cb932-5" aria-hidden="true" tabindex="-1"></a>      dots <span class="ot">&lt;-</span> <span class="fu">dots_partition</span>(...)</span>
<span id="cb932-6"><a href="translation.html#cb932-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(dots<span class="sc">$</span>unnamed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb932-7"><a href="translation.html#cb932-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abort</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;&lt;&quot;</span>, tag, <span class="st">&quot;&gt; must not have unnamed arguments&quot;</span>))</span>
<span id="cb932-8"><a href="translation.html#cb932-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb932-9"><a href="translation.html#cb932-9" aria-hidden="true" tabindex="-1"></a>      attribs <span class="ot">&lt;-</span> <span class="fu">html_attributes</span>(dots<span class="sc">$</span>named)</span>
<span id="cb932-10"><a href="translation.html#cb932-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb932-11"><a href="translation.html#cb932-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span>(<span class="fu">paste0</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;&lt;&quot;</span>, tag), attribs, <span class="st">&quot; /&gt;&quot;</span>))</span>
<span id="cb932-12"><a href="translation.html#cb932-12" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb932-13"><a href="translation.html#cb932-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">caller_env</span>()</span>
<span id="cb932-14"><a href="translation.html#cb932-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb932-15"><a href="translation.html#cb932-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb932-16"><a href="translation.html#cb932-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb932-17"><a href="translation.html#cb932-17" aria-hidden="true" tabindex="-1"></a>img <span class="ot">&lt;-</span> <span class="fu">void_tag</span>(<span class="st">&quot;img&quot;</span>)</span>
<span id="cb932-18"><a href="translation.html#cb932-18" aria-hidden="true" tabindex="-1"></a>img</span>
<span id="cb932-19"><a href="translation.html#cb932-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (...) </span></span>
<span id="cb932-20"><a href="translation.html#cb932-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb932-21"><a href="translation.html#cb932-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     dots &lt;- dots_partition(...)</span></span>
<span id="cb932-22"><a href="translation.html#cb932-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     if (length(dots$unnamed) &gt; 0) {</span></span>
<span id="cb932-23"><a href="translation.html#cb932-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         abort(&quot;&lt;img&gt; must not have unnamed arguments&quot;)</span></span>
<span id="cb932-24"><a href="translation.html#cb932-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb932-25"><a href="translation.html#cb932-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     attribs &lt;- html_attributes(dots$named)</span></span>
<span id="cb932-26"><a href="translation.html#cb932-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     html(paste0(&quot;&lt;img&quot;, attribs, &quot; /&gt;&quot;))</span></span>
<span id="cb932-27"><a href="translation.html#cb932-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb932-28"><a href="translation.html#cb932-28" aria-hidden="true" tabindex="-1"></a><span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;myimage.png&quot;</span>, <span class="at">width =</span> <span class="dv">100</span>, <span class="at">height =</span> <span class="dv">100</span>)</span>
<span id="cb932-29"><a href="translation.html#cb932-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;img src=&#39;myimage.png&#39; width=&#39;100&#39; height=&#39;100&#39; /&gt;</span></span></code></pre></div>
</div>
<div id="html-env" class="section level3" number="21.2.5">
<h3><span class="header-section-number">21.2.5</span> Processing all tags</h3>
<p>Next we need to generate these functions for every tag. Well start with a list of all HTML tags:</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="translation.html#cb933-1" aria-hidden="true" tabindex="-1"></a>tags <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;abbr&quot;</span>, <span class="st">&quot;address&quot;</span>, <span class="st">&quot;article&quot;</span>, <span class="st">&quot;aside&quot;</span>, <span class="st">&quot;audio&quot;</span>,</span>
<span id="cb933-2"><a href="translation.html#cb933-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;b&quot;</span>,<span class="st">&quot;bdi&quot;</span>, <span class="st">&quot;bdo&quot;</span>, <span class="st">&quot;blockquote&quot;</span>, <span class="st">&quot;body&quot;</span>, <span class="st">&quot;button&quot;</span>, <span class="st">&quot;canvas&quot;</span>,</span>
<span id="cb933-3"><a href="translation.html#cb933-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;caption&quot;</span>,<span class="st">&quot;cite&quot;</span>, <span class="st">&quot;code&quot;</span>, <span class="st">&quot;colgroup&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;datalist&quot;</span>,</span>
<span id="cb933-4"><a href="translation.html#cb933-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dd&quot;</span>, <span class="st">&quot;del&quot;</span>,<span class="st">&quot;details&quot;</span>, <span class="st">&quot;dfn&quot;</span>, <span class="st">&quot;div&quot;</span>, <span class="st">&quot;dl&quot;</span>, <span class="st">&quot;dt&quot;</span>, <span class="st">&quot;em&quot;</span>,</span>
<span id="cb933-5"><a href="translation.html#cb933-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;eventsource&quot;</span>,<span class="st">&quot;fieldset&quot;</span>, <span class="st">&quot;figcaption&quot;</span>, <span class="st">&quot;figure&quot;</span>, <span class="st">&quot;footer&quot;</span>,</span>
<span id="cb933-6"><a href="translation.html#cb933-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;form&quot;</span>, <span class="st">&quot;h1&quot;</span>, <span class="st">&quot;h2&quot;</span>, <span class="st">&quot;h3&quot;</span>, <span class="st">&quot;h4&quot;</span>, <span class="st">&quot;h5&quot;</span>, <span class="st">&quot;h6&quot;</span>, <span class="st">&quot;head&quot;</span>, <span class="st">&quot;header&quot;</span>,</span>
<span id="cb933-7"><a href="translation.html#cb933-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hgroup&quot;</span>, <span class="st">&quot;html&quot;</span>, <span class="st">&quot;i&quot;</span>,<span class="st">&quot;iframe&quot;</span>, <span class="st">&quot;ins&quot;</span>, <span class="st">&quot;kbd&quot;</span>, <span class="st">&quot;label&quot;</span>,</span>
<span id="cb933-8"><a href="translation.html#cb933-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;legend&quot;</span>, <span class="st">&quot;li&quot;</span>, <span class="st">&quot;mark&quot;</span>, <span class="st">&quot;map&quot;</span>,<span class="st">&quot;menu&quot;</span>, <span class="st">&quot;meter&quot;</span>, <span class="st">&quot;nav&quot;</span>,</span>
<span id="cb933-9"><a href="translation.html#cb933-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;noscript&quot;</span>, <span class="st">&quot;object&quot;</span>, <span class="st">&quot;ol&quot;</span>, <span class="st">&quot;optgroup&quot;</span>, <span class="st">&quot;option&quot;</span>, <span class="st">&quot;output&quot;</span>,</span>
<span id="cb933-10"><a href="translation.html#cb933-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;p&quot;</span>, <span class="st">&quot;pre&quot;</span>, <span class="st">&quot;progress&quot;</span>, <span class="st">&quot;q&quot;</span>, <span class="st">&quot;ruby&quot;</span>, <span class="st">&quot;rp&quot;</span>,<span class="st">&quot;rt&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;samp&quot;</span>,</span>
<span id="cb933-11"><a href="translation.html#cb933-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;script&quot;</span>, <span class="st">&quot;section&quot;</span>, <span class="st">&quot;select&quot;</span>, <span class="st">&quot;small&quot;</span>, <span class="st">&quot;span&quot;</span>, <span class="st">&quot;strong&quot;</span>,</span>
<span id="cb933-12"><a href="translation.html#cb933-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;style&quot;</span>, <span class="st">&quot;sub&quot;</span>, <span class="st">&quot;summary&quot;</span>, <span class="st">&quot;sup&quot;</span>, <span class="st">&quot;table&quot;</span>, <span class="st">&quot;tbody&quot;</span>, <span class="st">&quot;td&quot;</span>,</span>
<span id="cb933-13"><a href="translation.html#cb933-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;textarea&quot;</span>, <span class="st">&quot;tfoot&quot;</span>, <span class="st">&quot;th&quot;</span>, <span class="st">&quot;thead&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;title&quot;</span>, <span class="st">&quot;tr&quot;</span>,</span>
<span id="cb933-14"><a href="translation.html#cb933-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;u&quot;</span>, <span class="st">&quot;ul&quot;</span>, <span class="st">&quot;var&quot;</span>, <span class="st">&quot;video&quot;</span></span>
<span id="cb933-15"><a href="translation.html#cb933-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb933-16"><a href="translation.html#cb933-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb933-17"><a href="translation.html#cb933-17" aria-hidden="true" tabindex="-1"></a>void_tags <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;area&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;br&quot;</span>, <span class="st">&quot;col&quot;</span>, <span class="st">&quot;command&quot;</span>, <span class="st">&quot;embed&quot;</span>,</span>
<span id="cb933-18"><a href="translation.html#cb933-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;hr&quot;</span>, <span class="st">&quot;img&quot;</span>, <span class="st">&quot;input&quot;</span>, <span class="st">&quot;keygen&quot;</span>, <span class="st">&quot;link&quot;</span>, <span class="st">&quot;meta&quot;</span>, <span class="st">&quot;param&quot;</span>,</span>
<span id="cb933-19"><a href="translation.html#cb933-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;source&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;wbr&quot;</span></span>
<span id="cb933-20"><a href="translation.html#cb933-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>If you look at this list carefully, youll see there are quite a few tags that have the same name as base R functions (<code>body</code>, <code>col</code>, <code>q</code>, <code>source</code>, <code>sub</code>, <code>summary</code>, <code>table</code>). This means we dont want to make all the functions available by default, either in the global environment or in a package. Instead, well put them in a list (like in Section <a href="function-factories.html#functional-factories">10.5</a>) and then provide a helper to make it easy to use them when desired. First, we make a named list containing all the tag functions:</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="translation.html#cb934-1" aria-hidden="true" tabindex="-1"></a>html_tags <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb934-2"><a href="translation.html#cb934-2" aria-hidden="true" tabindex="-1"></a>  tags <span class="sc">%&gt;%</span> <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> <span class="fu">map</span>(tag),</span>
<span id="cb934-3"><a href="translation.html#cb934-3" aria-hidden="true" tabindex="-1"></a>  void_tags <span class="sc">%&gt;%</span> <span class="fu">set_names</span>() <span class="sc">%&gt;%</span> <span class="fu">map</span>(void_tag)</span>
<span id="cb934-4"><a href="translation.html#cb934-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This gives us an explicit (but verbose) way to create HTML:</p>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="translation.html#cb935-1" aria-hidden="true" tabindex="-1"></a>html_tags<span class="sc">$</span><span class="fu">p</span>(</span>
<span id="cb935-2"><a href="translation.html#cb935-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Some text. &quot;</span>,</span>
<span id="cb935-3"><a href="translation.html#cb935-3" aria-hidden="true" tabindex="-1"></a>  html_tags<span class="sc">$</span><span class="fu">b</span>(html_tags<span class="sc">$</span><span class="fu">i</span>(<span class="st">&quot;some bold italic text&quot;</span>)),</span>
<span id="cb935-4"><a href="translation.html#cb935-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">&quot;mypara&quot;</span></span>
<span id="cb935-5"><a href="translation.html#cb935-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb935-6"><a href="translation.html#cb935-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;p class=&#39;mypara&#39;&gt;Some text. &lt;b&gt;&lt;i&gt;some bold italic</span></span>
<span id="cb935-7"><a href="translation.html#cb935-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; text&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;</span></span></code></pre></div>
<p>We can then finish off our HTML DSL with a function that allows us to evaluate code in the context of that list. Here we slightly abuse the data mask, passing it a list of functions rather than a data frame. This is quick hack to mingle the execution environment of <code>code</code> with the functions in <code>html_tags</code>.</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="translation.html#cb936-1" aria-hidden="true" tabindex="-1"></a>with_html <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb936-2"><a href="translation.html#cb936-2" aria-hidden="true" tabindex="-1"></a>  code <span class="ot">&lt;-</span> <span class="fu">enquo</span>(code)</span>
<span id="cb936-3"><a href="translation.html#cb936-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval_tidy</span>(code, html_tags)</span>
<span id="cb936-4"><a href="translation.html#cb936-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This gives us a succinct API which allows us to write HTML when we need it but doesnt clutter up the namespace when we dont.</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="translation.html#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with_html</span>(</span>
<span id="cb937-2"><a href="translation.html#cb937-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body</span>(</span>
<span id="cb937-3"><a href="translation.html#cb937-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">h1</span>(<span class="st">&quot;A heading&quot;</span>, <span class="at">id =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb937-4"><a href="translation.html#cb937-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p</span>(<span class="st">&quot;Some text &amp;&quot;</span>, <span class="fu">b</span>(<span class="st">&quot;some bold text.&quot;</span>)),</span>
<span id="cb937-5"><a href="translation.html#cb937-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;myimg.png&quot;</span>, <span class="at">width =</span> <span class="dv">100</span>, <span class="at">height =</span> <span class="dv">100</span>)</span>
<span id="cb937-6"><a href="translation.html#cb937-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb937-7"><a href="translation.html#cb937-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb937-8"><a href="translation.html#cb937-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;HTML&gt; &lt;body&gt;&lt;h1 id=&#39;first&#39;&gt;A heading&lt;/h1&gt;&lt;p&gt;Some text &amp;amp;&lt;b&gt;some</span></span>
<span id="cb937-9"><a href="translation.html#cb937-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; bold text.&lt;/b&gt;&lt;/p&gt;&lt;img src=&#39;myimg.png&#39; width=&#39;100&#39; height=&#39;100&#39;</span></span>
<span id="cb937-10"><a href="translation.html#cb937-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; /&gt;&lt;/body&gt;</span></span></code></pre></div>
<p>If you want to access the R function overridden by an HTML tag with the same name inside <code>with_html()</code>, you can use the full <code>package::function</code> specification.</p>
</div>
<div id="exercises-66" class="section level3" number="21.2.6">
<h3><span class="header-section-number">21.2.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The escaping rules for <code>&lt;script&gt;</code> tags are different because they contain
JavaScript, not HTML. Instead of escaping angle brackets or ampersands,
you need to escape <code>&lt;/script&gt;</code> so that the tag isnt closed too early.
For example, <code>script("'&lt;/script&gt;'")</code>, shouldnt generate this:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb938-1"><a href="translation.html#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script&gt;</span><span class="st">&#39;&lt;/script&gt;&#39;</span><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p>But</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb939-1"><a href="translation.html#cb939-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;script&gt;</span><span class="st">&#39;&lt;</span><span class="sc">\/</span><span class="st">script&gt;&#39;</span><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p>Adapt the <code>escape()</code> to follow these rules when a new argument <code>script</code>
is set to <code>TRUE</code>.</p></li>
<li><p>The use of <code>...</code> for all functions has some big downsides. Theres no
input validation and there will be little information in the
documentation or autocomplete about how they are used in the function.
Create a new function that, when given a named list of tags and their
attribute names (like below), creates tag functions with named arguments.</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="translation.html#cb940-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb940-2"><a href="translation.html#cb940-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">c</span>(<span class="st">&quot;href&quot;</span>),</span>
<span id="cb940-3"><a href="translation.html#cb940-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">img =</span> <span class="fu">c</span>(<span class="st">&quot;src&quot;</span>, <span class="st">&quot;width&quot;</span>, <span class="st">&quot;height&quot;</span>)</span>
<span id="cb940-4"><a href="translation.html#cb940-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>All tags should get <code>class</code> and <code>id</code> attributes.</p></li>
<li><p>Reason about the following code that calls <code>with_html()</code> referencing objects
from the environment. Will it work or fail? Why? Run the code to
verify your predictions.</p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb941-1"><a href="translation.html#cb941-1" aria-hidden="true" tabindex="-1"></a>greeting <span class="ot">&lt;-</span> <span class="st">&quot;Hello!&quot;</span></span>
<span id="cb941-2"><a href="translation.html#cb941-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with_html</span>(<span class="fu">p</span>(greeting))</span>
<span id="cb941-3"><a href="translation.html#cb941-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb941-4"><a href="translation.html#cb941-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="st">&quot;p&quot;</span></span>
<span id="cb941-5"><a href="translation.html#cb941-5" aria-hidden="true" tabindex="-1"></a>address <span class="ot">&lt;-</span> <span class="st">&quot;123 anywhere street&quot;</span></span>
<span id="cb941-6"><a href="translation.html#cb941-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with_html</span>(<span class="fu">p</span>(address))</span></code></pre></div></li>
<li><p>Currently the HTML doesnt look terribly pretty, and its hard to see the
structure. How could you adapt <code>tag()</code> to do indenting and formatting?
(You may need to do some research into block and inline tags.)</p></li>
</ol>
</div>
</div>
<div id="latex" class="section level2" number="21.3">
<h2><span class="header-section-number">21.3</span> LaTeX</h2>
<p></p>
<p>The next DSL will convert R expressions into their LaTeX math equivalents. (This is a bit like <code>?plotmath</code>, but for text instead of plots.) LaTeX is the lingua franca of mathematicians and statisticians: its common to use LaTeX notation whenever you want to express an equation in text, like in email. Since many reports are produced using both R and LaTeX, it might be useful to be able to automatically convert mathematical expressions from one language to the other.</p>
<p>Because we need to convert both functions and names, this mathematical DSL will be more complicated than the HTML DSL. Well also need to create a default conversion, so that symbols that we dont know about get a standard conversion. This means that we can no longer use just evaluation: we also need to walk the abstract syntax tree (AST).</p>
<div id="latex-mathematics" class="section level3" number="21.3.1">
<h3><span class="header-section-number">21.3.1</span> LaTeX mathematics</h3>
<p>Before we begin, lets quickly cover how formulas are expressed in LaTeX. The full standard is very complex, but fortunately is <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">well documented</a>, and the most common commands have a fairly simple structure:</p>
<ul>
<li><p>Most simple mathematical equations are written in the same way youd type
them in R: <code>x * y</code>, <code>z ^ 5</code>. Subscripts are written using <code>_</code> (e.g., <code>x_1</code>).</p></li>
<li><p>Special characters start with a <code>\</code>: <code>\pi</code> = <span class="math inline">\(\pi\)</span>, <code>\pm</code> = <span class="math inline">\(\pm\)</span>, and so on.
There are a huge number of symbols available in LaTeX: searching online for
<code>latex math symbols</code> returns many
<a href="http://www.sunilpatel.co.uk/latex-type/latex-math-symbols/">lists</a>.
Theres even <a href="http://detexify.kirelabs.org/classify.html">a service</a> that
will look up the symbol you sketch in the browser.</p></li>
<li><p>More complicated functions look like <code>\name{arg1}{arg2}</code>. For example, to
write a fraction youd use <code>\frac{a}{b}</code>. To write a square root, youd use
<code>\sqrt{a}</code>.</p></li>
<li><p>To group elements together use <code>{}</code>: i.e., <code>x ^ a + b</code> versus <code>x ^ {a + b}</code>.</p></li>
<li><p>In good math typesetting, a distinction is made between variables and
functions. But without extra information, LaTeX doesnt know whether
<code>f(a * b)</code> represents calling the function <code>f</code> with input <code>a * b</code>,
or is shorthand for <code>f * (a * b)</code>. If <code>f</code> is a function, you can tell
LaTeX to typeset it using an upright font with <code>\textrm{f}(a * b)</code>.
(The <code>rm</code> stands for Roman, the opposite of italics.)</p></li>
</ul>
</div>
<div id="goal-1" class="section level3" number="21.3.2">
<h3><span class="header-section-number">21.3.2</span> Goal</h3>
<p>Our goal is to use these rules to automatically convert an R expression to its appropriate LaTeX representation. Well tackle this in four stages:</p>
<ul>
<li><p>Convert known symbols: <code>pi</code>  <code>\pi</code></p></li>
<li><p>Leave other symbols unchanged: <code>x</code>  <code>x</code>, <code>y</code>  <code>y</code></p></li>
<li><p>Convert known functions to their special forms: <code>sqrt(frac(a, b))</code> 
<code>\sqrt{\frac{a}{b}}</code></p></li>
<li><p>Wrap unknown functions with <code>\textrm</code>: <code>f(a)</code>  <code>\textrm{f}(a)</code></p></li>
</ul>
<p>Well code this translation in the opposite direction of what we did with the HTML DSL. Well start with infrastructure, because that makes it easy to experiment with our DSL, and then work our way back down to generate the desired output.</p>
</div>
<div id="to_math" class="section level3" number="21.3.3">
<h3><span class="header-section-number">21.3.3</span> <code>to_math</code>()</h3>
<p>To begin, we need a wrapper function that will convert R expressions into LaTeX math expressions. This will work like <code>to_html()</code> by capturing the unevaluated expression and evaluating it in a special environment. There are two main differences:</p>
<ul>
<li><p>The evaluation environment is no longer constant, as it has to vary depending on
the input. This is necessary to handle unknown symbols and functions.</p></li>
<li><p>We never evaluate in the argument environment because were translating every
function to a LaTeX expression. The user will need to use explicitly <code>!!</code> in
order to evaluate normally.</p></li>
</ul>
<p>This gives us:</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="translation.html#cb942-1" aria-hidden="true" tabindex="-1"></a>to_math <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb942-2"><a href="translation.html#cb942-2" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">enexpr</span>(x)</span>
<span id="cb942-3"><a href="translation.html#cb942-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">eval_bare</span>(expr, <span class="fu">latex_env</span>(expr))</span>
<span id="cb942-4"><a href="translation.html#cb942-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb942-5"><a href="translation.html#cb942-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">latex</span>(out)</span>
<span id="cb942-6"><a href="translation.html#cb942-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb942-7"><a href="translation.html#cb942-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb942-8"><a href="translation.html#cb942-8" aria-hidden="true" tabindex="-1"></a>latex <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">structure</span>(x, <span class="at">class =</span> <span class="st">&quot;advr_latex&quot;</span>)</span>
<span id="cb942-9"><a href="translation.html#cb942-9" aria-hidden="true" tabindex="-1"></a>print.advr_latex <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb942-10"><a href="translation.html#cb942-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;&lt;LATEX&gt; &quot;</span>, x, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb942-11"><a href="translation.html#cb942-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next well build up <code>latex_env()</code>, starting simply and getting progressively more complex.</p>
</div>
<div id="known-symbols" class="section level3" number="21.3.4">
<h3><span class="header-section-number">21.3.4</span> Known symbols</h3>
<p>Our first step is to create an environment that will convert the special LaTeX symbols used for Greek characters, e.g., <code>pi</code> to <code>\pi</code>. Well use the trick from Section <a href="evaluation.html#subset">20.4.3</a> to bind the symbol <code>pi</code> to the value <code>"\pi"</code>.</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="translation.html#cb943-1" aria-hidden="true" tabindex="-1"></a>greek <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb943-2"><a href="translation.html#cb943-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;theta&quot;</span>, <span class="st">&quot;tau&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;vartheta&quot;</span>, <span class="st">&quot;pi&quot;</span>, <span class="st">&quot;upsilon&quot;</span>,</span>
<span id="cb943-3"><a href="translation.html#cb943-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;varpi&quot;</span>, <span class="st">&quot;phi&quot;</span>, <span class="st">&quot;delta&quot;</span>, <span class="st">&quot;kappa&quot;</span>, <span class="st">&quot;rho&quot;</span>,</span>
<span id="cb943-4"><a href="translation.html#cb943-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;varphi&quot;</span>, <span class="st">&quot;epsilon&quot;</span>, <span class="st">&quot;lambda&quot;</span>, <span class="st">&quot;varrho&quot;</span>, <span class="st">&quot;chi&quot;</span>, <span class="st">&quot;varepsilon&quot;</span>,</span>
<span id="cb943-5"><a href="translation.html#cb943-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;psi&quot;</span>, <span class="st">&quot;zeta&quot;</span>, <span class="st">&quot;nu&quot;</span>, <span class="st">&quot;varsigma&quot;</span>, <span class="st">&quot;omega&quot;</span>, <span class="st">&quot;eta&quot;</span>,</span>
<span id="cb943-6"><a href="translation.html#cb943-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;xi&quot;</span>, <span class="st">&quot;Gamma&quot;</span>, <span class="st">&quot;Lambda&quot;</span>, <span class="st">&quot;Sigma&quot;</span>, <span class="st">&quot;Psi&quot;</span>, <span class="st">&quot;Delta&quot;</span>, <span class="st">&quot;Xi&quot;</span>,</span>
<span id="cb943-7"><a href="translation.html#cb943-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Upsilon&quot;</span>, <span class="st">&quot;Omega&quot;</span>, <span class="st">&quot;Theta&quot;</span>, <span class="st">&quot;Pi&quot;</span>, <span class="st">&quot;Phi&quot;</span></span>
<span id="cb943-8"><a href="translation.html#cb943-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb943-9"><a href="translation.html#cb943-9" aria-hidden="true" tabindex="-1"></a>greek_list <span class="ot">&lt;-</span> <span class="fu">set_names</span>(<span class="fu">paste0</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span>, greek), greek)</span>
<span id="cb943-10"><a href="translation.html#cb943-10" aria-hidden="true" tabindex="-1"></a>greek_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(greek_list)</span></code></pre></div>
<p>We can then check it:</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="translation.html#cb944-1" aria-hidden="true" tabindex="-1"></a>latex_env <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb944-2"><a href="translation.html#cb944-2" aria-hidden="true" tabindex="-1"></a>  greek_env</span>
<span id="cb944-3"><a href="translation.html#cb944-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb944-4"><a href="translation.html#cb944-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb944-5"><a href="translation.html#cb944-5" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(pi)</span>
<span id="cb944-6"><a href="translation.html#cb944-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \pi</span></span>
<span id="cb944-7"><a href="translation.html#cb944-7" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(beta)</span>
<span id="cb944-8"><a href="translation.html#cb944-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \beta</span></span></code></pre></div>
<p>Looks good so far!</p>
</div>
<div id="unknown-symbols" class="section level3" number="21.3.5">
<h3><span class="header-section-number">21.3.5</span> Unknown symbols</h3>
<p>If a symbol isnt Greek, we want to leave it as is. This is tricky because we dont know in advance what symbols will be used, and we cant possibly generate them all. Instead, well use the approach described in Section <a href="expressions.html#ast-funs">18.5</a>: walking the AST to find all symbols. This gives us <code>all_names_rec()</code> and helper <code>all_names()</code>:</p>
<!-- GVW: on first reading I wondered why you bothered to define `switch_expr`, since it only appears to be used once.  Then I saw that there's a second call much further down. Highlight this somehow? -->
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="translation.html#cb945-1" aria-hidden="true" tabindex="-1"></a>all_names_rec <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb945-2"><a href="translation.html#cb945-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">switch_expr</span>(x,</span>
<span id="cb945-3"><a href="translation.html#cb945-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">constant =</span> <span class="fu">character</span>(),</span>
<span id="cb945-4"><a href="translation.html#cb945-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span>   <span class="fu">as.character</span>(x),</span>
<span id="cb945-5"><a href="translation.html#cb945-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">call =</span>     <span class="fu">flat_map_chr</span>(<span class="fu">as.list</span>(x[<span class="sc">-</span><span class="dv">1</span>]), all_names)</span>
<span id="cb945-6"><a href="translation.html#cb945-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb945-7"><a href="translation.html#cb945-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb945-8"><a href="translation.html#cb945-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb945-9"><a href="translation.html#cb945-9" aria-hidden="true" tabindex="-1"></a>all_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb945-10"><a href="translation.html#cb945-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(<span class="fu">all_names_rec</span>(x))</span>
<span id="cb945-11"><a href="translation.html#cb945-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb945-12"><a href="translation.html#cb945-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb945-13"><a href="translation.html#cb945-13" aria-hidden="true" tabindex="-1"></a><span class="fu">all_names</span>(<span class="fu">expr</span>(x <span class="sc">+</span> y <span class="sc">+</span> <span class="fu">f</span>(a, b, c, <span class="dv">10</span>)))</span>
<span id="cb945-14"><a href="translation.html#cb945-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;x&quot; &quot;y&quot; &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span></code></pre></div>
<p>We now want to take that list of symbols and convert it to an environment so that each symbol is mapped to its corresponding string representation (e.g., so <code>eval(quote(x), env)</code> yields <code>"x"</code>). We again use the pattern of converting a named character vector to a list, then converting the list to an environment.</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="translation.html#cb946-1" aria-hidden="true" tabindex="-1"></a>latex_env <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb946-2"><a href="translation.html#cb946-2" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">&lt;-</span> <span class="fu">all_names</span>(expr)</span>
<span id="cb946-3"><a href="translation.html#cb946-3" aria-hidden="true" tabindex="-1"></a>  symbol_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(<span class="fu">set_names</span>(names))</span>
<span id="cb946-4"><a href="translation.html#cb946-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb946-5"><a href="translation.html#cb946-5" aria-hidden="true" tabindex="-1"></a>  symbol_env</span>
<span id="cb946-6"><a href="translation.html#cb946-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb946-7"><a href="translation.html#cb946-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb946-8"><a href="translation.html#cb946-8" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(x)</span>
<span id="cb946-9"><a href="translation.html#cb946-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; x</span></span>
<span id="cb946-10"><a href="translation.html#cb946-10" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(longvariablename)</span>
<span id="cb946-11"><a href="translation.html#cb946-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; longvariablename</span></span>
<span id="cb946-12"><a href="translation.html#cb946-12" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(pi)</span>
<span id="cb946-13"><a href="translation.html#cb946-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; pi</span></span></code></pre></div>
<p>This works, but we need to combine it with the Greek symbols environment. Since we want to give preference to Greek over defaults (e.g., <code>to_math(pi)</code> should give <code>"\\pi"</code>, not <code>"pi"</code>), <code>symbol_env</code> needs to be the parent of <code>greek_env</code>. To do that, we need to make a copy of <code>greek_env</code> with a new parent. This gives us a function that can convert both known (Greek) and unknown symbols.</p>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="translation.html#cb947-1" aria-hidden="true" tabindex="-1"></a>latex_env <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb947-2"><a href="translation.html#cb947-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unknown symbols</span></span>
<span id="cb947-3"><a href="translation.html#cb947-3" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">&lt;-</span> <span class="fu">all_names</span>(expr)</span>
<span id="cb947-4"><a href="translation.html#cb947-4" aria-hidden="true" tabindex="-1"></a>  symbol_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(<span class="fu">set_names</span>(names))</span>
<span id="cb947-5"><a href="translation.html#cb947-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb947-6"><a href="translation.html#cb947-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Known symbols</span></span>
<span id="cb947-7"><a href="translation.html#cb947-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">env_clone</span>(greek_env, <span class="at">parent =</span> symbol_env)</span>
<span id="cb947-8"><a href="translation.html#cb947-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb947-9"><a href="translation.html#cb947-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb947-10"><a href="translation.html#cb947-10" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(x)</span>
<span id="cb947-11"><a href="translation.html#cb947-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; x</span></span>
<span id="cb947-12"><a href="translation.html#cb947-12" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(longvariablename)</span>
<span id="cb947-13"><a href="translation.html#cb947-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; longvariablename</span></span>
<span id="cb947-14"><a href="translation.html#cb947-14" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(pi)</span>
<span id="cb947-15"><a href="translation.html#cb947-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \pi</span></span></code></pre></div>
</div>
<div id="known-functions" class="section level3" number="21.3.6">
<h3><span class="header-section-number">21.3.6</span> Known functions</h3>
<p>Next well add functions to our DSL. Well start with a couple of helpers that make it easy to add new unary and binary operators. These functions are very simple: they only assemble strings.</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="translation.html#cb948-1" aria-hidden="true" tabindex="-1"></a>unary_op <span class="ot">&lt;-</span> <span class="cf">function</span>(left, right) {</span>
<span id="cb948-2"><a href="translation.html#cb948-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb948-3"><a href="translation.html#cb948-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">e1 =</span> ),</span>
<span id="cb948-4"><a href="translation.html#cb948-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>(</span>
<span id="cb948-5"><a href="translation.html#cb948-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="sc">!!</span>left, e1, <span class="sc">!!</span>right)</span>
<span id="cb948-6"><a href="translation.html#cb948-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb948-7"><a href="translation.html#cb948-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">caller_env</span>()</span>
<span id="cb948-8"><a href="translation.html#cb948-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb948-9"><a href="translation.html#cb948-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb948-10"><a href="translation.html#cb948-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb948-11"><a href="translation.html#cb948-11" aria-hidden="true" tabindex="-1"></a>binary_op <span class="ot">&lt;-</span> <span class="cf">function</span>(sep) {</span>
<span id="cb948-12"><a href="translation.html#cb948-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb948-13"><a href="translation.html#cb948-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">e1 =</span> , <span class="at">e2 =</span> ),</span>
<span id="cb948-14"><a href="translation.html#cb948-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>(</span>
<span id="cb948-15"><a href="translation.html#cb948-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(e1, <span class="sc">!!</span>sep, e2)</span>
<span id="cb948-16"><a href="translation.html#cb948-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb948-17"><a href="translation.html#cb948-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">caller_env</span>()</span>
<span id="cb948-18"><a href="translation.html#cb948-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb948-19"><a href="translation.html#cb948-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb948-20"><a href="translation.html#cb948-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb948-21"><a href="translation.html#cb948-21" aria-hidden="true" tabindex="-1"></a><span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">sqrt{&quot;</span>, <span class="st">&quot;}&quot;</span>)</span>
<span id="cb948-22"><a href="translation.html#cb948-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (e1) </span></span>
<span id="cb948-23"><a href="translation.html#cb948-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; paste0(&quot;\\sqrt{&quot;, e1, &quot;}&quot;)</span></span>
<span id="cb948-24"><a href="translation.html#cb948-24" aria-hidden="true" tabindex="-1"></a><span class="fu">binary_op</span>(<span class="st">&quot;+&quot;</span>)</span>
<span id="cb948-25"><a href="translation.html#cb948-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (e1, e2) </span></span>
<span id="cb948-26"><a href="translation.html#cb948-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; paste0(e1, &quot;+&quot;, e2)</span></span></code></pre></div>
<p>Using these helpers, we can map a few illustrative examples of converting R to LaTeX. Note that with Rs lexical scoping rules helping us, we can easily provide new meanings for standard functions like <code>+</code>, <code>-</code>, and <code>*</code>, and even <code>(</code> and <code>{</code>.</p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="translation.html#cb949-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary operators</span></span>
<span id="cb949-2"><a href="translation.html#cb949-2" aria-hidden="true" tabindex="-1"></a>f_env <span class="ot">&lt;-</span> <span class="fu">child_env</span>(</span>
<span id="cb949-3"><a href="translation.html#cb949-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.parent =</span> <span class="fu">empty_env</span>(),</span>
<span id="cb949-4"><a href="translation.html#cb949-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">+</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot; + &quot;</span>),</span>
<span id="cb949-5"><a href="translation.html#cb949-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">-</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot; - &quot;</span>),</span>
<span id="cb949-6"><a href="translation.html#cb949-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">*</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot; * &quot;</span>),</span>
<span id="cb949-7"><a href="translation.html#cb949-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">/</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot; / &quot;</span>),</span>
<span id="cb949-8"><a href="translation.html#cb949-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">^</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot;^&quot;</span>),</span>
<span id="cb949-9"><a href="translation.html#cb949-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">[</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">binary_op</span>(<span class="st">&quot;_&quot;</span>),</span>
<span id="cb949-10"><a href="translation.html#cb949-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-11"><a href="translation.html#cb949-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grouping</span></span>
<span id="cb949-12"><a href="translation.html#cb949-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">{</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">left{ &quot;</span>, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">right}&quot;</span>),</span>
<span id="cb949-13"><a href="translation.html#cb949-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">left( &quot;</span>, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">right)&quot;</span>),</span>
<span id="cb949-14"><a href="translation.html#cb949-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">paste =</span> paste,</span>
<span id="cb949-15"><a href="translation.html#cb949-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-16"><a href="translation.html#cb949-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other math functions</span></span>
<span id="cb949-17"><a href="translation.html#cb949-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sqrt =</span> <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">sqrt{&quot;</span>, <span class="st">&quot;}&quot;</span>),</span>
<span id="cb949-18"><a href="translation.html#cb949-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sin =</span>  <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">sin(&quot;</span>, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb949-19"><a href="translation.html#cb949-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">log =</span>  <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">log(&quot;</span>, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb949-20"><a href="translation.html#cb949-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">abs =</span>  <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">left| &quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">right| &quot;</span>),</span>
<span id="cb949-21"><a href="translation.html#cb949-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">frac =</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb949-22"><a href="translation.html#cb949-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">frac{&quot;</span>, a, <span class="st">&quot;}{&quot;</span>, b, <span class="st">&quot;}&quot;</span>)</span>
<span id="cb949-23"><a href="translation.html#cb949-23" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb949-24"><a href="translation.html#cb949-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb949-25"><a href="translation.html#cb949-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labelling</span></span>
<span id="cb949-26"><a href="translation.html#cb949-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">hat =</span>   <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">hat{&quot;</span>, <span class="st">&quot;}&quot;</span>),</span>
<span id="cb949-27"><a href="translation.html#cb949-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">tilde =</span> <span class="fu">unary_op</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">tilde{&quot;</span>, <span class="st">&quot;}&quot;</span>)</span>
<span id="cb949-28"><a href="translation.html#cb949-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We again modify <code>latex_env()</code> to include this environment. It should be the last environment R looks for names in so that expressions like <code>sin(sin)</code> will work.</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="translation.html#cb950-1" aria-hidden="true" tabindex="-1"></a>latex_env <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb950-2"><a href="translation.html#cb950-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Known functions</span></span>
<span id="cb950-3"><a href="translation.html#cb950-3" aria-hidden="true" tabindex="-1"></a>  f_env</span>
<span id="cb950-4"><a href="translation.html#cb950-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-5"><a href="translation.html#cb950-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Default symbols</span></span>
<span id="cb950-6"><a href="translation.html#cb950-6" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">&lt;-</span> <span class="fu">all_names</span>(expr)</span>
<span id="cb950-7"><a href="translation.html#cb950-7" aria-hidden="true" tabindex="-1"></a>  symbol_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(<span class="fu">set_names</span>(names), <span class="at">parent =</span> f_env)</span>
<span id="cb950-8"><a href="translation.html#cb950-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-9"><a href="translation.html#cb950-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Known symbols</span></span>
<span id="cb950-10"><a href="translation.html#cb950-10" aria-hidden="true" tabindex="-1"></a>  greek_env <span class="ot">&lt;-</span> <span class="fu">env_clone</span>(greek_env, <span class="at">parent =</span> symbol_env)</span>
<span id="cb950-11"><a href="translation.html#cb950-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-12"><a href="translation.html#cb950-12" aria-hidden="true" tabindex="-1"></a>  greek_env</span>
<span id="cb950-13"><a href="translation.html#cb950-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb950-14"><a href="translation.html#cb950-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb950-15"><a href="translation.html#cb950-15" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(<span class="fu">sin</span>(x <span class="sc">+</span> pi))</span>
<span id="cb950-16"><a href="translation.html#cb950-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \sin(x + \pi)</span></span>
<span id="cb950-17"><a href="translation.html#cb950-17" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(<span class="fu">log</span>(x[i]<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb950-18"><a href="translation.html#cb950-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \log(x_i^2)</span></span>
<span id="cb950-19"><a href="translation.html#cb950-19" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(<span class="fu">sin</span>(sin))</span>
<span id="cb950-20"><a href="translation.html#cb950-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \sin(sin)</span></span></code></pre></div>
</div>
<div id="unknown-functions" class="section level3" number="21.3.7">
<h3><span class="header-section-number">21.3.7</span> Unknown functions</h3>
<p>Finally, well add a default for functions that we dont yet know about. We cant know in advance what the unknown funtions will be so we again walk the AST to find them:</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="translation.html#cb951-1" aria-hidden="true" tabindex="-1"></a>all_calls_rec <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb951-2"><a href="translation.html#cb951-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">switch_expr</span>(x,</span>
<span id="cb951-3"><a href="translation.html#cb951-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">constant =</span> ,</span>
<span id="cb951-4"><a href="translation.html#cb951-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span>   <span class="fu">character</span>(),</span>
<span id="cb951-5"><a href="translation.html#cb951-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">call =</span> {</span>
<span id="cb951-6"><a href="translation.html#cb951-6" aria-hidden="true" tabindex="-1"></a>      fname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(x[[<span class="dv">1</span>]])</span>
<span id="cb951-7"><a href="translation.html#cb951-7" aria-hidden="true" tabindex="-1"></a>      children <span class="ot">&lt;-</span> <span class="fu">flat_map_chr</span>(<span class="fu">as.list</span>(x[<span class="sc">-</span><span class="dv">1</span>]), all_calls)</span>
<span id="cb951-8"><a href="translation.html#cb951-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(fname, children)</span>
<span id="cb951-9"><a href="translation.html#cb951-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb951-10"><a href="translation.html#cb951-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb951-11"><a href="translation.html#cb951-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb951-12"><a href="translation.html#cb951-12" aria-hidden="true" tabindex="-1"></a>all_calls <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb951-13"><a href="translation.html#cb951-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(<span class="fu">all_calls_rec</span>(x))</span>
<span id="cb951-14"><a href="translation.html#cb951-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb951-15"><a href="translation.html#cb951-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb951-16"><a href="translation.html#cb951-16" aria-hidden="true" tabindex="-1"></a><span class="fu">all_calls</span>(<span class="fu">expr</span>(<span class="fu">f</span>(g <span class="sc">+</span> b, c, <span class="fu">d</span>(a))))</span>
<span id="cb951-17"><a href="translation.html#cb951-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;f&quot; &quot;+&quot; &quot;d&quot;</span></span></code></pre></div>
<p>We need a closure that will generate the functions for each unknown call:</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb952-1"><a href="translation.html#cb952-1" aria-hidden="true" tabindex="-1"></a>unknown_op <span class="ot">&lt;-</span> <span class="cf">function</span>(op) {</span>
<span id="cb952-2"><a href="translation.html#cb952-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb952-3"><a href="translation.html#cb952-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">... =</span> ),</span>
<span id="cb952-4"><a href="translation.html#cb952-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>({</span>
<span id="cb952-5"><a href="translation.html#cb952-5" aria-hidden="true" tabindex="-1"></a>      contents <span class="ot">&lt;-</span> <span class="fu">paste</span>(..., <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb952-6"><a href="translation.html#cb952-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="sc">!!</span><span class="fu">paste0</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">mathrm{&quot;</span>, op, <span class="st">&quot;}(&quot;</span>), contents, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb952-7"><a href="translation.html#cb952-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb952-8"><a href="translation.html#cb952-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb952-9"><a href="translation.html#cb952-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb952-10"><a href="translation.html#cb952-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unknown_op</span>(<span class="st">&quot;foo&quot;</span>)</span>
<span id="cb952-11"><a href="translation.html#cb952-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (...) </span></span>
<span id="cb952-12"><a href="translation.html#cb952-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb952-13"><a href="translation.html#cb952-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     contents &lt;- paste(..., collapse = &quot;, &quot;)</span></span>
<span id="cb952-14"><a href="translation.html#cb952-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     paste0(&quot;\\mathrm{foo}(&quot;, contents, &quot;)&quot;)</span></span>
<span id="cb952-15"><a href="translation.html#cb952-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb952-16"><a href="translation.html#cb952-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x55aab6c040b0&gt;</span></span></code></pre></div>
<p>And again we update <code>latex_env()</code>:</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="translation.html#cb953-1" aria-hidden="true" tabindex="-1"></a>latex_env <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb953-2"><a href="translation.html#cb953-2" aria-hidden="true" tabindex="-1"></a>  calls <span class="ot">&lt;-</span> <span class="fu">all_calls</span>(expr)</span>
<span id="cb953-3"><a href="translation.html#cb953-3" aria-hidden="true" tabindex="-1"></a>  call_list <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">set_names</span>(calls), unknown_op)</span>
<span id="cb953-4"><a href="translation.html#cb953-4" aria-hidden="true" tabindex="-1"></a>  call_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(call_list)</span>
<span id="cb953-5"><a href="translation.html#cb953-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-6"><a href="translation.html#cb953-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Known functions</span></span>
<span id="cb953-7"><a href="translation.html#cb953-7" aria-hidden="true" tabindex="-1"></a>  f_env <span class="ot">&lt;-</span> <span class="fu">env_clone</span>(f_env, call_env)</span>
<span id="cb953-8"><a href="translation.html#cb953-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-9"><a href="translation.html#cb953-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Default symbols</span></span>
<span id="cb953-10"><a href="translation.html#cb953-10" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">&lt;-</span> <span class="fu">all_names</span>(expr)</span>
<span id="cb953-11"><a href="translation.html#cb953-11" aria-hidden="true" tabindex="-1"></a>  symbol_env <span class="ot">&lt;-</span> <span class="fu">as_environment</span>(<span class="fu">set_names</span>(names), <span class="at">parent =</span> f_env)</span>
<span id="cb953-12"><a href="translation.html#cb953-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb953-13"><a href="translation.html#cb953-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Known symbols</span></span>
<span id="cb953-14"><a href="translation.html#cb953-14" aria-hidden="true" tabindex="-1"></a>  greek_env <span class="ot">&lt;-</span> <span class="fu">env_clone</span>(greek_env, <span class="at">parent =</span> symbol_env)</span>
<span id="cb953-15"><a href="translation.html#cb953-15" aria-hidden="true" tabindex="-1"></a>  greek_env</span>
<span id="cb953-16"><a href="translation.html#cb953-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This completes our original requirements:</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="translation.html#cb954-1" aria-hidden="true" tabindex="-1"></a><span class="fu">to_math</span>(<span class="fu">sin</span>(pi) <span class="sc">+</span> <span class="fu">f</span>(a))</span>
<span id="cb954-2"><a href="translation.html#cb954-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;LATEX&gt; \sin(\pi) + \mathrm{f}(a)</span></span></code></pre></div>
<p>You could certainly take this idea further and translate types of mathematical expression, but you should not need any additional metaprogramming tools.</p>
</div>
<div id="exercises-67" class="section level3" number="21.3.8">
<h3><span class="header-section-number">21.3.8</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Add escaping. The special symbols that should be escaped by adding a backslash
in front of them are <code>\</code>, <code>$</code>, and <code>%</code>. Just as with HTML, youll need to
make sure you dont end up double-escaping. So youll need to create a small
S3 class and then use that in function operators. That will also allow you
to embed arbitrary LaTeX if needed.</p></li>
<li><p>Complete the DSL to support all the functions that <code>plotmath</code> supports.</p></li>
</ol>

</div>
</div>
</div>



<div class="footnotes">
<hr />
<ol start="106">
<li id="fn106"><p>Martin Fowler, <em>Domain-Specific Languages</em> (Pearson Education, 2010), <a href="http://amzn.com/0321712943" role="doc-biblioref">http://amzn.com/0321712943</a>.<a href="translation.html#fnref106" class="footnote-back"></a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="evaluation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="techniques.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Translation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
