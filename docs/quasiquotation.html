<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>19 Quasiquotation | Advanced R</title>
  <meta name="description" content="19 Quasiquotation | Advanced R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="19 Quasiquotation | Advanced R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19 Quasiquotation | Advanced R" />
  
  
  

<meta name="author" content="Hadley Wickham" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="expressions.html"/>
<link rel="next" href="evaluation.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141212623-1');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a>
<ul>
<li class="chapter" data-level="2.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Missing values</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercion"><i class="fa fa-check"></i><b>3.2.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.2.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#durations"><i class="fa fa-check"></i><b>3.4.4</b> Durations</a></li>
<li class="chapter" data-level="3.4.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#subsetting-oob"><i class="fa fa-check"></i><b>4.3.3</b> Missing and out-of-bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samples-and-bootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples and bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character )</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-versus-sets-logical-and-integer"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra versus sets (logical and integer )</a></li>
<li class="chapter" data-level="4.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control flow</a>
<ul>
<li class="chapter" data-level="5.1" data-path="control-flow.html"><a href="control-flow.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-flow.html"><a href="control-flow.html#choices"><i class="fa fa-check"></i><b>5.2</b> Choices</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="control-flow.html"><a href="control-flow.html#invalid-inputs"><i class="fa fa-check"></i><b>5.2.1</b> Invalid inputs</a></li>
<li class="chapter" data-level="5.2.2" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i><b>5.2.2</b> Vectorised if</a></li>
<li class="chapter" data-level="5.2.3" data-path="control-flow.html"><a href="control-flow.html#switch"><i class="fa fa-check"></i><b>5.2.3</b> <code>switch()</code> statement</a></li>
<li class="chapter" data-level="5.2.4" data-path="control-flow.html"><a href="control-flow.html#exercises-12"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i><b>5.3.1</b> Common pitfalls</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-flow.html"><a href="control-flow.html#for-family"><i class="fa fa-check"></i><b>5.3.2</b> Related tools</a></li>
<li class="chapter" data-level="5.3.3" data-path="control-flow.html"><a href="control-flow.html#exercises-13"><i class="fa fa-check"></i><b>5.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-flow.html"><a href="control-flow.html#control-flow-answers"><i class="fa fa-check"></i><b>5.4</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#fun-components"><i class="fa fa-check"></i><b>6.2.1</b> Function components</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.2</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.3</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.2.4</b> Invoking a function</a></li>
<li class="chapter" data-level="6.2.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>6.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>6.3</b> Function composition</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.4</b> Lexical scoping</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.4.1</b> Name masking</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#functions-versus-variables"><i class="fa fa-check"></i><b>6.4.2</b> Functions versus variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.4.5" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.5</b> Lazy evaluation</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.5.1</b> Promises</a></li>
<li class="chapter" data-level="6.5.2" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.5.2</b> Default arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.5.3</b> Missing arguments</a></li>
<li class="chapter" data-level="6.5.4" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>6.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>6.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.7</b> Exiting a function</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#implicit-versus-explicit-returns"><i class="fa fa-check"></i><b>6.7.1</b> Implicit versus explicit returns</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#invisible"><i class="fa fa-check"></i><b>6.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.7.3</b> Errors</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.7.5" data-path="functions.html"><a href="functions.html#exercises-18"><i class="fa fa-check"></i><b>6.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.8</b> Function forms</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#prefix-transform"><i class="fa fa-check"></i><b>6.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>6.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="6.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.8.5</b> Special forms</a></li>
<li class="chapter" data-level="6.8.6" data-path="functions.html"><a href="functions.html#exercises-19"><i class="fa fa-check"></i><b>6.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a>
<ul>
<li class="chapter" data-level="7.1" data-path="environments.html"><a href="environments.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#super-assignment--"><i class="fa fa-check"></i><b>7.2.4</b> Super assignment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>7.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#iteration-versus-recursion"><i class="fa fa-check"></i>Iteration versus recursion</a></li>
<li class="chapter" data-level="7.3.1" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#special-environments"><i class="fa fa-check"></i><b>7.4</b> Special environments</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="environments.html"><a href="environments.html#exercises-22"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>7.5</b> Call stacks</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-stack"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-call-stack"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="environments.html"><a href="environments.html#exercises-23"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditions.html"><a href="conditions.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-6"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="8.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="conditions.html"><a href="conditions.html#exercises-26"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="conditions.html"><a href="conditions.html#exercises-27"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a>
<ul>
<li class="chapter" data-level="9.1" data-path="functionals.html"><a href="functionals.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#map-atomic"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#purrr-shortcuts"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#map-variants"><i class="fa fa-check"></i><b>9.4</b> Map variants</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce family</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="functionals.html"><a href="functionals.html#basics-1"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#base-functionals"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#mathematical-concerns"><i class="fa fa-check"></i><b>9.7.2</b> Mathematical concerns</a></li>
<li class="chapter" data-level="9.7.3" data-path="functionals.html"><a href="functionals.html#exercises-31"><i class="fa fa-check"></i><b>9.7.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a>
<ul>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i><b>10.2.3</b> Forcing evaluation</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.4</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.5</b> Garbage collection</a></li>
<li class="chapter" data-level="10.2.6" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> <code>ggsave()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-34"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="function-factories.html"><a href="function-factories.html#exercises-35"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a>
<ul>
<li class="chapter" data-level="11.1" data-path="function-operators.html"><a href="function-operators.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing function operators</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="function-operators.html"><a href="function-operators.html#exercises-36"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: Creating your own function operators</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="function-operators.html"><a href="function-operators.html#exercises-37"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object-oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a>
<ul>
<li class="chapter" data-level="12.1" data-path="base-types.html"><a href="base-types.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base versus OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a>
<ul>
<li class="chapter" data-level="13.1" data-path="s3.html"><a href="s3.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="s3.html"><a href="s3.html#exercises-38"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constructor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="s3.html"><a href="s3.html#exercises-42"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="s3.html"><a href="s3.html#exercises-43"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a>
<ul>
<li class="chapter" data-level="14.1" data-path="r6.html"><a href="r6.html#introduction-13"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#r6-important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="r6.html"><a href="r6.html#exercises-44"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="r6.html"><a href="r6.html#exercises-45"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="r6.html"><a href="r6.html#exercises-46"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a>
<ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-14"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#inheritance-1"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.2</b> Introspection</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.3</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.4</b> Helper</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.5</b> Validator</a></li>
<li class="chapter" data-level="15.3.6" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#exercises-49"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="s4.html"><a href="s4.html#exercises-50"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="s4.html"><a href="s4.html#exercises-51"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a>
<ul>
<li class="chapter" data-level="16.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-15"><i class="fa fa-check"></i><b>16.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 versus S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 versus S3</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="metaprogramming.html"><a href="metaprogramming.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="17" data-path="meta-big-picture.html"><a href="meta-big-picture.html"><i class="fa fa-check"></i><b>17</b> Big picture</a>
<ul>
<li class="chapter" data-level="17.1" data-path="meta-big-picture.html"><a href="meta-big-picture.html#introduction-16"><i class="fa fa-check"></i><b>17.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-data"><i class="fa fa-check"></i><b>17.2</b> Code is data</a></li>
<li class="chapter" data-level="17.3" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-tree"><i class="fa fa-check"></i><b>17.3</b> Code is a tree</a></li>
<li class="chapter" data-level="17.4" data-path="meta-big-picture.html"><a href="meta-big-picture.html#coding-code"><i class="fa fa-check"></i><b>17.4</b> Code can generate code</a></li>
<li class="chapter" data-level="17.5" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-intro"><i class="fa fa-check"></i><b>17.5</b> Evaluation runs code</a></li>
<li class="chapter" data-level="17.6" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-funs"><i class="fa fa-check"></i><b>17.6</b> Customising evaluation with functions</a></li>
<li class="chapter" data-level="17.7" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-data"><i class="fa fa-check"></i><b>17.7</b> Customising evaluation with data</a></li>
<li class="chapter" data-level="17.8" data-path="meta-big-picture.html"><a href="meta-big-picture.html#quosure-intro"><i class="fa fa-check"></i><b>17.8</b> Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#introduction-17"><i class="fa fa-check"></i><b>18.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#ast"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#drawing"><i class="fa fa-check"></i><b>18.2.1</b> Drawing</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#non-code-components"><i class="fa fa-check"></i><b>18.2.2</b> Non-code components</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#infix-calls"><i class="fa fa-check"></i><b>18.2.3</b> Infix calls</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#expression-details"><i class="fa fa-check"></i><b>18.3</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.3.1</b> Constants</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.3.2</b> Symbols</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.3</b> Calls</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>18.3.4</b> Summary</a></li>
<li class="chapter" data-level="18.3.5" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>18.4</b> Parsing and grammar</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.4.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.4.2</b> Associativity</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#parsing"><i class="fa fa-check"></i><b>18.4.3</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="18.4.4" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>18.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Walking AST with recursive functions</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="expressions.html"><a href="expressions.html#exercises-55"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#expression-special"><i class="fa fa-check"></i><b>18.6</b> Specialised data structures</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.6.1</b> Pairlists</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#empty-symbol"><i class="fa fa-check"></i><b>18.6.2</b> Missing arguments</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#expression-vectors"><i class="fa fa-check"></i><b>18.6.3</b> Expression vectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a>
<ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-18"><i class="fa fa-check"></i><b>19.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#related-work"><i class="fa fa-check"></i>Related work</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-motivation"><i class="fa fa-check"></i><b>19.2</b> Motivation</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-56"><i class="fa fa-check"></i><b>19.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quoting"><i class="fa fa-check"></i><b>19.3</b> Quoting</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-expressions"><i class="fa fa-check"></i><b>19.3.1</b> Capturing expressions</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-symbols"><i class="fa fa-check"></i><b>19.3.2</b> Capturing symbols</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.3</b> With base R</a></li>
<li class="chapter" data-level="19.3.4" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i><b>19.3.4</b> Substitution</a></li>
<li class="chapter" data-level="19.3.5" data-path="quasiquotation.html"><a href="quasiquotation.html#summary-1"><i class="fa fa-check"></i><b>19.3.5</b> Summary</a></li>
<li class="chapter" data-level="19.3.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting"><i class="fa fa-check"></i><b>19.4</b> Unquoting</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-one-argument"><i class="fa fa-check"></i><b>19.4.1</b> Unquoting one argument</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-a-function"><i class="fa fa-check"></i><b>19.4.2</b> Unquoting a function</a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-missing"><i class="fa fa-check"></i><b>19.4.3</b> Unquoting a missing argument</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-in-special-forms"><i class="fa fa-check"></i><b>19.4.4</b> Unquoting in special forms</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-many-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Unquoting many arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.6</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.7" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-ast"><i class="fa fa-check"></i><b>19.4.7</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.8" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>19.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#base-nonquote"><i class="fa fa-check"></i><b>19.5</b> Non-quoting</a></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#tidy-dots"><i class="fa fa-check"></i><b>19.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#examples"><i class="fa fa-check"></i><b>19.6.1</b> Examples</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exec"><i class="fa fa-check"></i><b>19.6.2</b> <code>exec()</code></a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#do-call"><i class="fa fa-check"></i><b>19.6.4</b> With base R</a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#expr-case-studies"><i class="fa fa-check"></i><b>19.7</b> Case studies</a>
<ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#lobstrast"><i class="fa fa-check"></i><b>19.7.1</b> <code>lobstr::ast()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.7.2</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.7.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#new-function"><i class="fa fa-check"></i><b>19.7.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-60"><i class="fa fa-check"></i><b>19.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="quasiquotation.html"><a href="quasiquotation.html#history"><i class="fa fa-check"></i><b>19.8</b> History</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a>
<ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-19"><i class="fa fa-check"></i><b>20.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-13"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#exercises-61"><i class="fa fa-check"></i><b>20.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#creating"><i class="fa fa-check"></i><b>20.3.1</b> Creating</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.2</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#quosure-dots"><i class="fa fa-check"></i><b>20.3.3</b> Dots</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#quosure-impl"><i class="fa fa-check"></i><b>20.3.4</b> Under the hood</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#nested-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Nested quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4</b> Data masks</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#basics-3"><i class="fa fa-check"></i><b>20.4.1</b> Basics</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#pronouns"><i class="fa fa-check"></i><b>20.4.2</b> Pronouns</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-transform"><i class="fa fa-check"></i><b>20.4.4</b> Application: transform</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#select"><i class="fa fa-check"></i><b>20.4.5</b> Application: <code>select()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.5</b> Using tidy evaluation</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#quoting-and-unquoting"><i class="fa fa-check"></i><b>20.5.1</b> Quoting and unquoting</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i><b>20.5.2</b> Handling ambiguity</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#quoting-and-ambiguity"><i class="fa fa-check"></i><b>20.5.3</b> Quoting and ambiguity</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#exercises-64"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluation.html"><a href="evaluation.html#base-evaluation"><i class="fa fa-check"></i><b>20.6</b> Base evaluation</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i><b>20.6.1</b> <code>substitute()</code></a></li>
<li class="chapter" data-level="20.6.2" data-path="evaluation.html"><a href="evaluation.html#match.call"><i class="fa fa-check"></i><b>20.6.2</b> <code>match.call()</code></a></li>
<li class="chapter" data-level="20.6.3" data-path="evaluation.html"><a href="evaluation.html#exercises-65"><i class="fa fa-check"></i><b>20.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a>
<ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#introduction-20"><i class="fa fa-check"></i><b>21.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prerequisites-14"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#html-env"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#exercises-66"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code>()</a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="translation.html"><a href="translation.html#exercises-67"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="" data-path="techniques.html"><a href="techniques.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a>
<ul>
<li class="chapter" data-level="22.1" data-path="debugging.html"><a href="debugging.html#introduction-21"><i class="fa fa-check"></i><b>22.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-20"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-strategy"><i class="fa fa-check"></i><b>22.2</b> Overall approach</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>22.3</b> Locating errors</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#debug-lazy"><i class="fa fa-check"></i><b>22.3.1</b> Lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="debugging.html"><a href="debugging.html#browser"><i class="fa fa-check"></i><b>22.4</b> Interactive debugger</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="debugging.html"><a href="debugging.html#browser-commands"><i class="fa fa-check"></i><b>22.4.1</b> <code>browser()</code> commands</a></li>
<li class="chapter" data-level="22.4.2" data-path="debugging.html"><a href="debugging.html#alternatives"><i class="fa fa-check"></i><b>22.4.2</b> Alternatives</a></li>
<li class="chapter" data-level="22.4.3" data-path="debugging.html"><a href="debugging.html#debug-compiled"><i class="fa fa-check"></i><b>22.4.3</b> Compiled code</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="debugging.html"><a href="debugging.html#non-interactive-debugging"><i class="fa fa-check"></i><b>22.5</b> Non-interactive debugging</a>
<ul>
<li class="chapter" data-level="22.5.1" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>22.5.1</b> <code>dump.frames()</code></a></li>
<li class="chapter" data-level="22.5.2" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>22.5.2</b> Print debugging</a></li>
<li class="chapter" data-level="22.5.3" data-path="debugging.html"><a href="debugging.html#rmarkdown"><i class="fa fa-check"></i><b>22.5.3</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="debugging.html"><a href="debugging.html#non-error-failures"><i class="fa fa-check"></i><b>22.6</b> Non-error failures</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="perf-measure.html"><a href="perf-measure.html"><i class="fa fa-check"></i><b>23</b> Measuring performance</a>
<ul>
<li class="chapter" data-level="23.1" data-path="perf-measure.html"><a href="perf-measure.html#introduction-22"><i class="fa fa-check"></i><b>23.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#outline-21"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#prerequisites-15"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="perf-measure.html"><a href="perf-measure.html#profiling"><i class="fa fa-check"></i><b>23.2</b> Profiling</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="perf-measure.html"><a href="perf-measure.html#visualising-profiles"><i class="fa fa-check"></i><b>23.2.1</b> Visualising profiles</a></li>
<li class="chapter" data-level="23.2.2" data-path="perf-measure.html"><a href="perf-measure.html#memory-profiling"><i class="fa fa-check"></i><b>23.2.2</b> Memory profiling</a></li>
<li class="chapter" data-level="23.2.3" data-path="perf-measure.html"><a href="perf-measure.html#limitations"><i class="fa fa-check"></i><b>23.2.3</b> Limitations</a></li>
<li class="chapter" data-level="23.2.4" data-path="perf-measure.html"><a href="perf-measure.html#exercises-68"><i class="fa fa-check"></i><b>23.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="perf-measure.html"><a href="perf-measure.html#microbenchmarking"><i class="fa fa-check"></i><b>23.3</b> Microbenchmarking</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="perf-measure.html"><a href="perf-measure.html#benchmark-results"><i class="fa fa-check"></i><b>23.3.1</b> <code>bench::mark()</code> results</a></li>
<li class="chapter" data-level="23.3.2" data-path="perf-measure.html"><a href="perf-measure.html#interpreting-results"><i class="fa fa-check"></i><b>23.3.2</b> Interpreting results</a></li>
<li class="chapter" data-level="23.3.3" data-path="perf-measure.html"><a href="perf-measure.html#exercises-69"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="perf-improve.html"><a href="perf-improve.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a>
<ul>
<li class="chapter" data-level="24.1" data-path="perf-improve.html"><a href="perf-improve.html#introduction-23"><i class="fa fa-check"></i><b>24.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#outline-22"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#prerequisites-16"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="perf-improve.html"><a href="perf-improve.html#code-organisation"><i class="fa fa-check"></i><b>24.2</b> Code organisation</a></li>
<li class="chapter" data-level="24.3" data-path="perf-improve.html"><a href="perf-improve.html#already-solved"><i class="fa fa-check"></i><b>24.3</b> Checking for existing solutions</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-70"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="perf-improve.html"><a href="perf-improve.html#be-lazy"><i class="fa fa-check"></i><b>24.4</b> Doing as little as possible</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="perf-improve.html"><a href="perf-improve.html#mean"><i class="fa fa-check"></i><b>24.4.1</b> <code>mean()</code></a></li>
<li class="chapter" data-level="24.4.2" data-path="perf-improve.html"><a href="perf-improve.html#as.data.frame"><i class="fa fa-check"></i><b>24.4.2</b> <code>as.data.frame()</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="perf-improve.html"><a href="perf-improve.html#exercises-71"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="perf-improve.html"><a href="perf-improve.html#vectorise"><i class="fa fa-check"></i><b>24.5</b> Vectorise</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-72"><i class="fa fa-check"></i><b>24.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="perf-improve.html"><a href="perf-improve.html#avoid-copies"><i class="fa fa-check"></i><b>24.6</b> Avoiding copies</a></li>
<li class="chapter" data-level="24.7" data-path="perf-improve.html"><a href="perf-improve.html#t-test"><i class="fa fa-check"></i><b>24.7</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.8" data-path="perf-improve.html"><a href="perf-improve.html#more-techniques"><i class="fa fa-check"></i><b>24.8</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rcpp.html"><a href="rcpp.html#introduction-24"><i class="fa fa-check"></i><b>25.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-23"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequisites-17"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.5</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#exercise-started"><i class="fa fa-check"></i><b>25.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Other classes</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="rcpp.html"><a href="rcpp.html#attributes-1"><i class="fa fa-check"></i><b>25.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-73"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.5</b> Standard Template Library</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.5.3</b> Data structures</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.5.4</b> Vectors</a></li>
<li class="chapter" data-level="25.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.5.5</b> Sets</a></li>
<li class="chapter" data-level="25.5.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>25.5.6</b> Map</a></li>
<li class="chapter" data-level="25.5.7" data-path="rcpp.html"><a href="rcpp.html#exercises-74"><i class="fa fa-check"></i><b>25.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.6</b> Case studies</a>
<ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-versus-c-vectorisation"><i class="fa fa-check"></i><b>25.6.2</b> R vectorisation versus C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.8</b> Learning more</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.9</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="quasiquotation" class="section level1" number="19">
<h1><span class="header-section-number">19</span> Quasiquotation</h1>
<div id="introduction-18" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> Introduction</h2>
<p>Now that you understand the tree structure of R code, it’s time to return to one of the fundamental ideas that make <code>expr()</code> and <code>ast()</code> work: quotation. In tidy evaluation, all quoting functions are actually quasiquoting functions because they also support unquoting. Where quotation is the act of capturing an unevaluated expression, <strong>unquotation</strong> is the ability to selectively evaluate parts of an otherwise quoted expression. Together, this is called quasiquotation. Quasiquotation makes it easy to create functions that combine code written by the function’s author with code written by the function’s user. This helps to solve a wide variety of challenging problems.</p>
<p>Quasiquotation is one of the three pillars of tidy evaluation. You’ll learn about the other two (quosures and the data mask) in Chapter <a href="evaluation.html#evaluation">20</a>. When used alone, quasiquotation is most useful for programming, particularly for generating code. But when it’s combined with the other techniques, tidy evaluation becomes a powerful tool for data analysis.</p>
<div id="outline-17" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="quasiquotation.html#quasi-motivation">19.2</a> motivates the development of quasiquotation
with a function, <code>cement()</code>, that works like <code>paste()</code> but automatically
quotes its arguments so that you don’t have to.</p></li>
<li><p>Section <a href="quasiquotation.html#quoting">19.3</a> gives you the tools to quote expressions, whether
they come from you or the user, or whether you use rlang or base R tools.</p></li>
<li><p>Section <a href="quasiquotation.html#unquoting">19.4</a> introduces the biggest difference between rlang
quoting functions and base quoting function: unquoting with <code>!!</code> and <code>!!!</code>.</p></li>
<li><p>Section <a href="quasiquotation.html#base-nonquote">19.5</a> discusses the three main non-quoting
techniques that base R functions uses to disable quoting behaviour.</p></li>
<li><p>Section <a href="quasiquotation.html#tidy-dots">19.6</a> explores another place that you can use <code>!!!</code>,
functions that take <code>...</code>. It also introduces the special <code>:=</code> operator,
which allows you to dynamically change argument names.</p></li>
<li><p>Section <a href="quasiquotation.html#expr-case-studies">19.7</a> shows a few practical uses of quoting to solve
problems that naturally require some code generation.</p></li>
<li><p>Section <a href="quasiquotation.html#history">19.8</a> finishes up with a little history of quasiquotation
for those who are interested.</p></li>
</ul>
</div>
<div id="prerequisites-12" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>Make sure you’ve read the metaprogramming overview in Chapter <a href="meta-big-picture.html#meta-big-picture">17</a> to get a broad overview of the motivation and the basic vocabulary, and that you’re familiar with the tree structure of expressions as described in Section <a href="expressions.html#expression-details">18.3</a>.</p>
<p>Code-wise, we’ll mostly be using the tools from <a href="https://rlang.r-lib.org">rlang</a>, but at the end of the chapter you’ll also see some powerful applications in conjunction with <a href="https://purrr.tidyverse.org">purrr</a>.</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="quasiquotation.html#cb758-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb758-2"><a href="quasiquotation.html#cb758-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
</div>
<div id="related-work" class="section level3 unnumbered">
<h3>Related work</h3>
<p>
</p>
<p>Quoting functions have deep connections to Lisp <strong>macros</strong>. But macros are usually run at compile-time, which doesn’t exist in R, and they always input and output ASTs. See <span class="citation">Thomas Lumley<a href="#fn95" class="footnote-ref" id="fnref95"><sup>95</sup></a></span> for one approach to implementing them in R. Quoting functions are more closely related to the more esoteric Lisp <a href="http://en.wikipedia.org/wiki/Fexpr"><strong>fexprs</strong></a>, functions where all arguments are quoted by default. These terms are useful to know when looking for related work in other programming languages.</p>
</div>
</div>
<div id="quasi-motivation" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Motivation</h2>
<p>We’ll start with a concrete example that helps motivate the need for unquoting, and hence quasiquotation. Imagine you’re creating a lot of strings by joining together words:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="quasiquotation.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;morning&quot;</span>, <span class="st">&quot;Hadley&quot;</span>)</span>
<span id="cb759-2"><a href="quasiquotation.html#cb759-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></span>
<span id="cb759-3"><a href="quasiquotation.html#cb759-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;afternoon&quot;</span>, <span class="st">&quot;Alice&quot;</span>)</span>
<span id="cb759-4"><a href="quasiquotation.html#cb759-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good afternoon Alice&quot;</span></span></code></pre></div>
<p>You are sick and tired of writing all those quotes, and instead you just want to use bare words. To that end, you’ve written the following function. (Don’t worry about the implementation for now; you’ll learn about the pieces later.)</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="quasiquotation.html#cb760-1" aria-hidden="true" tabindex="-1"></a>cement <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb760-2"><a href="quasiquotation.html#cb760-2" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">ensyms</span>(...)</span>
<span id="cb760-3"><a href="quasiquotation.html#cb760-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(purrr<span class="sc">::</span><span class="fu">map</span>(args, as_string), <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb760-4"><a href="quasiquotation.html#cb760-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb760-5"><a href="quasiquotation.html#cb760-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-6"><a href="quasiquotation.html#cb760-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cement</span>(Good, morning, Hadley)</span>
<span id="cb760-7"><a href="quasiquotation.html#cb760-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></span>
<span id="cb760-8"><a href="quasiquotation.html#cb760-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cement</span>(Good, afternoon, Alice)</span>
<span id="cb760-9"><a href="quasiquotation.html#cb760-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good afternoon Alice&quot;</span></span></code></pre></div>
<p>Formally, this function quotes all of its inputs. You can think of it as automatically putting quotation marks around each argument. That’s not precisely true as the intermediate objects it generates are expressions, not strings, but it’s a useful approximation, and the root meaning of the term “quote.”</p>
<p>This function is nice because we no longer need to type quotation marks. The problem comes when we want to use variables. It’s easy to use variables with <code>paste()</code>: just don’t surround them with quotation marks.</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="quasiquotation.html#cb761-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="st">&quot;Hadley&quot;</span></span>
<span id="cb761-2"><a href="quasiquotation.html#cb761-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="st">&quot;morning&quot;</span></span>
<span id="cb761-3"><a href="quasiquotation.html#cb761-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb761-4"><a href="quasiquotation.html#cb761-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Good&quot;</span>, time, name)</span>
<span id="cb761-5"><a href="quasiquotation.html#cb761-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></span></code></pre></div>
<p>Obviously this doesn’t work with <code>cement()</code> because every input is automatically quoted:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="quasiquotation.html#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cement</span>(Good, time, name)</span>
<span id="cb762-2"><a href="quasiquotation.html#cb762-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good time name&quot;</span></span></code></pre></div>
<p>We need some way to explicitly <em>unquote</em> the input to tell <code>cement()</code> to remove the automatic quote marks. Here we need <code>time</code> and <code>name</code> to be treated differently to <code>Good</code>. Quasiquotation gives us a standard tool to do so: <code>!!</code>, called “unquote,” and pronounced bang-bang. <code>!!</code> tells a quoting function to drop the implicit quotes:</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="quasiquotation.html#cb763-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cement</span>(Good, <span class="sc">!!</span>time, <span class="sc">!!</span>name)</span>
<span id="cb763-2"><a href="quasiquotation.html#cb763-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></span></code></pre></div>
<p>It’s useful to compare <code>cement()</code> and <code>paste()</code> directly. <code>paste()</code> evaluates its arguments, so we must quote where needed; <code>cement()</code> quotes its arguments, so we must unquote where needed.</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="quasiquotation.html#cb764-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Good&quot;</span>, time, name)</span>
<span id="cb764-2"><a href="quasiquotation.html#cb764-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cement</span>(Good, <span class="sc">!!</span>time, <span class="sc">!!</span>name)</span></code></pre></div>
<div id="vocabulary" class="section level3" number="19.2.1">
<h3><span class="header-section-number">19.2.1</span> Vocabulary</h3>
<p>
</p>
<p>The distinction between quoted and evaluated arguments is important:</p>
<ul>
<li><p>An <strong>evaluated</strong> argument obeys R’s usual evaluation rules.</p></li>
<li><p>A <strong>quoted</strong> argument is captured by the function, and is processed in
some custom way.</p></li>
</ul>
<p><code>paste()</code> evaluates all its arguments; <code>cement()</code> quotes all its arguments.</p>
<p>If you’re ever unsure about whether an argument is quoted or evaluated, try executing the code outside of the function. If it doesn’t work or does something different, then that argument is quoted. For example, you can use this technique to determine that the first argument to <code>library()</code> is quoted:</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="quasiquotation.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="co"># works</span></span>
<span id="cb765-2"><a href="quasiquotation.html#cb765-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb765-3"><a href="quasiquotation.html#cb765-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-4"><a href="quasiquotation.html#cb765-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fails</span></span>
<span id="cb765-5"><a href="quasiquotation.html#cb765-5" aria-hidden="true" tabindex="-1"></a>MASS</span>
<span id="cb765-6"><a href="quasiquotation.html#cb765-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;MASS&#39; not found</span></span></code></pre></div>
<p>Talking about whether an argument is quoted or evaluated is a more precise way of stating whether or not a function uses non-standard evaluation (NSE). I will sometimes use “quoting function” as short-hand for a function that quotes one or more arguments, but generally, I’ll talk about quoted arguments since that is the level at which the difference applies.</p>
</div>
<div id="exercises-56" class="section level3" number="19.2.2">
<h3><span class="header-section-number">19.2.2</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>For each function in the following base R code, identify which arguments
are quoted and which are evaluated.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="quasiquotation.html#cb766-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb766-2"><a href="quasiquotation.html#cb766-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb766-3"><a href="quasiquotation.html#cb766-3" aria-hidden="true" tabindex="-1"></a>mtcars2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(mtcars, cyl <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb766-4"><a href="quasiquotation.html#cb766-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb766-5"><a href="quasiquotation.html#cb766-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(mtcars2, <span class="fu">sum</span>(vs))</span>
<span id="cb766-6"><a href="quasiquotation.html#cb766-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(mtcars2<span class="sc">$</span>am)</span>
<span id="cb766-7"><a href="quasiquotation.html#cb766-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb766-8"><a href="quasiquotation.html#cb766-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(mtcars2)</span></code></pre></div></li>
<li><p>For each function in the following tidyverse code, identify which arguments
are quoted and which are evaluated.</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="quasiquotation.html#cb767-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb767-2"><a href="quasiquotation.html#cb767-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb767-3"><a href="quasiquotation.html#cb767-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-4"><a href="quasiquotation.html#cb767-4" aria-hidden="true" tabindex="-1"></a>by_cyl <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb767-5"><a href="quasiquotation.html#cb767-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb767-6"><a href="quasiquotation.html#cb767-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(mpg))</span>
<span id="cb767-7"><a href="quasiquotation.html#cb767-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-8"><a href="quasiquotation.html#cb767-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(by_cyl, <span class="fu">aes</span>(cyl, mean)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div></li>
</ol>
</div>
</div>
<div id="quoting" class="section level2" number="19.3">
<h2><span class="header-section-number">19.3</span> Quoting</h2>
<p></p>
<p>The first part of quasiquotation is quotation: capturing an expression without evaluating it. We’ll need a pair of functions because the expression can be supplied directly or indirectly, via lazily-evaluated function argument. I’ll start with the rlang quoting functions, then circle back to those provided by base R.</p>
<div id="capturing-expressions" class="section level3" number="19.3.1">
<h3><span class="header-section-number">19.3.1</span> Capturing expressions</h3>
<p>

</p>
<p>There are four important quoting functions. For interactive exploration, the most important is <code>expr()</code>, which captures its argument exactly as provided:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="quasiquotation.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(x <span class="sc">+</span> y)</span>
<span id="cb768-2"><a href="quasiquotation.html#cb768-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x + y</span></span>
<span id="cb768-3"><a href="quasiquotation.html#cb768-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb768-4"><a href="quasiquotation.html#cb768-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1/2/3</span></span></code></pre></div>
<p>(Remember that white space and comments are not part of the expression, so will not be captured by a quoting function.)</p>
<p><code>expr()</code> is great for interactive exploration, because it captures what you, the developer, typed. It’s not so useful inside a function:</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="quasiquotation.html#cb769-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">expr</span>(x)</span>
<span id="cb769-2"><a href="quasiquotation.html#cb769-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span>
<span id="cb769-3"><a href="quasiquotation.html#cb769-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x</span></span></code></pre></div>
<p>We need another function to solve this problem: <code>enexpr()</code>. This captures what the caller supplied to the function by looking at the internal promise object that powers lazy evaluation (Section <a href="functions.html#promises">6.5.1</a>).</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="quasiquotation.html#cb770-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">enexpr</span>(x)</span>
<span id="cb770-2"><a href="quasiquotation.html#cb770-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span>
<span id="cb770-3"><a href="quasiquotation.html#cb770-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a + b + c</span></span></code></pre></div>
<p>(It’s called “en”-<code>expr()</code> by analogy to enrich. Enriching someone makes them richer; <code>enexpr()</code>ing a argument makes it an expression.)</p>
<p>To capture all arguments in <code>...</code>, use <code>enexprs()</code>.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="quasiquotation.html#cb771-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">enexprs</span>(...)</span>
<span id="cb771-2"><a href="quasiquotation.html#cb771-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">10</span> <span class="sc">*</span> z)</span>
<span id="cb771-3"><a href="quasiquotation.html#cb771-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $x</span></span>
<span id="cb771-4"><a href="quasiquotation.html#cb771-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb771-5"><a href="quasiquotation.html#cb771-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb771-6"><a href="quasiquotation.html#cb771-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $y</span></span>
<span id="cb771-7"><a href="quasiquotation.html#cb771-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 * z</span></span></code></pre></div>
<p>Finally, <code>exprs()</code> is useful interactively to make a list of expressions:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="quasiquotation.html#cb772-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exprs</span>(<span class="at">x =</span> x <span class="sc">^</span> <span class="dv">2</span>, <span class="at">y =</span> y <span class="sc">^</span> <span class="dv">3</span>, <span class="at">z =</span> z <span class="sc">^</span> <span class="dv">4</span>)</span>
<span id="cb772-2"><a href="quasiquotation.html#cb772-2" aria-hidden="true" tabindex="-1"></a><span class="co"># shorthand for</span></span>
<span id="cb772-3"><a href="quasiquotation.html#cb772-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list(x = expr(x ^ 2), y = expr(y ^ 3), z = expr(z ^ 4))</span></span></code></pre></div>
<p>In short, use <code>enexpr()</code> and <code>enexprs()</code> to capture the expressions supplied as arguments <em>by the user</em>. Use <code>expr()</code> and <code>exprs()</code> to capture expressions that <em>you</em> supply.</p>
</div>
<div id="capturing-symbols" class="section level3" number="19.3.2">
<h3><span class="header-section-number">19.3.2</span> Capturing symbols</h3>
<p>
</p>
<p>Sometimes you only want to allow the user to specify a variable name, not an arbitrary expression. In this case, you can use <code>ensym()</code> or <code>ensyms()</code>. These are variants of <code>enexpr()</code> and <code>enexprs()</code> that check the captured expression is either symbol or a string (which is converted to a symbol<a href="#fn96" class="footnote-ref" id="fnref96"><sup>96</sup></a>). <code>ensym()</code> and <code>ensyms()</code> throw an error if given anything else.</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="quasiquotation.html#cb773-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">ensyms</span>(...)</span>
<span id="cb773-2"><a href="quasiquotation.html#cb773-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x)</span>
<span id="cb773-3"><a href="quasiquotation.html#cb773-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb773-4"><a href="quasiquotation.html#cb773-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x</span></span>
<span id="cb773-5"><a href="quasiquotation.html#cb773-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="st">&quot;x&quot;</span>)</span>
<span id="cb773-6"><a href="quasiquotation.html#cb773-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb773-7"><a href="quasiquotation.html#cb773-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x</span></span></code></pre></div>
</div>
<div id="with-base-r" class="section level3" number="19.3.3">
<h3><span class="header-section-number">19.3.3</span> With base R</h3>
<p>
</p>
<p>Each rlang function described above has an equivalent in base R. Their primary difference is that the base equivalents do not support unquoting (which we’ll talk about very soon). This make them quoting functions, rather than quasiquoting functions.</p>
<p>The base equivalent of <code>expr()</code> is <code>quote()</code>:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="quasiquotation.html#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>(x <span class="sc">+</span> y)</span>
<span id="cb774-2"><a href="quasiquotation.html#cb774-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x + y</span></span></code></pre></div>
<p>The base function closest to <code>enexpr()</code> is <code>substitute()</code>:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="quasiquotation.html#cb775-1" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">substitute</span>(x)</span>
<span id="cb775-2"><a href="quasiquotation.html#cb775-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f3</span>(x <span class="sc">+</span> y)</span>
<span id="cb775-3"><a href="quasiquotation.html#cb775-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x + y</span></span></code></pre></div>
<p>The base equivalent to <code>exprs()</code> is <code>alist()</code>:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="quasiquotation.html#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="fu">alist</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> x <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb776-2"><a href="quasiquotation.html#cb776-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $x</span></span>
<span id="cb776-3"><a href="quasiquotation.html#cb776-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb776-4"><a href="quasiquotation.html#cb776-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb776-5"><a href="quasiquotation.html#cb776-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $y</span></span>
<span id="cb776-6"><a href="quasiquotation.html#cb776-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x + 2</span></span></code></pre></div>
<p>The equivalent to <code>enexprs()</code> is an undocumented feature of <code>substitute()</code><a href="#fn97" class="footnote-ref" id="fnref97"><sup>97</sup></a>:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="quasiquotation.html#cb777-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="fu">as.list</span>(<span class="fu">substitute</span>(<span class="fu">...</span>()))</span>
<span id="cb777-2"><a href="quasiquotation.html#cb777-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">10</span> <span class="sc">*</span> z)</span>
<span id="cb777-3"><a href="quasiquotation.html#cb777-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $x</span></span>
<span id="cb777-4"><a href="quasiquotation.html#cb777-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb777-5"><a href="quasiquotation.html#cb777-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb777-6"><a href="quasiquotation.html#cb777-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $y</span></span>
<span id="cb777-7"><a href="quasiquotation.html#cb777-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 * z</span></span></code></pre></div>
<p>There are two other important base quoting functions that we’ll cover elsewhere:</p>
<ul>
<li><p><code>bquote()</code> provides a limited form of quasiquotation, and is discussed in
Section <a href="quasiquotation.html#base-nonquote">19.5</a>.</p></li>
<li><p><code>~</code>, the formula, is a quoting function that also captures the environment.
It’s the inspiration for quosures, the topic of the next chapter, and is
discussed in Section <a href="evaluation.html#quosure-impl">20.3.4</a>.</p></li>
</ul>
</div>
<div id="substitution" class="section level3" number="19.3.4">
<h3><span class="header-section-number">19.3.4</span> Substitution</h3>
<p>You’ll most often see <code>substitute()</code> used to capture unevaluated arguments. However, as well as quoting, <code>substitute()</code> also does substitution (as its name suggests!). If you give it an expression, rather than a symbol, it will substitute in the values of symbols defined in the current environment.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="quasiquotation.html#cb778-1" aria-hidden="true" tabindex="-1"></a>f4 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">substitute</span>(x <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb778-2"><a href="quasiquotation.html#cb778-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f4</span>(a <span class="sc">+</span> b <span class="sc">+</span> c)</span>
<span id="cb778-3"><a href="quasiquotation.html#cb778-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (a + b + c) * 2</span></span></code></pre></div>
<p>I think this makes code hard to understand, because if it is taken out of context, you can’t tell if the goal of <code>substitute(x + y)</code> is to replace <code>x</code>, <code>y</code>, or both. If you do want to use <code>substitute()</code> for substitution, I recommend that you use the second argument to make your goal clear:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="quasiquotation.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substitute</span>(x <span class="sc">*</span> y <span class="sc">*</span> z, <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="fu">quote</span>(a <span class="sc">+</span> b)))</span>
<span id="cb779-2"><a href="quasiquotation.html#cb779-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 * (a + b) * z</span></span></code></pre></div>
</div>
<div id="summary-1" class="section level3" number="19.3.5">
<h3><span class="header-section-number">19.3.5</span> Summary</h3>
<p>When quoting (i.e. capturing code), there are two important distinctions:</p>
<ul>
<li><p>Is it supplied by the developer of the code or the user of the code?
In other words, is it fixed (supplied in the body of the function) or varying (supplied
via an argument)?</p></li>
<li><p>Do you want to capture a single expression or multiple expressions?</p></li>
</ul>
<p>This leads to a 2 <span class="math inline">\(\times\)</span> 2 table of functions for rlang, Table <a href="quasiquotation.html#tab:quoting-rlang">19.1</a>, and for base R, Table <a href="quasiquotation.html#tab:quoting-base">19.2</a>.</p>
<table>
<caption><span id="tab:quoting-rlang">Table 19.1: </span> rlang quasiquoting functions</caption>
<thead>
<tr class="header">
<th></th>
<th>Developer</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One</td>
<td><code>expr()</code></td>
<td><code>enexpr()</code></td>
</tr>
<tr class="even">
<td>Many</td>
<td><code>exprs()</code></td>
<td><code>enexprs()</code></td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:quoting-base">Table 19.2: </span> base R quoting functions</caption>
<thead>
<tr class="header">
<th></th>
<th>Developer</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One</td>
<td><code>quote()</code></td>
<td><code>substitute()</code></td>
</tr>
<tr class="even">
<td>Many</td>
<td><code>alist()</code></td>
<td><code>as.list(substitute(...()))</code></td>
</tr>
</tbody>
</table>
</div>
<div id="exercises-57" class="section level3" number="19.3.6">
<h3><span class="header-section-number">19.3.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How is <code>expr()</code> implemented? Look at its source code.</p></li>
<li><p>Compare and contrast the following two functions. Can you predict the
output before running them?</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="quasiquotation.html#cb780-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb780-2"><a href="quasiquotation.html#cb780-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exprs</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb780-3"><a href="quasiquotation.html#cb780-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb780-4"><a href="quasiquotation.html#cb780-4" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb780-5"><a href="quasiquotation.html#cb780-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enexprs</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb780-6"><a href="quasiquotation.html#cb780-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb780-7"><a href="quasiquotation.html#cb780-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f1</span>(a <span class="sc">+</span> b, c <span class="sc">+</span> d)</span>
<span id="cb780-8"><a href="quasiquotation.html#cb780-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(a <span class="sc">+</span> b, c <span class="sc">+</span> d)</span></code></pre></div></li>
<li><p>What happens if you try to use <code>enexpr()</code> with an expression (i.e. 
<code>enexpr(x + y)</code> ? What happens if <code>enexpr()</code> is passed a missing argument?</p></li>
<li><p>How are <code>exprs(a)</code> and <code>exprs(a = )</code> different? Think about both the
input and the output.</p></li>
<li><p>What are other differences between <code>exprs()</code> and <code>alist()</code>? Read the
documentation for the named arguments of <code>exprs()</code> to find out.</p></li>
<li><p>The documentation for <code>substitute()</code> says:</p>
<blockquote>
<p>Substitution takes place by examining each component of the parse tree
as follows:</p>
<ul>
<li>If it is not a bound symbol in <code>env</code>, it is unchanged.</li>
<li>If it is a promise object (i.e., a formal argument to a function)
the expression slot of the promise replaces the symbol.</li>
<li>If it is an ordinary variable, its value is substituted, unless
<code>env</code> is .GlobalEnv in which case the symbol is left unchanged.</li>
</ul>
</blockquote>
<p>Create examples that illustrate each of the above cases.</p></li>
</ol>
</div>
</div>
<div id="unquoting" class="section level2" number="19.4">
<h2><span class="header-section-number">19.4</span> Unquoting</h2>
<p>

</p>
<p>So far, you’ve only seen relatively small advantages of the rlang quoting functions over the base R quoting functions: they have a more consistent naming scheme. The big difference is that rlang quoting functions are actually quasiquoting functions because they can also unquote.</p>
<p>Unquoting allows you to selectively evaluate parts of the expression that would otherwise be quoted, which effectively allows you to merge ASTs using a template AST. Since base functions don’t use unquoting, they instead use a variety of other techniques, which you’ll learn about in Section <a href="quasiquotation.html#base-nonquote">19.5</a>.</p>
<p>Unquoting is one inverse of quoting. It allows you to selectively evaluate code inside <code>expr()</code>, so that <code>expr(!!x)</code> is equivalent to <code>x</code>. In Chapter <a href="evaluation.html#evaluation">20</a>, you’ll learn about another inverse, evaluation. This happens outside <code>expr()</code>, so that <code>eval(expr(x))</code> is equivalent to <code>x</code>.</p>
<div id="unquoting-one-argument" class="section level3" number="19.4.1">
<h3><span class="header-section-number">19.4.1</span> Unquoting one argument</h3>
<p>Use <code>!!</code> to unquote a single argument in a function call. <code>!!</code> takes a single expression, evaluates it, and inlines the result in the AST.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="quasiquotation.html#cb781-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb781-2"><a href="quasiquotation.html#cb781-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">f</span>(<span class="sc">!!</span>x, y))</span>
<span id="cb781-3"><a href="quasiquotation.html#cb781-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(-1, y)</span></span></code></pre></div>
<p>I think this is easiest to understand with a diagram. <code>!!</code> introduces a placeholder in the AST, shown with dotted borders. Here the placeholder <code>x</code> is replaced by an AST, illustrated by a dotted connection.</p>
<p><img src="diagrams/quotation/bang-bang.png" width="260" style="display: block; margin: auto;" /></p>
<p>As well as call objects, <code>!!</code> also works with symbols and constants:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="quasiquotation.html#cb782-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sym</span>(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb782-2"><a href="quasiquotation.html#cb782-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb782-3"><a href="quasiquotation.html#cb782-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">f</span>(<span class="sc">!!</span>a, <span class="sc">!!</span>b))</span>
<span id="cb782-4"><a href="quasiquotation.html#cb782-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(y, 1)</span></span></code></pre></div>
<p><img src="diagrams/quotation/simple.png" width="226" style="display: block; margin: auto;" /></p>
<p>If the right-hand side of <code>!!</code> is a function call, <code>!!</code> will evaluate it and insert the results:</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="quasiquotation.html#cb783-1" aria-hidden="true" tabindex="-1"></a>mean_rm <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb783-2"><a href="quasiquotation.html#cb783-2" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">ensym</span>(var)</span>
<span id="cb783-3"><a href="quasiquotation.html#cb783-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expr</span>(<span class="fu">mean</span>(<span class="sc">!!</span>var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb783-4"><a href="quasiquotation.html#cb783-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb783-5"><a href="quasiquotation.html#cb783-5" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="sc">!!</span><span class="fu">mean_rm</span>(x) <span class="sc">+</span> <span class="sc">!!</span><span class="fu">mean_rm</span>(y))</span>
<span id="cb783-6"><a href="quasiquotation.html#cb783-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mean(x, na.rm = TRUE) + mean(y, na.rm = TRUE)</span></span></code></pre></div>
<p><code>!!</code> preserves operator precedence because it works with expressions.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="quasiquotation.html#cb784-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">expr</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb784-2"><a href="quasiquotation.html#cb784-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">expr</span>(x <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb784-3"><a href="quasiquotation.html#cb784-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-4"><a href="quasiquotation.html#cb784-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="sc">!!</span>x1 <span class="sc">/</span> <span class="sc">!!</span>x2)</span>
<span id="cb784-5"><a href="quasiquotation.html#cb784-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (x + 1)/(x + 2)</span></span></code></pre></div>
<p><img src="diagrams/quotation/infix.png" width="430" style="display: block; margin: auto;" /></p>
<p>If we simply pasted the text of the expressions together, we’d end up with <code>x + 1 / x + 2</code>, which has a very different AST:</p>
<p><img src="diagrams/quotation/infix-bad.png" width="283" style="display: block; margin: auto;" /></p>
</div>
<div id="unquoting-a-function" class="section level3" number="19.4.2">
<h3><span class="header-section-number">19.4.2</span> Unquoting a function</h3>
<p></p>
<p><code>!!</code> is most commonly used to replace the arguments to a function, but you can also use it to replace the function. The only challenge here is operator precedence: <code>expr(!!f(x, y))</code> unquotes the result of <code>f(x, y)</code>, so you need an extra pair of parentheses.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="quasiquotation.html#cb785-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">expr</span>(foo)</span>
<span id="cb785-2"><a href="quasiquotation.html#cb785-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>((<span class="sc">!!</span>f)(x, y))</span>
<span id="cb785-3"><a href="quasiquotation.html#cb785-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; foo(x, y)</span></span></code></pre></div>
<p>This also works when <code>f</code> is a call:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="quasiquotation.html#cb786-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">expr</span>(pkg<span class="sc">::</span>foo)</span>
<span id="cb786-2"><a href="quasiquotation.html#cb786-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>((<span class="sc">!!</span>f)(x, y))</span>
<span id="cb786-3"><a href="quasiquotation.html#cb786-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; pkg::foo(x, y)</span></span></code></pre></div>
<p><img src="diagrams/quotation/fun.png" width="298" style="display: block; margin: auto;" /></p>
<p>Because of the large number of parentheses involved, it can be clearer to use <code>rlang::call2()</code>:</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="quasiquotation.html#cb787-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">expr</span>(pkg<span class="sc">::</span>foo)</span>
<span id="cb787-2"><a href="quasiquotation.html#cb787-2" aria-hidden="true" tabindex="-1"></a><span class="fu">call2</span>(f, <span class="fu">expr</span>(x), <span class="fu">expr</span>(y))</span>
<span id="cb787-3"><a href="quasiquotation.html#cb787-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; pkg::foo(x, y)</span></span></code></pre></div>
</div>
<div id="unquote-missing" class="section level3" number="19.4.3">
<h3><span class="header-section-number">19.4.3</span> Unquoting a missing argument</h3>
<p>
</p>
<p>Very occasionally it is useful to unquote a missing argument (Section <a href="expressions.html#empty-symbol">18.6.2</a>), but the naive approach doesn’t work:</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="quasiquotation.html#cb788-1" aria-hidden="true" tabindex="-1"></a>arg <span class="ot">&lt;-</span> <span class="fu">missing_arg</span>()</span>
<span id="cb788-2"><a href="quasiquotation.html#cb788-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">foo</span>(<span class="sc">!!</span>arg, <span class="sc">!!</span>arg))</span>
<span id="cb788-3"><a href="quasiquotation.html#cb788-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in enexpr(expr): argument &quot;arg&quot; is missing, with no default</span></span></code></pre></div>
<p>You can work around this with the <code>rlang::maybe_missing()</code> helper:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="quasiquotation.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">foo</span>(<span class="sc">!!</span><span class="fu">maybe_missing</span>(arg), <span class="sc">!!</span><span class="fu">maybe_missing</span>(arg)))</span>
<span id="cb789-2"><a href="quasiquotation.html#cb789-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; foo(, )</span></span></code></pre></div>
</div>
<div id="unquoting-in-special-forms" class="section level3" number="19.4.4">
<h3><span class="header-section-number">19.4.4</span> Unquoting in special forms</h3>
<p>
</p>
<p>There are a few special forms where unquoting is a syntax error. Take <code>$</code> for example: it must always be followed by the name of a variable, not another expression. This means attempting to unquote with <code>$</code> will fail with a syntax error:</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="quasiquotation.html#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(df<span class="sc">$!!</span>x)</span>
<span id="cb790-2"><a href="quasiquotation.html#cb790-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: unexpected &#39;!&#39; in &quot;expr(df$!&quot;</span></span></code></pre></div>
<p>To make unquoting work, you’ll need to use the prefix form (Section <a href="functions.html#prefix-transform">6.8.1</a>):</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="quasiquotation.html#cb791-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">expr</span>(x)</span>
<span id="cb791-2"><a href="quasiquotation.html#cb791-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="st">`</span><span class="at">$</span><span class="st">`</span>(df, <span class="sc">!!</span>x))</span>
<span id="cb791-3"><a href="quasiquotation.html#cb791-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; df$x</span></span></code></pre></div>
</div>
<div id="unquoting-many-arguments" class="section level3" number="19.4.5">
<h3><span class="header-section-number">19.4.5</span> Unquoting many arguments</h3>
<p>

</p>
<p><code>!!</code> is a one-to-one replacement. <code>!!!</code> (called “unquote-splice,” and pronounced bang-bang-bang) is a one-to-many replacement. It takes a list of expressions and inserts them at the location of the <code>!!!</code>:</p>
<!-- GVW: brief note to explain why `!!` can't be made smart enough to do this automatically? -->
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="quasiquotation.html#cb792-1" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">exprs</span>(<span class="dv">1</span>, a, <span class="sc">-</span>b)</span>
<span id="cb792-2"><a href="quasiquotation.html#cb792-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">f</span>(<span class="sc">!!!</span>xs, y))</span>
<span id="cb792-3"><a href="quasiquotation.html#cb792-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(1, a, -b, y)</span></span>
<span id="cb792-4"><a href="quasiquotation.html#cb792-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb792-5"><a href="quasiquotation.html#cb792-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Or with names</span></span>
<span id="cb792-6"><a href="quasiquotation.html#cb792-6" aria-hidden="true" tabindex="-1"></a>ys <span class="ot">&lt;-</span> <span class="fu">set_names</span>(xs, <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</span>
<span id="cb792-7"><a href="quasiquotation.html#cb792-7" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(<span class="fu">f</span>(<span class="sc">!!!</span>ys, <span class="at">d =</span> <span class="dv">4</span>))</span>
<span id="cb792-8"><a href="quasiquotation.html#cb792-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(a = 1, b = a, c = -b, d = 4)</span></span></code></pre></div>
<p><img src="diagrams/quotation/bang-bang-bang.png" width="373" style="display: block; margin: auto;" /></p>
<p><code>!!!</code> can be used in any rlang function that takes <code>...</code> regardless of whether or not <code>...</code> is quoted or evaluated. We’ll come back to this in Section <a href="quasiquotation.html#tidy-dots">19.6</a>; for now note that this can be useful in <code>call2()</code>.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="quasiquotation.html#cb793-1" aria-hidden="true" tabindex="-1"></a><span class="fu">call2</span>(<span class="st">&quot;f&quot;</span>, <span class="sc">!!!</span>xs, <span class="fu">expr</span>(y))</span>
<span id="cb793-2"><a href="quasiquotation.html#cb793-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(1, a, -b, y)</span></span></code></pre></div>
</div>
<div id="the-polite-fiction-of" class="section level3" number="19.4.6">
<h3><span class="header-section-number">19.4.6</span> The polite fiction of <code>!!</code></h3>
<p>So far we have acted as if <code>!!</code> and <code>!!!</code> are regular prefix operators like <code>+</code> , <code>-</code>, and <code>!</code>. They’re not. From R’s perspective, <code>!!</code> and <code>!!!</code> are simply the repeated application of <code>!</code>:</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="quasiquotation.html#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="sc">!!</span><span class="cn">TRUE</span></span>
<span id="cb794-2"><a href="quasiquotation.html#cb794-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb794-3"><a href="quasiquotation.html#cb794-3" aria-hidden="true" tabindex="-1"></a><span class="sc">!!!</span><span class="cn">TRUE</span></span>
<span id="cb794-4"><a href="quasiquotation.html#cb794-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><code>!!</code> and <code>!!!</code> behave specially inside all quoting functions powered by rlang, where they behave like real operators with precedence equivalent to unary <code>+</code> and <code>-</code>. This requires considerable work inside rlang, but means that you can write <code>!!x + !!y</code> instead of <code>(!!x) + (!!y)</code>.</p>
<p>The biggest downside<a href="#fn98" class="footnote-ref" id="fnref98"><sup>98</sup></a> to using a fake operator is that you might get silent errors when misusing <code>!!</code> outside of quasiquoting functions. Most of the time this is not an issue because <code>!!</code> is typically used to unquote expressions or quosures. Since expressions are not supported by the negation operator, you will get an argument type error in this case:</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="quasiquotation.html#cb795-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">quote</span>(variable)</span>
<span id="cb795-2"><a href="quasiquotation.html#cb795-2" aria-hidden="true" tabindex="-1"></a><span class="sc">!!</span>x</span>
<span id="cb795-3"><a href="quasiquotation.html#cb795-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in !x: invalid argument type</span></span></code></pre></div>
<p>But you can get silently incorrect results when working with numeric values:</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="quasiquotation.html#cb796-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb796-2"><a href="quasiquotation.html#cb796-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb796-3"><a href="quasiquotation.html#cb796-3" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, x <span class="sc">+</span> <span class="sc">!!</span>y)</span>
<span id="cb796-4"><a href="quasiquotation.html#cb796-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2 3 4 5 6</span></span></code></pre></div>
<p>Given these drawbacks, you might wonder why we introduced new syntax instead of using regular function calls. Indeed, early versions of tidy evaluation used function calls like <code>UQ()</code> and <code>UQS()</code>. However, they’re not really function calls, and pretending they are leads to a misleading mental mode. We chose <code>!!</code> and <code>!!!</code> as the least-bad solution:</p>
<ul>
<li><p>They are visually strong and don’t look like existing syntax. When you
see <code>!!x</code> or <code>!!!x</code> it’s clear that something unusual is happening.</p></li>
<li><p>They override a rarely used piece of syntax, as double negation is not a
common pattern in R<a href="#fn99" class="footnote-ref" id="fnref99"><sup>99</sup></a>. If you do need it, you can just
add parentheses <code>!(!x)</code>.</p></li>
</ul>
</div>
<div id="non-standard-ast" class="section level3" number="19.4.7">
<h3><span class="header-section-number">19.4.7</span> Non-standard ASTs</h3>
<p></p>
<p>With unquoting, it’s easy to create non-standard ASTs, i.e. ASTs that contain components that are not expressions. (It is also possible to create non-standard ASTs by directly manipulating the underlying objects, but it’s harder to do so accidentally.) These are valid, and occasionally useful, but their correct use is beyond the scope of this book. However, it’s important to learn about them, because they can be deparsed, and hence printed, in misleading ways.</p>
<p>For example, if you inline more complex objects, their attributes are not printed. This can lead to confusing output:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="quasiquotation.html#cb797-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">class</span>(<span class="sc">!!</span><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">10</span>)))</span>
<span id="cb797-2"><a href="quasiquotation.html#cb797-2" aria-hidden="true" tabindex="-1"></a>x1</span>
<span id="cb797-3"><a href="quasiquotation.html#cb797-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class(list(x = 10))</span></span>
<span id="cb797-4"><a href="quasiquotation.html#cb797-4" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(x1)</span>
<span id="cb797-5"><a href="quasiquotation.html#cb797-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span></code></pre></div>
<p>You have two main tools to reduce this confusion: <code>rlang::expr_print()</code> and <code>lobstr::ast()</code>:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="quasiquotation.html#cb798-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expr_print</span>(x1)</span>
<span id="cb798-2"><a href="quasiquotation.html#cb798-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class(&lt;df[,1]&gt;)</span></span>
<span id="cb798-3"><a href="quasiquotation.html#cb798-3" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="sc">!!</span>x1)</span>
<span id="cb798-4"><a href="quasiquotation.html#cb798-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; █─class </span></span>
<span id="cb798-5"><a href="quasiquotation.html#cb798-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; └─&lt;inline data.frame&gt;</span></span></code></pre></div>
<p>Another confusing case arises if you inline an integer sequence:</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="quasiquotation.html#cb799-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">f</span>(<span class="sc">!!</span><span class="fu">c</span>(1L, 2L, 3L, 4L, 5L)))</span>
<span id="cb799-2"><a href="quasiquotation.html#cb799-2" aria-hidden="true" tabindex="-1"></a>x2</span>
<span id="cb799-3"><a href="quasiquotation.html#cb799-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(1:5)</span></span>
<span id="cb799-4"><a href="quasiquotation.html#cb799-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expr_print</span>(x2)</span>
<span id="cb799-5"><a href="quasiquotation.html#cb799-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; f(&lt;int: 1L, 2L, 3L, 4L, 5L&gt;)</span></span>
<span id="cb799-6"><a href="quasiquotation.html#cb799-6" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="sc">!!</span>x2)</span>
<span id="cb799-7"><a href="quasiquotation.html#cb799-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; █─f </span></span>
<span id="cb799-8"><a href="quasiquotation.html#cb799-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; └─&lt;inline integer&gt;</span></span></code></pre></div>
<p>It’s also possible to create regular ASTs that can not be generated from code because of operator precedence. In this case, R will print parentheses that do not exist in the AST:</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="quasiquotation.html#cb800-1" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="sc">!!</span><span class="fu">expr</span>(<span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span>))</span>
<span id="cb800-2"><a href="quasiquotation.html#cb800-2" aria-hidden="true" tabindex="-1"></a>x3</span>
<span id="cb800-3"><a href="quasiquotation.html#cb800-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 + (2 + 3)</span></span>
<span id="cb800-4"><a href="quasiquotation.html#cb800-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb800-5"><a href="quasiquotation.html#cb800-5" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="sc">!!</span>x3)</span>
<span id="cb800-6"><a href="quasiquotation.html#cb800-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; █─`+` </span></span>
<span id="cb800-7"><a href="quasiquotation.html#cb800-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ├─1 </span></span>
<span id="cb800-8"><a href="quasiquotation.html#cb800-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; └─█─`+` </span></span>
<span id="cb800-9"><a href="quasiquotation.html#cb800-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   ├─2 </span></span>
<span id="cb800-10"><a href="quasiquotation.html#cb800-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   └─3</span></span></code></pre></div>
</div>
<div id="exercises-58" class="section level3" number="19.4.8">
<h3><span class="header-section-number">19.4.8</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Given the following components:</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="quasiquotation.html#cb801-1" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">expr</span>(x <span class="sc">+</span> y)</span>
<span id="cb801-2"><a href="quasiquotation.html#cb801-2" aria-hidden="true" tabindex="-1"></a>xz <span class="ot">&lt;-</span> <span class="fu">expr</span>(x <span class="sc">+</span> z)</span>
<span id="cb801-3"><a href="quasiquotation.html#cb801-3" aria-hidden="true" tabindex="-1"></a>yz <span class="ot">&lt;-</span> <span class="fu">expr</span>(y <span class="sc">+</span> z)</span>
<span id="cb801-4"><a href="quasiquotation.html#cb801-4" aria-hidden="true" tabindex="-1"></a>abc <span class="ot">&lt;-</span> <span class="fu">exprs</span>(a, b, c)</span></code></pre></div>
<p>Use quasiquotation to construct the following calls:</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="quasiquotation.html#cb802-1" aria-hidden="true" tabindex="-1"></a>(x <span class="sc">+</span> y) <span class="sc">/</span> (y <span class="sc">+</span> z)</span>
<span id="cb802-2"><a href="quasiquotation.html#cb802-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>(x <span class="sc">+</span> z) <span class="sc">^</span> (y <span class="sc">+</span> z)</span>
<span id="cb802-3"><a href="quasiquotation.html#cb802-3" aria-hidden="true" tabindex="-1"></a>(x <span class="sc">+</span> y) <span class="sc">+</span> (y <span class="sc">+</span> z) <span class="sc">-</span> (x <span class="sc">+</span> y)</span>
<span id="cb802-4"><a href="quasiquotation.html#cb802-4" aria-hidden="true" tabindex="-1"></a><span class="fu">atan2</span>(x <span class="sc">+</span> y, y <span class="sc">+</span> z)</span>
<span id="cb802-5"><a href="quasiquotation.html#cb802-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x <span class="sc">+</span> y, x <span class="sc">+</span> y, y <span class="sc">+</span> z)</span>
<span id="cb802-6"><a href="quasiquotation.html#cb802-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(a, b, c)</span>
<span id="cb802-7"><a href="quasiquotation.html#cb802-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(a, b, c), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb802-8"><a href="quasiquotation.html#cb802-8" aria-hidden="true" tabindex="-1"></a><span class="fu">foo</span>(<span class="at">a =</span> x <span class="sc">+</span> y, <span class="at">b =</span> y <span class="sc">+</span> z)</span></code></pre></div></li>
<li><p>The following two calls print the same, but are actually different:</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="quasiquotation.html#cb803-1" aria-hidden="true" tabindex="-1"></a>(a <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">mean</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)))</span>
<span id="cb803-2"><a href="quasiquotation.html#cb803-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mean(1:10)</span></span>
<span id="cb803-3"><a href="quasiquotation.html#cb803-3" aria-hidden="true" tabindex="-1"></a>(b <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">mean</span>(<span class="sc">!!</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))))</span>
<span id="cb803-4"><a href="quasiquotation.html#cb803-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mean(1:10)</span></span>
<span id="cb803-5"><a href="quasiquotation.html#cb803-5" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(a, b)</span>
<span id="cb803-6"><a href="quasiquotation.html#cb803-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>What’s the difference? Which one is more natural?</p></li>
</ol>
</div>
</div>
<div id="base-nonquote" class="section level2" number="19.5">
<h2><span class="header-section-number">19.5</span> Non-quoting</h2>
<p></p>
<p>Base R has one function that implements quasiquotation: <code>bquote()</code>. It uses <code>.()</code> for unquoting:</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="quasiquotation.html#cb804-1" aria-hidden="true" tabindex="-1"></a>xyz <span class="ot">&lt;-</span> <span class="fu">bquote</span>((x <span class="sc">+</span> y <span class="sc">+</span> z))</span>
<span id="cb804-2"><a href="quasiquotation.html#cb804-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bquote</span>(<span class="sc">-</span>.(xyz) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb804-3"><a href="quasiquotation.html#cb804-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -(x + y + z)/2</span></span></code></pre></div>
<p><code>bquote()</code> isn’t used by any other function in base R, and has had relatively little impact on how R code is written. There are three challenges to effective use of <code>bquote()</code>:</p>
<ul>
<li><p>It is only easily used with your code; it is hard to apply it to arbitrary
code supplied by a user.</p></li>
<li><p>It does not provide an unquote-splice operator that allows you to unquote
multiple expressions stored in a list.</p></li>
<li><p>It lacks the ability to handle code accompanied by an environment, which
is crucial for functions that evaluate code in the context of a data frame,
like <code>subset()</code> and friends.</p></li>
</ul>
<p>Base functions that quote an argument use some other technique to allow indirect specification. Base R approaches selectively turn quoting off, rather than using unquoting, so I call them <strong>non-quoting</strong> techniques.</p>
<p>There are four basic forms seen in base R:</p>
<ul>
<li><p>A pair of quoting and non-quoting functions. For example, <code>$</code> has two
arguments, and the second argument is quoted. This is easier to see if you
write in prefix form: <code>mtcars$cyl</code> is equivalent to <code>`$`(mtcars, cyl)</code>.
If you want to refer to a variable indirectly, you use <code>[[</code>, as it
takes the name of a variable as a string.</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="quasiquotation.html#cb805-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">var =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>)</span>
<span id="cb805-2"><a href="quasiquotation.html#cb805-2" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb805-3"><a href="quasiquotation.html#cb805-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb805-4"><a href="quasiquotation.html#cb805-4" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>var</span>
<span id="cb805-5"><a href="quasiquotation.html#cb805-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb805-6"><a href="quasiquotation.html#cb805-6" aria-hidden="true" tabindex="-1"></a>x[[var]]</span>
<span id="cb805-7"><a href="quasiquotation.html#cb805-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>There are three other quoting functions closely related to <code>$</code>: <code>subset()</code>,
<code>transform()</code>, and <code>with()</code>. These are seen as wrappers around <code>$</code> only
suitable for interactive use so they all have the same non-quoting
alternative: <code>[</code></p>
<p><code>&lt;-</code>/<code>assign()</code> and <code>::</code>/<code>getExportedValue()</code> work similarly to <code>$</code>/<code>[</code>.

</p></li>
<li><p>A pair of quoting and non-quoting arguments. For example, <code>rm()</code> allows
you to provide bare variable names in <code>...</code>, or a character vector of
variable names in <code>list</code>:</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="quasiquotation.html#cb806-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb806-2"><a href="quasiquotation.html#cb806-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(x)</span>
<span id="cb806-3"><a href="quasiquotation.html#cb806-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-4"><a href="quasiquotation.html#cb806-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb806-5"><a href="quasiquotation.html#cb806-5" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;vars&quot;</span>)</span>
<span id="cb806-6"><a href="quasiquotation.html#cb806-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> vars)</span></code></pre></div>
<p><code>data()</code> and <code>save()</code> work similarly.
</p></li>
<li><p>An argument that controls whether a different argument is quoting or
non-quoting. For example, in <code>library()</code>, the <code>character.only</code> argument
controls the quoting behaviour of the first argument, <code>package</code>:</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="quasiquotation.html#cb807-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb807-2"><a href="quasiquotation.html#cb807-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb807-3"><a href="quasiquotation.html#cb807-3" aria-hidden="true" tabindex="-1"></a>pkg <span class="ot">&lt;-</span> <span class="st">&quot;MASS&quot;</span></span>
<span id="cb807-4"><a href="quasiquotation.html#cb807-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><code>demo()</code>, <code>detach()</code>, <code>example()</code>, and <code>require()</code> work similarly.
</p></li>
<li><p>Quoting if evaluation fails. For example, the first argument to <code>help()</code>
is non-quoting if it evaluates to a string; if evaluation fails, the
first argument is quoted.</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="quasiquotation.html#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows help for var</span></span>
<span id="cb808-2"><a href="quasiquotation.html#cb808-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(var)</span>
<span id="cb808-3"><a href="quasiquotation.html#cb808-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-4"><a href="quasiquotation.html#cb808-4" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb808-5"><a href="quasiquotation.html#cb808-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows help for mean</span></span>
<span id="cb808-6"><a href="quasiquotation.html#cb808-6" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(var)</span>
<span id="cb808-7"><a href="quasiquotation.html#cb808-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb808-8"><a href="quasiquotation.html#cb808-8" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb808-9"><a href="quasiquotation.html#cb808-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows help for var</span></span>
<span id="cb808-10"><a href="quasiquotation.html#cb808-10" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(var)</span></code></pre></div>
<p><code>ls()</code>, <code>page()</code>, and <code>match.fun()</code> work similarly.
</p></li>
</ul>
<p>Another important class of quoting functions are the base modelling and plotting functions, which follow the so-called standard non-standard evaluation rules: <a href="http://developer.r-project.org/nonstandard-eval.pdf" class="uri">http://developer.r-project.org/nonstandard-eval.pdf</a>. For example, <code>lm()</code> quotes the <code>weight</code> and <code>subset</code> arguments, and when used with a formula argument, the plotting function quotes the aesthetic arguments (<code>col</code>, <code>cex</code>, etc). Take the following code: we only need <code>col = Species</code> rather than <code>col = iris$Species</code>.</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="quasiquotation.html#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="fu">palette</span>(RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Set1&quot;</span>))</span>
<span id="cb809-2"><a href="quasiquotation.html#cb809-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb809-3"><a href="quasiquotation.html#cb809-3" aria-hidden="true" tabindex="-1"></a>  Sepal.Length <span class="sc">~</span> Petal.Length, </span>
<span id="cb809-4"><a href="quasiquotation.html#cb809-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> iris, </span>
<span id="cb809-5"><a href="quasiquotation.html#cb809-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> Species, </span>
<span id="cb809-6"><a href="quasiquotation.html#cb809-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb809-7"><a href="quasiquotation.html#cb809-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="dv">2</span></span>
<span id="cb809-8"><a href="quasiquotation.html#cb809-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Quotation_files/figure-html/unnamed-chunk-58-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>These functions have no built-in options for indirect specification, but you’ll learn how to simulate unquoting in Section <a href="evaluation.html#base-evaluation">20.6</a>.</p>
</div>
<div id="tidy-dots" class="section level2" number="19.6">
<h2><span class="header-section-number">19.6</span> <code>...</code> (dot-dot-dot)</h2>
<p></p>
<!-- GVW: this seems a long way away from the introduction of `!!!` earlier - move this up above non-quoting in base R? -->
<p><code>!!!</code> is useful because it’s not uncommon to have a list of expressions that you want to insert into a call. It turns out that this pattern is common elsewhere. Take the following two motivating problems:</p>
<ul>
<li><p>What do you do if the elements you want to put in <code>...</code> are already stored
in a list? For example, imagine you have a list of data frames that
you want to <code>rbind()</code> together:</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="quasiquotation.html#cb810-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb810-2"><a href="quasiquotation.html#cb810-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>),</span>
<span id="cb810-3"><a href="quasiquotation.html#cb810-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="dv">4</span>)</span>
<span id="cb810-4"><a href="quasiquotation.html#cb810-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>You could solve this specific case with <code>rbind(dfs$a, dfs$b)</code>, but how
do you generalise that solution to a list of arbitrary length?</p></li>
<li><p>What do you do if you want to supply the argument name indirectly? For
example, imagine you want to create a single column data frame where
the name of the column is specified in a variable:</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="quasiquotation.html#cb811-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="st">&quot;x&quot;</span></span>
<span id="cb811-2"><a href="quasiquotation.html#cb811-2" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">9</span>)</span></code></pre></div>
<p>In this case, you could create a data frame and then change names
(i.e. <code>setNames(data.frame(val), var)</code>), but this feels inelegant.
How can we do better?</p></li>
</ul>
<p>One way to think about these problems is to draw explicit parallels to quasiquotation:</p>
<ul>
<li><p>Row-binding multiple data frames is like unquote-splicing: we want to inline
individual elements of the list into the call:</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="quasiquotation.html#cb812-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="sc">!!!</span>dfs)</span>
<span id="cb812-2"><a href="quasiquotation.html#cb812-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x y</span></span>
<span id="cb812-3"><a href="quasiquotation.html#cb812-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1 2</span></span>
<span id="cb812-4"><a href="quasiquotation.html#cb812-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3 4</span></span></code></pre></div>
<p>When used in this context, the behaviour of <code>!!!</code> is known as “spatting” in
Ruby, Go, PHP, and Julia. It is closely related to <code>*args</code> (star-args) and
<code>**kwarg</code> (star-star-kwargs) in Python, which are sometimes called argument
unpacking.
</p></li>
<li><p>The second problem is like unquoting the left-hand side of <code>=</code>: rather
than interpreting <code>var</code> literally, we want to use the value stored in the
variable called <code>var</code>:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="quasiquotation.html#cb813-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="sc">!!</span><span class="at">var :=</span> val)</span>
<span id="cb813-2"><a href="quasiquotation.html#cb813-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 1</span></span>
<span id="cb813-3"><a href="quasiquotation.html#cb813-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x</span></span>
<span id="cb813-4"><a href="quasiquotation.html#cb813-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span id="cb813-5"><a href="quasiquotation.html#cb813-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4</span></span>
<span id="cb813-6"><a href="quasiquotation.html#cb813-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     3</span></span>
<span id="cb813-7"><a href="quasiquotation.html#cb813-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     9</span></span></code></pre></div>
<p>Note the use of <code>:=</code> (pronounced colon-equals) rather than <code>=</code>. Unfortunately
we need this new operation because R’s grammar does not allow expressions as
argument names:</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="quasiquotation.html#cb814-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="sc">!!</span><span class="at">var =</span> value)</span>
<span id="cb814-2"><a href="quasiquotation.html#cb814-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: unexpected &#39;=&#39; in &quot;tibble::tibble(!!var =&quot;</span></span></code></pre></div>
<p><code>:=</code> is like a vestigial organ: it’s recognised by R’s parser, but it
doesn’t have any code associated with it. It looks like an <code>=</code> but allows
expressions on either side, making it a more flexible alternative to <code>=</code>.
It is used in data.table for similar reasons.
</p></li>
</ul>
<!-- GVW: I think `:=` needs/deserves more than a fly-by in a bullet point... -->
<p>Base R takes a different approach, which we’ll come back to in Section <a href="quasiquotation.html#do-call">19.6.4</a>.</p>
<p>We say functions that support these tools, without quoting arguments, have <strong>tidy dots</strong><a href="#fn100" class="footnote-ref" id="fnref100"><sup>100</sup></a>. To gain tidy dots behaviour in your own function, all you need to do is use <code>list2()</code>.</p>
<div id="examples" class="section level3" number="19.6.1">
<h3><span class="header-section-number">19.6.1</span> Examples</h3>
<p></p>
<p>One place we could use <code>list2()</code> is to create a wrapper around <code>attributes()</code> that allows us to set attributes flexibly:</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="quasiquotation.html#cb815-1" aria-hidden="true" tabindex="-1"></a>set_attr <span class="ot">&lt;-</span> <span class="cf">function</span>(.x, ...) {</span>
<span id="cb815-2"><a href="quasiquotation.html#cb815-2" aria-hidden="true" tabindex="-1"></a>  attr <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">list2</span>(...)</span>
<span id="cb815-3"><a href="quasiquotation.html#cb815-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(.x) <span class="ot">&lt;-</span> attr</span>
<span id="cb815-4"><a href="quasiquotation.html#cb815-4" aria-hidden="true" tabindex="-1"></a>  .x</span>
<span id="cb815-5"><a href="quasiquotation.html#cb815-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb815-6"><a href="quasiquotation.html#cb815-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-7"><a href="quasiquotation.html#cb815-7" aria-hidden="true" tabindex="-1"></a>attrs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>)</span>
<span id="cb815-8"><a href="quasiquotation.html#cb815-8" aria-hidden="true" tabindex="-1"></a>attr_name <span class="ot">&lt;-</span> <span class="st">&quot;z&quot;</span></span>
<span id="cb815-9"><a href="quasiquotation.html#cb815-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb815-10"><a href="quasiquotation.html#cb815-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%&gt;%</span></span>
<span id="cb815-11"><a href="quasiquotation.html#cb815-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_attr</span>(<span class="at">w =</span> <span class="dv">0</span>, <span class="sc">!!!</span>attrs, <span class="sc">!!</span><span class="at">attr_name :=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb815-12"><a href="quasiquotation.html#cb815-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span>
<span id="cb815-13"><a href="quasiquotation.html#cb815-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  int [1:10] 1 2 3 4 5 6 7 8 9 10</span></span>
<span id="cb815-14"><a href="quasiquotation.html#cb815-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;w&quot;)= num 0</span></span>
<span id="cb815-15"><a href="quasiquotation.html#cb815-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;x&quot;)= num 1</span></span>
<span id="cb815-16"><a href="quasiquotation.html#cb815-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;y&quot;)= num 2</span></span>
<span id="cb815-17"><a href="quasiquotation.html#cb815-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;z&quot;)= num 3</span></span></code></pre></div>
</div>
<div id="exec" class="section level3" number="19.6.2">
<h3><span class="header-section-number">19.6.2</span> <code>exec()</code></h3>
<p>What if you want to use this technique with a function that doesn’t have tidy dots? One option is to use <code>rlang::exec()</code> to call a function with some arguments supplied directly (in <code>...</code>) and others indirectly (in a list):</p>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="quasiquotation.html#cb816-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly</span></span>
<span id="cb816-2"><a href="quasiquotation.html#cb816-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exec</span>(<span class="st">&quot;mean&quot;</span>, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)</span>
<span id="cb816-3"><a href="quasiquotation.html#cb816-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span>
<span id="cb816-4"><a href="quasiquotation.html#cb816-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-5"><a href="quasiquotation.html#cb816-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Indirectly</span></span>
<span id="cb816-6"><a href="quasiquotation.html#cb816-6" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)</span>
<span id="cb816-7"><a href="quasiquotation.html#cb816-7" aria-hidden="true" tabindex="-1"></a><span class="fu">exec</span>(<span class="st">&quot;mean&quot;</span>, <span class="sc">!!!</span>args)</span>
<span id="cb816-8"><a href="quasiquotation.html#cb816-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span>
<span id="cb816-9"><a href="quasiquotation.html#cb816-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-10"><a href="quasiquotation.html#cb816-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mixed</span></span>
<span id="cb816-11"><a href="quasiquotation.html#cb816-11" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">trim =</span> <span class="fl">0.1</span>)</span>
<span id="cb816-12"><a href="quasiquotation.html#cb816-12" aria-hidden="true" tabindex="-1"></a><span class="fu">exec</span>(<span class="st">&quot;mean&quot;</span>, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">!!!</span>params)</span>
<span id="cb816-13"><a href="quasiquotation.html#cb816-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code></pre></div>
<p><code>rlang::exec()</code> also makes it possible to supply argument names indirectly:</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="quasiquotation.html#cb817-1" aria-hidden="true" tabindex="-1"></a>arg_name <span class="ot">&lt;-</span> <span class="st">&quot;na.rm&quot;</span></span>
<span id="cb817-2"><a href="quasiquotation.html#cb817-2" aria-hidden="true" tabindex="-1"></a>arg_val <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb817-3"><a href="quasiquotation.html#cb817-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exec</span>(<span class="st">&quot;mean&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">!!</span><span class="at">arg_name :=</span> arg_val)</span>
<span id="cb817-4"><a href="quasiquotation.html#cb817-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.5</span></span></code></pre></div>
<p>And finally, it’s useful if you have a vector of function names or a list of functions that you want to call with the same arguments:</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="quasiquotation.html#cb818-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">runif</span>(<span class="dv">10</span>), <span class="cn">NA</span>)</span>
<span id="cb818-2"><a href="quasiquotation.html#cb818-2" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;sd&quot;</span>)</span>
<span id="cb818-3"><a href="quasiquotation.html#cb818-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb818-4"><a href="quasiquotation.html#cb818-4" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map_dbl</span>(funs, exec, x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb818-5"><a href="quasiquotation.html#cb818-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.444 0.482 0.298</span></span></code></pre></div>
<p><code>exec()</code> is closely related to <code>call2()</code>; where <code>call2()</code> returns an expression, <code>exec()</code> evaluates it.</p>
</div>
<div id="dots_list" class="section level3" number="19.6.3">
<h3><span class="header-section-number">19.6.3</span> <code>dots_list()</code></h3>
<p><code>list2()</code> provides one other handy feature: by default it will ignore any empty arguments at the end. This is useful in functions like <code>tibble::tibble()</code> because it means that you can easily change the order of variables without worrying about the final comma:</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="quasiquotation.html#cb819-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can easily move x to first entry:</span></span>
<span id="cb819-2"><a href="quasiquotation.html#cb819-2" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb819-3"><a href="quasiquotation.html#cb819-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb819-4"><a href="quasiquotation.html#cb819-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="dv">3</span><span class="sc">:-</span><span class="dv">1</span>,</span>
<span id="cb819-5"><a href="quasiquotation.html#cb819-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb819-6"><a href="quasiquotation.html#cb819-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb819-7"><a href="quasiquotation.html#cb819-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-8"><a href="quasiquotation.html#cb819-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to remove comma from z and add comma to x</span></span>
<span id="cb819-9"><a href="quasiquotation.html#cb819-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb819-10"><a href="quasiquotation.html#cb819-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb819-11"><a href="quasiquotation.html#cb819-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="dv">3</span><span class="sc">:-</span><span class="dv">1</span>,</span>
<span id="cb819-12"><a href="quasiquotation.html#cb819-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">1</span></span>
<span id="cb819-13"><a href="quasiquotation.html#cb819-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><code>list2()</code> is a wrapper around <code>rlang::dots_list()</code> with defaults set to the most commonly used settings. You can get more control by calling <code>dots_list()</code> directly:</p>
<ul>
<li><p><code>.ignore_empty</code> allows you to control exactly which arguments are ignored.
The default ignores a single trailing argument to get the behaviour
described above, but you can choose to ignore all missing arguments, or
no missing arguments.</p></li>
<li><p><code>.homonyms</code> controls what happens if multiple arguments use the same name:</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="quasiquotation.html#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">dots_list</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="dv">2</span>))</span>
<span id="cb820-2"><a href="quasiquotation.html#cb820-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb820-3"><a href="quasiquotation.html#cb820-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ x: num 1</span></span>
<span id="cb820-4"><a href="quasiquotation.html#cb820-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ x: num 2</span></span>
<span id="cb820-5"><a href="quasiquotation.html#cb820-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">dots_list</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">.homonyms =</span> <span class="st">&quot;first&quot;</span>))</span>
<span id="cb820-6"><a href="quasiquotation.html#cb820-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 1</span></span>
<span id="cb820-7"><a href="quasiquotation.html#cb820-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ x: num 1</span></span>
<span id="cb820-8"><a href="quasiquotation.html#cb820-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">dots_list</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">.homonyms =</span> <span class="st">&quot;last&quot;</span>))</span>
<span id="cb820-9"><a href="quasiquotation.html#cb820-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 1</span></span>
<span id="cb820-10"><a href="quasiquotation.html#cb820-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ x: num 2</span></span>
<span id="cb820-11"><a href="quasiquotation.html#cb820-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">dots_list</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">.homonyms =</span> <span class="st">&quot;error&quot;</span>))</span>
<span id="cb820-12"><a href="quasiquotation.html#cb820-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error: Arguments can&#39;t have the same name.</span></span>
<span id="cb820-13"><a href="quasiquotation.html#cb820-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; We found multiple arguments named `x` at positions 1 and 2</span></span></code></pre></div></li>
<li><p>If there are empty arguments that are not ignored, <code>.preserve_empty</code>
controls what to do with them. The default throws an error; setting
<code>.preserve_empty = TRUE</code> instead returns missing symbols. This is useful
if you’re using <code>dots_list()</code> to generate function calls.</p></li>
</ul>
</div>
<div id="do-call" class="section level3" number="19.6.4">
<h3><span class="header-section-number">19.6.4</span> With base R</h3>
<p>
</p>
<p>Base R provides a Swiss army knife to solve these problems: <code>do.call()</code>. <code>do.call()</code> has two main arguments. The first argument, <code>what</code>, gives a function to call. The second argument, <code>args</code>, is a list of arguments to pass to that function, and so <code>do.call("f", list(x, y, z))</code> is equivalent to <code>f(x, y, z)</code>.</p>
<ul>
<li><p><code>do.call()</code> gives a straightforward solution to <code>rbind()</code>ing together many
data frames:</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="quasiquotation.html#cb821-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dfs)</span>
<span id="cb821-2"><a href="quasiquotation.html#cb821-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x y</span></span>
<span id="cb821-3"><a href="quasiquotation.html#cb821-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a 1 2</span></span>
<span id="cb821-4"><a href="quasiquotation.html#cb821-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; b 3 4</span></span></code></pre></div></li>
<li><p>With a little more work, we can use <code>do.call()</code> to solve the second problem.
We first create a list of arguments, then name that, then use <code>do.call()</code>:</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="quasiquotation.html#cb822-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">list</span>(val)</span>
<span id="cb822-2"><a href="quasiquotation.html#cb822-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(args) <span class="ot">&lt;-</span> var</span>
<span id="cb822-3"><a href="quasiquotation.html#cb822-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-4"><a href="quasiquotation.html#cb822-4" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(<span class="st">&quot;data.frame&quot;</span>, args)</span>
<span id="cb822-5"><a href="quasiquotation.html#cb822-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x</span></span>
<span id="cb822-6"><a href="quasiquotation.html#cb822-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 4</span></span>
<span id="cb822-7"><a href="quasiquotation.html#cb822-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3</span></span>
<span id="cb822-8"><a href="quasiquotation.html#cb822-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 9</span></span></code></pre></div></li>
</ul>
<p>Some base functions (including <code>interaction()</code>, <code>expand.grid()</code>, <code>options()</code>, and <code>par()</code>) use a trick to avoid <code>do.call()</code>: if the first component of <code>...</code> is a list, they’ll take its components instead of looking at the other elements of <code>...</code>. The implementation looks something like this:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="quasiquotation.html#cb823-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb823-2"><a href="quasiquotation.html#cb823-2" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb823-3"><a href="quasiquotation.html#cb823-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(dots) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">is.list</span>(dots[[<span class="dv">1</span>]])) {</span>
<span id="cb823-4"><a href="quasiquotation.html#cb823-4" aria-hidden="true" tabindex="-1"></a>    dots <span class="ot">&lt;-</span> dots[[<span class="dv">1</span>]]</span>
<span id="cb823-5"><a href="quasiquotation.html#cb823-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb823-6"><a href="quasiquotation.html#cb823-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb823-7"><a href="quasiquotation.html#cb823-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Do something</span></span>
<span id="cb823-8"><a href="quasiquotation.html#cb823-8" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb823-9"><a href="quasiquotation.html#cb823-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Another approach to avoiding <code>do.call()</code> is found in the <code>RCurl::getURL()</code> function written by Duncan Temple Lang. <code>getURL()</code> takes both <code>...</code> and <code>.dots</code> which are concatenated together and looks something like this:</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="quasiquotation.html#cb824-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(..., .dots) {</span>
<span id="cb824-2"><a href="quasiquotation.html#cb824-2" aria-hidden="true" tabindex="-1"></a>  dots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(...), .dots)</span>
<span id="cb824-3"><a href="quasiquotation.html#cb824-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Do something</span></span>
<span id="cb824-4"><a href="quasiquotation.html#cb824-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>At the time I discovered it, I found this technique particularly compelling so you can see it used throughout the tidyverse. Now, however, I prefer the approach described previously.</p>
</div>
<div id="exercises-59" class="section level3" number="19.6.5">
<h3><span class="header-section-number">19.6.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>One way to implement <code>exec()</code> is shown below. Describe how it works. What are the
key ideas?</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="quasiquotation.html#cb825-1" aria-hidden="true" tabindex="-1"></a>exec <span class="ot">&lt;-</span> <span class="cf">function</span>(f, ..., <span class="at">.env =</span> <span class="fu">caller_env</span>()) {</span>
<span id="cb825-2"><a href="quasiquotation.html#cb825-2" aria-hidden="true" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">list2</span>(...)</span>
<span id="cb825-3"><a href="quasiquotation.html#cb825-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(f, args, <span class="at">envir =</span> .env)</span>
<span id="cb825-4"><a href="quasiquotation.html#cb825-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>Carefully read the source code for <code>interaction()</code>, <code>expand.grid()</code>, and
<code>par()</code>. Compare and contrast the techniques they use for switching
between dots and list behaviour.</p></li>
<li><p>Explain the problem with this definition of <code>set_attr()</code></p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="quasiquotation.html#cb826-1" aria-hidden="true" tabindex="-1"></a>set_attr <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb826-2"><a href="quasiquotation.html#cb826-2" aria-hidden="true" tabindex="-1"></a>  attr <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">list2</span>(...)</span>
<span id="cb826-3"><a href="quasiquotation.html#cb826-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">attributes</span>(x) <span class="ot">&lt;-</span> attr</span>
<span id="cb826-4"><a href="quasiquotation.html#cb826-4" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb826-5"><a href="quasiquotation.html#cb826-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb826-6"><a href="quasiquotation.html#cb826-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set_attr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">x =</span> <span class="dv">10</span>)</span>
<span id="cb826-7"><a href="quasiquotation.html#cb826-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error in attributes(x) &lt;- attr: attributes must be named</span></span></code></pre></div></li>
</ol>
</div>
</div>
<div id="expr-case-studies" class="section level2" number="19.7">
<h2><span class="header-section-number">19.7</span> Case studies</h2>
<p>To make the ideas of quasiquotation concrete, this section contains a few small case studies that use it to solve real problems. Some of the case studies also use purrr: I find the combination of quasiquotation and functional programming to be particularly elegant.</p>
<div id="lobstrast" class="section level3" number="19.7.1">
<h3><span class="header-section-number">19.7.1</span> <code>lobstr::ast()</code></h3>
<p></p>
<p>Quasiquotation allows us to solve an annoying problem with <code>lobstr::ast()</code>: what happens if we’ve already captured the expression?</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="quasiquotation.html#cb827-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">expr</span>(<span class="fu">foo</span>(x, y))</span>
<span id="cb827-2"><a href="quasiquotation.html#cb827-2" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(z)</span>
<span id="cb827-3"><a href="quasiquotation.html#cb827-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; z</span></span></code></pre></div>
<p>Because <code>ast()</code> quotes its first argument, we can use <code>!!</code>:</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="quasiquotation.html#cb828-1" aria-hidden="true" tabindex="-1"></a>lobstr<span class="sc">::</span><span class="fu">ast</span>(<span class="sc">!!</span>z)</span>
<span id="cb828-2"><a href="quasiquotation.html#cb828-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; █─foo </span></span>
<span id="cb828-3"><a href="quasiquotation.html#cb828-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ├─x </span></span>
<span id="cb828-4"><a href="quasiquotation.html#cb828-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; └─y</span></span></code></pre></div>
</div>
<div id="map-reduce-to-generate-code" class="section level3" number="19.7.2">
<h3><span class="header-section-number">19.7.2</span> Map-reduce to generate code</h3>
<p>Quasiquotation gives us powerful tools for generating code, particularly when combined with <code>purrr::map()</code> and <code>purr::reduce()</code>. For example, assume you have a linear model specified by the following coefficients:</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="quasiquotation.html#cb829-1" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb829-2"><a href="quasiquotation.html#cb829-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">x1 =</span> <span class="dv">5</span>, <span class="at">x2 =</span> <span class="sc">-</span><span class="dv">4</span>)</span></code></pre></div>
<p>And you want to convert it into an expression like <code>10 + (x1 * 5) + (x2 * -4)</code>. The first thing we need to do is turn the character names vector into a list of symbols. <code>rlang::syms()</code> is designed precisely for this case:</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="quasiquotation.html#cb830-1" aria-hidden="true" tabindex="-1"></a>coef_sym <span class="ot">&lt;-</span> <span class="fu">syms</span>(<span class="fu">names</span>(coefs))</span>
<span id="cb830-2"><a href="quasiquotation.html#cb830-2" aria-hidden="true" tabindex="-1"></a>coef_sym</span>
<span id="cb830-3"><a href="quasiquotation.html#cb830-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb830-4"><a href="quasiquotation.html#cb830-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x1</span></span>
<span id="cb830-5"><a href="quasiquotation.html#cb830-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb830-6"><a href="quasiquotation.html#cb830-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb830-7"><a href="quasiquotation.html#cb830-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x2</span></span></code></pre></div>
<p>Next we need to combine each variable name with its coefficient. We can do this by combining <code>rlang::expr()</code> with <code>purrr::map2()</code>:</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="quasiquotation.html#cb831-1" aria-hidden="true" tabindex="-1"></a>summands <span class="ot">&lt;-</span> <span class="fu">map2</span>(coef_sym, coefs, <span class="sc">~</span> <span class="fu">expr</span>((<span class="sc">!!</span>.x <span class="sc">*</span> <span class="sc">!!</span>.y)))</span>
<span id="cb831-2"><a href="quasiquotation.html#cb831-2" aria-hidden="true" tabindex="-1"></a>summands</span>
<span id="cb831-3"><a href="quasiquotation.html#cb831-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb831-4"><a href="quasiquotation.html#cb831-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (x1 * 5)</span></span>
<span id="cb831-5"><a href="quasiquotation.html#cb831-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb831-6"><a href="quasiquotation.html#cb831-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb831-7"><a href="quasiquotation.html#cb831-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (x2 * -4)</span></span></code></pre></div>
<p>In this case, the intercept is also a part of the sum, although it doesn’t involve a multiplication. We can just add it to the start of the <code>summands</code> vector:</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="quasiquotation.html#cb832-1" aria-hidden="true" tabindex="-1"></a>summands <span class="ot">&lt;-</span> <span class="fu">c</span>(intercept, summands)</span>
<span id="cb832-2"><a href="quasiquotation.html#cb832-2" aria-hidden="true" tabindex="-1"></a>summands</span>
<span id="cb832-3"><a href="quasiquotation.html#cb832-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb832-4"><a href="quasiquotation.html#cb832-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10</span></span>
<span id="cb832-5"><a href="quasiquotation.html#cb832-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb832-6"><a href="quasiquotation.html#cb832-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb832-7"><a href="quasiquotation.html#cb832-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (x1 * 5)</span></span>
<span id="cb832-8"><a href="quasiquotation.html#cb832-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb832-9"><a href="quasiquotation.html#cb832-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb832-10"><a href="quasiquotation.html#cb832-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (x2 * -4)</span></span></code></pre></div>
<p>Finally, we need to reduce (Section <a href="functionals.html#reduce">9.5</a>) the individual terms into a single sum by adding the pieces together:</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="quasiquotation.html#cb833-1" aria-hidden="true" tabindex="-1"></a>eq <span class="ot">&lt;-</span> <span class="fu">reduce</span>(summands, <span class="sc">~</span> <span class="fu">expr</span>(<span class="sc">!!</span>.x <span class="sc">+</span> <span class="sc">!!</span>.y))</span>
<span id="cb833-2"><a href="quasiquotation.html#cb833-2" aria-hidden="true" tabindex="-1"></a>eq</span>
<span id="cb833-3"><a href="quasiquotation.html#cb833-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 + (x1 * 5) + (x2 * -4)</span></span></code></pre></div>
<p>We could make this even more general by allowing the user to supply the name of the coefficient, and instead of assuming many different variables, index into a single one.</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="quasiquotation.html#cb834-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">expr</span>(y)</span>
<span id="cb834-2"><a href="quasiquotation.html#cb834-2" aria-hidden="true" tabindex="-1"></a>coef_sym <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">seq_along</span>(coefs), <span class="sc">~</span> <span class="fu">expr</span>((<span class="sc">!!</span>var)[[<span class="sc">!!</span>.x]]))</span>
<span id="cb834-3"><a href="quasiquotation.html#cb834-3" aria-hidden="true" tabindex="-1"></a>coef_sym</span>
<span id="cb834-4"><a href="quasiquotation.html#cb834-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb834-5"><a href="quasiquotation.html#cb834-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y[[1L]]</span></span>
<span id="cb834-6"><a href="quasiquotation.html#cb834-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb834-7"><a href="quasiquotation.html#cb834-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb834-8"><a href="quasiquotation.html#cb834-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; y[[2L]]</span></span></code></pre></div>
<p>And finish by wrapping this up in a function:</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="quasiquotation.html#cb835-1" aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="cf">function</span>(var, val) {</span>
<span id="cb835-2"><a href="quasiquotation.html#cb835-2" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">ensym</span>(var)</span>
<span id="cb835-3"><a href="quasiquotation.html#cb835-3" aria-hidden="true" tabindex="-1"></a>  coef_name <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">seq_along</span>(val[<span class="sc">-</span><span class="dv">1</span>]), <span class="sc">~</span> <span class="fu">expr</span>((<span class="sc">!!</span>var)[[<span class="sc">!!</span>.x]]))</span>
<span id="cb835-4"><a href="quasiquotation.html#cb835-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-5"><a href="quasiquotation.html#cb835-5" aria-hidden="true" tabindex="-1"></a>  summands <span class="ot">&lt;-</span> <span class="fu">map2</span>(val[<span class="sc">-</span><span class="dv">1</span>], coef_name, <span class="sc">~</span> <span class="fu">expr</span>((<span class="sc">!!</span>.x <span class="sc">*</span> <span class="sc">!!</span>.y)))</span>
<span id="cb835-6"><a href="quasiquotation.html#cb835-6" aria-hidden="true" tabindex="-1"></a>  summands <span class="ot">&lt;-</span> <span class="fu">c</span>(val[[<span class="dv">1</span>]], summands)</span>
<span id="cb835-7"><a href="quasiquotation.html#cb835-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-8"><a href="quasiquotation.html#cb835-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(summands, <span class="sc">~</span> <span class="fu">expr</span>(<span class="sc">!!</span>.x <span class="sc">+</span> <span class="sc">!!</span>.y))</span>
<span id="cb835-9"><a href="quasiquotation.html#cb835-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb835-10"><a href="quasiquotation.html#cb835-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb835-11"><a href="quasiquotation.html#cb835-11" aria-hidden="true" tabindex="-1"></a><span class="fu">linear</span>(x, <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">4</span>))</span>
<span id="cb835-12"><a href="quasiquotation.html#cb835-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 + (5 * x[[1L]]) + (-4 * x[[2L]])</span></span></code></pre></div>
<p>Note the use of <code>ensym()</code>: we want the user to supply the name of a single variable, not a more complex expression.</p>
</div>
<div id="slicing-an-array" class="section level3" number="19.7.3">
<h3><span class="header-section-number">19.7.3</span> Slicing an array</h3>
<p></p>
<p>An occasionally useful tool missing from base R is the ability to extract a slice of an array given a dimension and an index. For example, we’d like to write <code>slice(x, 2, 1)</code> to extract the first slice along the second dimension, i.e. <code>x[, 1, ]</code>. This is a moderately challenging problem because it requires working with missing arguments.</p>
<p>We’ll need to generate a call with multiple missing arguments. We first generate a list of missing arguments with <code>rep()</code> and <code>missing_arg()</code>, then unquote-splice them into a call:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="quasiquotation.html#cb836-1" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">missing_arg</span>()), <span class="dv">3</span>)</span>
<span id="cb836-2"><a href="quasiquotation.html#cb836-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(x[<span class="sc">!!!</span>indices])</span>
<span id="cb836-3"><a href="quasiquotation.html#cb836-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x[, , ]</span></span></code></pre></div>
<p>Then we use subset-assignment to insert the index in the desired position:</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="quasiquotation.html#cb837-1" aria-hidden="true" tabindex="-1"></a>indices[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb837-2"><a href="quasiquotation.html#cb837-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expr</span>(x[<span class="sc">!!!</span>indices])</span>
<span id="cb837-3"><a href="quasiquotation.html#cb837-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x[, 1, ]</span></span></code></pre></div>
<p>We then wrap this into a function, using a couple of <code>stopifnot()</code>s to make the interface clear:</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="quasiquotation.html#cb838-1" aria-hidden="true" tabindex="-1"></a>slice <span class="ot">&lt;-</span> <span class="cf">function</span>(x, along, index) {</span>
<span id="cb838-2"><a href="quasiquotation.html#cb838-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(along) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb838-3"><a href="quasiquotation.html#cb838-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(index) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb838-4"><a href="quasiquotation.html#cb838-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb838-5"><a href="quasiquotation.html#cb838-5" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">dim</span>(x))</span>
<span id="cb838-6"><a href="quasiquotation.html#cb838-6" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">missing_arg</span>()), nd)</span>
<span id="cb838-7"><a href="quasiquotation.html#cb838-7" aria-hidden="true" tabindex="-1"></a>  indices[[along]] <span class="ot">&lt;-</span> index</span>
<span id="cb838-8"><a href="quasiquotation.html#cb838-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb838-9"><a href="quasiquotation.html#cb838-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expr</span>(x[<span class="sc">!!!</span>indices])</span>
<span id="cb838-10"><a href="quasiquotation.html#cb838-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb838-11"><a href="quasiquotation.html#cb838-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb838-12"><a href="quasiquotation.html#cb838-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">sample</span>(<span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb838-13"><a href="quasiquotation.html#cb838-13" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(x, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb838-14"><a href="quasiquotation.html#cb838-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x[3, , ]</span></span>
<span id="cb838-15"><a href="quasiquotation.html#cb838-15" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(x, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb838-16"><a href="quasiquotation.html#cb838-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x[, 2, ]</span></span>
<span id="cb838-17"><a href="quasiquotation.html#cb838-17" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(x, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb838-18"><a href="quasiquotation.html#cb838-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x[, , 1]</span></span></code></pre></div>
<p>A real <code>slice()</code> would evaluate the generated call (Chapter <a href="evaluation.html#evaluation">20</a>), but here I think it’s more illuminating to see the code that’s generated, as that’s the hard part of the challenge.</p>
</div>
<div id="new-function" class="section level3" number="19.7.4">
<h3><span class="header-section-number">19.7.4</span> Creating functions</h3>
<p>
</p>
<p>Another powerful application of quotation is creating functions “by hand,” using <code>rlang::new_function()</code>. It’s a function that creates a function from its three components (Section <a href="functions.html#fun-components">6.2.1</a>): arguments, body, and (optionally) an environment:</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="quasiquotation.html#cb839-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_function</span>(</span>
<span id="cb839-2"><a href="quasiquotation.html#cb839-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exprs</span>(<span class="at">x =</span> , <span class="at">y =</span> ), </span>
<span id="cb839-3"><a href="quasiquotation.html#cb839-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expr</span>({x <span class="sc">+</span> y})</span>
<span id="cb839-4"><a href="quasiquotation.html#cb839-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb839-5"><a href="quasiquotation.html#cb839-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (x, y) </span></span>
<span id="cb839-6"><a href="quasiquotation.html#cb839-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb839-7"><a href="quasiquotation.html#cb839-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     x + y</span></span>
<span id="cb839-8"><a href="quasiquotation.html#cb839-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>NB: The empty arguments in <code>exprs()</code> generates arguments with no defaults.</p>
<p>One use of <code>new_function()</code> is as an alternative to function factories with scalar or symbol arguments. For example, we could write a function that generates functions that raise a function to the power of a number.</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="quasiquotation.html#cb840-1" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="cf">function</span>(exponent) {</span>
<span id="cb840-2"><a href="quasiquotation.html#cb840-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_function</span>(</span>
<span id="cb840-3"><a href="quasiquotation.html#cb840-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exprs</span>(<span class="at">x =</span> ), </span>
<span id="cb840-4"><a href="quasiquotation.html#cb840-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expr</span>({</span>
<span id="cb840-5"><a href="quasiquotation.html#cb840-5" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">^</span> <span class="sc">!!</span>exponent</span>
<span id="cb840-6"><a href="quasiquotation.html#cb840-6" aria-hidden="true" tabindex="-1"></a>    }), </span>
<span id="cb840-7"><a href="quasiquotation.html#cb840-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">caller_env</span>()</span>
<span id="cb840-8"><a href="quasiquotation.html#cb840-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb840-9"><a href="quasiquotation.html#cb840-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb840-10"><a href="quasiquotation.html#cb840-10" aria-hidden="true" tabindex="-1"></a><span class="fu">power</span>(<span class="fl">0.5</span>)</span>
<span id="cb840-11"><a href="quasiquotation.html#cb840-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (x) </span></span>
<span id="cb840-12"><a href="quasiquotation.html#cb840-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb840-13"><a href="quasiquotation.html#cb840-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     x^0.5</span></span>
<span id="cb840-14"><a href="quasiquotation.html#cb840-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>Another application of <code>new_function()</code> is for functions that work like <code>graphics::curve()</code>, which allows you to plot a mathematical expression without creating a function:</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="quasiquotation.html#cb841-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">sin</span>(<span class="fu">exp</span>(<span class="dv">4</span> <span class="sc">*</span> x)), <span class="at">n =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p><img src="Quotation_files/figure-html/curve-demo-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In this code, <code>x</code> is a pronoun: it doesn’t represent a single concrete value, but is instead a placeholder that varies over the range of the plot. One way to implement <code>curve()</code> is to turn that expression into a function with a single argument, <code>x</code>, then call that function:</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="quasiquotation.html#cb842-1" aria-hidden="true" tabindex="-1"></a>curve2 <span class="ot">&lt;-</span> <span class="cf">function</span>(expr, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb842-2"><a href="quasiquotation.html#cb842-2" aria-hidden="true" tabindex="-1"></a>  expr <span class="ot">&lt;-</span> <span class="fu">enexpr</span>(expr)</span>
<span id="cb842-3"><a href="quasiquotation.html#cb842-3" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">new_function</span>(<span class="fu">exprs</span>(<span class="at">x =</span> ), expr)</span>
<span id="cb842-4"><a href="quasiquotation.html#cb842-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb842-5"><a href="quasiquotation.html#cb842-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="at">length =</span> n)</span>
<span id="cb842-6"><a href="quasiquotation.html#cb842-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">f</span>(x)</span>
<span id="cb842-7"><a href="quasiquotation.html#cb842-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-8"><a href="quasiquotation.html#cb842-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="fu">expr_text</span>(expr))</span>
<span id="cb842-9"><a href="quasiquotation.html#cb842-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb842-10"><a href="quasiquotation.html#cb842-10" aria-hidden="true" tabindex="-1"></a><span class="fu">curve2</span>(<span class="fu">sin</span>(<span class="fu">exp</span>(<span class="dv">4</span> <span class="sc">*</span> x)), <span class="at">n =</span> <span class="dv">1000</span>)</span></code></pre></div>
<p>Functions like <code>curve()</code> that use an expression containing a pronoun are known as <strong>anaphoric</strong> functions<a href="#fn101" class="footnote-ref" id="fnref101"><sup>101</sup></a>.</p>
</div>
<div id="exercises-60" class="section level3" number="19.7.5">
<h3><span class="header-section-number">19.7.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>In the linear-model example, we could replace the <code>expr()</code> in
<code>reduce(summands, ~ expr(!!.x + !!.y))</code> with <code>call2()</code>:
<code>reduce(summands, call2, "+")</code>. Compare and contrast the two
approaches. Which do you think is easier to read?</p></li>
<li><p>Re-implement the Box-Cox transform defined below using unquoting and
<code>new_function()</code>:</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="quasiquotation.html#cb843-1" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda) {</span>
<span id="cb843-2"><a href="quasiquotation.html#cb843-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lambda <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb843-3"><a href="quasiquotation.html#cb843-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">log</span>(x)</span>
<span id="cb843-4"><a href="quasiquotation.html#cb843-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb843-5"><a href="quasiquotation.html#cb843-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) (x <span class="sc">^</span> lambda <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda</span>
<span id="cb843-6"><a href="quasiquotation.html#cb843-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb843-7"><a href="quasiquotation.html#cb843-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>Re-implement the simple <code>compose()</code> defined below using quasiquotation and
<code>new_function()</code>:</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="quasiquotation.html#cb844-1" aria-hidden="true" tabindex="-1"></a>compose <span class="ot">&lt;-</span> <span class="cf">function</span>(f, g) {</span>
<span id="cb844-2"><a href="quasiquotation.html#cb844-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(...) <span class="fu">f</span>(<span class="fu">g</span>(...))</span>
<span id="cb844-3"><a href="quasiquotation.html#cb844-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
</ol>
</div>
</div>
<div id="history" class="section level2" number="19.8">
<h2><span class="header-section-number">19.8</span> History</h2>
<p>The idea of quasiquotation is an old one. It was first developed by the philosopher Willard van Orman Quine<a href="#fn102" class="footnote-ref" id="fnref102"><sup>102</sup></a> in the early 1940s. It’s needed in philosophy because it helps when precisely delineating the use and mention of words, i.e. distinguishing between the object and the words we use to refer to that object.</p>
<p>Quasiquotation was first used in a programming language, Lisp, in the mid-1970s.<span class="citation"><a href="#fn103" class="footnote-ref" id="fnref103"><sup>103</sup></a></span> Lisp has one quoting function <code>`</code>, and uses <code>,</code> for unquoting. Most languages with a Lisp heritage behave similarly. For example, Racket (<code>`</code> and <code>@</code>), Clojure (<code>`</code> and <code>~</code>), and Julia (<code>:</code> and <code>@</code>) all have quasiquotation tools that differ only slightly from Lisp. These languages have a single quoting function and you must call it explicitly.</p>
<p>In R, however, many functions quote one or more inputs. This introduces ambiguity (because you need to read the documentation to determine if an argument is quoted or not), but allows for concise and elegant data exploration code. In base R, only one function supports quasiquotation: <code>bquote()</code>, written in 2003 by Thomas Lumley. However, <code>bquote()</code> has some major limitations which prevented it from having a wide impact on R code (Section <a href="quasiquotation.html#base-nonquote">19.5</a>).</p>
<p>My attempt to resolve these limitations led to the lazyeval package (2014-2015). Unfortunately, my analysis of the problem was incomplete and while lazyeval solved some problems, it created others. It was not until I started working with Lionel Henry on the problem that all the pieces finally fell into place and we created the full tidy evaluation framework (2017). Despite the newness of tidy evaluation, I teach it here because it is a rich and powerful theory that, once mastered, makes many hard problems much easier.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="95">
<li id="fn95"><p><span>“Programmer’s Niche: Macros in <span>R</span>,”</span> <em>R News</em> 1, no. 3 (2001): 11–13, <a href="https://www.r-project.org/doc/Rnews/Rnews_2001-3.pdf" role="doc-biblioref">https://www.r-project.org/doc/Rnews/Rnews_2001-3.pdf</a>.<a href="quasiquotation.html#fnref95" class="footnote-back">↩︎</a></p></li>
<li id="fn96"><p>This is for compatibility with base R, which allows you to provide a string instead of a symbol in many places: <code>"x" &lt;- 1</code>, <code>"foo"(x, y)</code>, <code>c("x" = 1)</code>.<a href="quasiquotation.html#fnref96" class="footnote-back">↩︎</a></p></li>
<li id="fn97"><p>Discovered by Peter Meilstrup and described in <a href="http://r.789695.n4.nabble.com/substitute-on-arguments-in-ellipsis-quot-dot-dot-dot-quot-td4751658.html">R-devel on 2018-08-13</a>.<a href="quasiquotation.html#fnref97" class="footnote-back">↩︎</a></p></li>
<li id="fn98"><p>Prior to R 3.5.1, there was another major downside: the R deparser treated <code>!!x</code> as <code>!(!x)</code>. This is why in old versions of R you might see extra parentheses when printing expressions. The good news is that these parentheses are not real and can be safely ignored most of the time. The bad news is that they will become real if you reparse that printed output to R code. These roundtripped functions will not work as expected since <code>!(!x)</code> does not unquote.<a href="quasiquotation.html#fnref98" class="footnote-back">↩︎</a></p></li>
<li id="fn99"><p>Unlike, say, Javascript, where <code>!!x</code> is a commonly used shortcut to convert an integer into a logical.<a href="quasiquotation.html#fnref99" class="footnote-back">↩︎</a></p></li>
<li id="fn100"><p>This is admittedly not the most creative of names, but it clearly suggests it’s something that has been added to R after the fact.<a href="quasiquotation.html#fnref100" class="footnote-back">↩︎</a></p></li>
<li id="fn101"><p>Anaphoric comes from the linguistics term “anaphora,” an expression that is context dependent. Anaphoric functions are found in <a href="http://www.arcfn.com/doc/anaphoric.html">Arc</a> (a Lisp like language), <a href="http://www.perlmonks.org/index.pl?node_id=666047">Perl</a>, and <a href="http://amalloy.hubpages.com/hub/Unhygenic-anaphoric-Clojure-macros-for-fun-and-profit">Clojure</a>.<a href="quasiquotation.html#fnref101" class="footnote-back">↩︎</a></p></li>
<li id="fn102"><p>You might be familiar with the name Quine from “quines,” computer programs that return a copy of their own source when run.<a href="quasiquotation.html#fnref102" class="footnote-back">↩︎</a></p></li>
<li id="fn103"><p>Alan Bawden, <span>“Quasiquotation in <span>Lisp</span>,”</span> in <em>PEPM ’99</em>, 1999, 4–12, <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.309.227" role="doc-biblioref">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.309.227</a>.<a href="quasiquotation.html#fnref103" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="expressions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="evaluation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Quotation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
