<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>25 Rewriting R code in C++ | Advanced R</title>
  <meta name="description" content="25 Rewriting R code in C++ | Advanced R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="25 Rewriting R code in C++ | Advanced R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="25 Rewriting R code in C++ | Advanced R" />
  
  
  

<meta name="author" content="Hadley Wickham" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="perf-improve.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141212623-1');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a>
<ul>
<li class="chapter" data-level="2.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Missing values</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercion"><i class="fa fa-check"></i><b>3.2.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.2.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#durations"><i class="fa fa-check"></i><b>3.4.4</b> Durations</a></li>
<li class="chapter" data-level="3.4.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#subsetting-oob"><i class="fa fa-check"></i><b>4.3.3</b> Missing and out-of-bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samples-and-bootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples and bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character )</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-versus-sets-logical-and-integer"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra versus sets (logical and integer )</a></li>
<li class="chapter" data-level="4.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control flow</a>
<ul>
<li class="chapter" data-level="5.1" data-path="control-flow.html"><a href="control-flow.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-flow.html"><a href="control-flow.html#choices"><i class="fa fa-check"></i><b>5.2</b> Choices</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="control-flow.html"><a href="control-flow.html#invalid-inputs"><i class="fa fa-check"></i><b>5.2.1</b> Invalid inputs</a></li>
<li class="chapter" data-level="5.2.2" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i><b>5.2.2</b> Vectorised if</a></li>
<li class="chapter" data-level="5.2.3" data-path="control-flow.html"><a href="control-flow.html#switch"><i class="fa fa-check"></i><b>5.2.3</b> <code>switch()</code> statement</a></li>
<li class="chapter" data-level="5.2.4" data-path="control-flow.html"><a href="control-flow.html#exercises-12"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i><b>5.3.1</b> Common pitfalls</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-flow.html"><a href="control-flow.html#for-family"><i class="fa fa-check"></i><b>5.3.2</b> Related tools</a></li>
<li class="chapter" data-level="5.3.3" data-path="control-flow.html"><a href="control-flow.html#exercises-13"><i class="fa fa-check"></i><b>5.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-flow.html"><a href="control-flow.html#control-flow-answers"><i class="fa fa-check"></i><b>5.4</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#fun-components"><i class="fa fa-check"></i><b>6.2.1</b> Function components</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.2</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.3</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.2.4</b> Invoking a function</a></li>
<li class="chapter" data-level="6.2.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>6.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>6.3</b> Function composition</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.4</b> Lexical scoping</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.4.1</b> Name masking</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#functions-versus-variables"><i class="fa fa-check"></i><b>6.4.2</b> Functions versus variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.4.5" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.5</b> Lazy evaluation</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.5.1</b> Promises</a></li>
<li class="chapter" data-level="6.5.2" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.5.2</b> Default arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.5.3</b> Missing arguments</a></li>
<li class="chapter" data-level="6.5.4" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>6.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>6.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.7</b> Exiting a function</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#implicit-versus-explicit-returns"><i class="fa fa-check"></i><b>6.7.1</b> Implicit versus explicit returns</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#invisible"><i class="fa fa-check"></i><b>6.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.7.3</b> Errors</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.7.5" data-path="functions.html"><a href="functions.html#exercises-18"><i class="fa fa-check"></i><b>6.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.8</b> Function forms</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#prefix-transform"><i class="fa fa-check"></i><b>6.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>6.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="6.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.8.5</b> Special forms</a></li>
<li class="chapter" data-level="6.8.6" data-path="functions.html"><a href="functions.html#exercises-19"><i class="fa fa-check"></i><b>6.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a>
<ul>
<li class="chapter" data-level="7.1" data-path="environments.html"><a href="environments.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#super-assignment--"><i class="fa fa-check"></i><b>7.2.4</b> Super assignment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>7.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a>
<ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#iteration-versus-recursion"><i class="fa fa-check"></i>Iteration versus recursion</a></li>
<li class="chapter" data-level="7.3.1" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#special-environments"><i class="fa fa-check"></i><b>7.4</b> Special environments</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="environments.html"><a href="environments.html#exercises-22"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>7.5</b> Call stacks</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-stack"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-call-stack"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="environments.html"><a href="environments.html#exercises-23"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditions.html"><a href="conditions.html#introduction-7"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-6"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="8.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="conditions.html"><a href="conditions.html#exercises-26"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="conditions.html"><a href="conditions.html#exercises-27"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a>
<ul>
<li class="chapter" data-level="9.1" data-path="functionals.html"><a href="functionals.html#introduction-8"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#map-atomic"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#purrr-shortcuts"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#map-variants"><i class="fa fa-check"></i><b>9.4</b> Map variants</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce family</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="functionals.html"><a href="functionals.html#basics-1"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#base-functionals"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#mathematical-concerns"><i class="fa fa-check"></i><b>9.7.2</b> Mathematical concerns</a></li>
<li class="chapter" data-level="9.7.3" data-path="functionals.html"><a href="functionals.html#exercises-31"><i class="fa fa-check"></i><b>9.7.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a>
<ul>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#introduction-9"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i><b>10.2.3</b> Forcing evaluation</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.4</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.5</b> Garbage collection</a></li>
<li class="chapter" data-level="10.2.6" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> <code>ggsave()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-34"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="function-factories.html"><a href="function-factories.html#exercises-35"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a>
<ul>
<li class="chapter" data-level="11.1" data-path="function-operators.html"><a href="function-operators.html#introduction-10"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing function operators</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="function-operators.html"><a href="function-operators.html#exercises-36"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: Creating your own function operators</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="function-operators.html"><a href="function-operators.html#exercises-37"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object-oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a>
<ul>
<li class="chapter" data-level="12.1" data-path="base-types.html"><a href="base-types.html#introduction-11"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base versus OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a>
<ul>
<li class="chapter" data-level="13.1" data-path="s3.html"><a href="s3.html#introduction-12"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="s3.html"><a href="s3.html#exercises-38"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constructor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="s3.html"><a href="s3.html#exercises-42"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="s3.html"><a href="s3.html#exercises-43"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a>
<ul>
<li class="chapter" data-level="14.1" data-path="r6.html"><a href="r6.html#introduction-13"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#r6-important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="r6.html"><a href="r6.html#exercises-44"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="r6.html"><a href="r6.html#exercises-45"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="r6.html"><a href="r6.html#exercises-46"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a>
<ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-14"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#inheritance-1"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.2</b> Introspection</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.3</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.4</b> Helper</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.5</b> Validator</a></li>
<li class="chapter" data-level="15.3.6" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#exercises-49"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="s4.html"><a href="s4.html#exercises-50"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="s4.html"><a href="s4.html#exercises-51"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a>
<ul>
<li class="chapter" data-level="16.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-15"><i class="fa fa-check"></i><b>16.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 versus S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 versus S3</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="metaprogramming.html"><a href="metaprogramming.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="17" data-path="meta-big-picture.html"><a href="meta-big-picture.html"><i class="fa fa-check"></i><b>17</b> Big picture</a>
<ul>
<li class="chapter" data-level="17.1" data-path="meta-big-picture.html"><a href="meta-big-picture.html#introduction-16"><i class="fa fa-check"></i><b>17.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="meta-big-picture.html"><a href="meta-big-picture.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-data"><i class="fa fa-check"></i><b>17.2</b> Code is data</a></li>
<li class="chapter" data-level="17.3" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-tree"><i class="fa fa-check"></i><b>17.3</b> Code is a tree</a></li>
<li class="chapter" data-level="17.4" data-path="meta-big-picture.html"><a href="meta-big-picture.html#coding-code"><i class="fa fa-check"></i><b>17.4</b> Code can generate code</a></li>
<li class="chapter" data-level="17.5" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-intro"><i class="fa fa-check"></i><b>17.5</b> Evaluation runs code</a></li>
<li class="chapter" data-level="17.6" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-funs"><i class="fa fa-check"></i><b>17.6</b> Customising evaluation with functions</a></li>
<li class="chapter" data-level="17.7" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-data"><i class="fa fa-check"></i><b>17.7</b> Customising evaluation with data</a></li>
<li class="chapter" data-level="17.8" data-path="meta-big-picture.html"><a href="meta-big-picture.html#quosure-intro"><i class="fa fa-check"></i><b>17.8</b> Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#introduction-17"><i class="fa fa-check"></i><b>18.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#ast"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#drawing"><i class="fa fa-check"></i><b>18.2.1</b> Drawing</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#non-code-components"><i class="fa fa-check"></i><b>18.2.2</b> Non-code components</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#infix-calls"><i class="fa fa-check"></i><b>18.2.3</b> Infix calls</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#expression-details"><i class="fa fa-check"></i><b>18.3</b> Expressions</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.3.1</b> Constants</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.3.2</b> Symbols</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.3</b> Calls</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>18.3.4</b> Summary</a></li>
<li class="chapter" data-level="18.3.5" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>18.4</b> Parsing and grammar</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.4.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.4.2</b> Associativity</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#parsing"><i class="fa fa-check"></i><b>18.4.3</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="18.4.4" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>18.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Walking AST with recursive functions</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="expressions.html"><a href="expressions.html#exercises-55"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#expression-special"><i class="fa fa-check"></i><b>18.6</b> Specialised data structures</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.6.1</b> Pairlists</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#empty-symbol"><i class="fa fa-check"></i><b>18.6.2</b> Missing arguments</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#expression-vectors"><i class="fa fa-check"></i><b>18.6.3</b> Expression vectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a>
<ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-18"><i class="fa fa-check"></i><b>19.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#related-work"><i class="fa fa-check"></i>Related work</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-motivation"><i class="fa fa-check"></i><b>19.2</b> Motivation</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-56"><i class="fa fa-check"></i><b>19.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quoting"><i class="fa fa-check"></i><b>19.3</b> Quoting</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-expressions"><i class="fa fa-check"></i><b>19.3.1</b> Capturing expressions</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-symbols"><i class="fa fa-check"></i><b>19.3.2</b> Capturing symbols</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.3</b> With base R</a></li>
<li class="chapter" data-level="19.3.4" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i><b>19.3.4</b> Substitution</a></li>
<li class="chapter" data-level="19.3.5" data-path="quasiquotation.html"><a href="quasiquotation.html#summary-1"><i class="fa fa-check"></i><b>19.3.5</b> Summary</a></li>
<li class="chapter" data-level="19.3.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting"><i class="fa fa-check"></i><b>19.4</b> Unquoting</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-one-argument"><i class="fa fa-check"></i><b>19.4.1</b> Unquoting one argument</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-a-function"><i class="fa fa-check"></i><b>19.4.2</b> Unquoting a function</a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-missing"><i class="fa fa-check"></i><b>19.4.3</b> Unquoting a missing argument</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-in-special-forms"><i class="fa fa-check"></i><b>19.4.4</b> Unquoting in special forms</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-many-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Unquoting many arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.6</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.7" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-ast"><i class="fa fa-check"></i><b>19.4.7</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.8" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>19.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#base-nonquote"><i class="fa fa-check"></i><b>19.5</b> Non-quoting</a></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#tidy-dots"><i class="fa fa-check"></i><b>19.6</b> <code>...</code> (dot-dot-dot)</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#examples"><i class="fa fa-check"></i><b>19.6.1</b> Examples</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exec"><i class="fa fa-check"></i><b>19.6.2</b> <code>exec()</code></a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#do-call"><i class="fa fa-check"></i><b>19.6.4</b> With base R</a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#expr-case-studies"><i class="fa fa-check"></i><b>19.7</b> Case studies</a>
<ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#lobstrast"><i class="fa fa-check"></i><b>19.7.1</b> <code>lobstr::ast()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.7.2</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.7.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#new-function"><i class="fa fa-check"></i><b>19.7.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-60"><i class="fa fa-check"></i><b>19.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="quasiquotation.html"><a href="quasiquotation.html#history"><i class="fa fa-check"></i><b>19.8</b> History</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a>
<ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-19"><i class="fa fa-check"></i><b>20.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-13"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#exercises-61"><i class="fa fa-check"></i><b>20.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#creating"><i class="fa fa-check"></i><b>20.3.1</b> Creating</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.2</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#quosure-dots"><i class="fa fa-check"></i><b>20.3.3</b> Dots</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#quosure-impl"><i class="fa fa-check"></i><b>20.3.4</b> Under the hood</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#nested-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Nested quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4</b> Data masks</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#basics-3"><i class="fa fa-check"></i><b>20.4.1</b> Basics</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#pronouns"><i class="fa fa-check"></i><b>20.4.2</b> Pronouns</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-transform"><i class="fa fa-check"></i><b>20.4.4</b> Application: transform</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#select"><i class="fa fa-check"></i><b>20.4.5</b> Application: <code>select()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.5</b> Using tidy evaluation</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#quoting-and-unquoting"><i class="fa fa-check"></i><b>20.5.1</b> Quoting and unquoting</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i><b>20.5.2</b> Handling ambiguity</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#quoting-and-ambiguity"><i class="fa fa-check"></i><b>20.5.3</b> Quoting and ambiguity</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#exercises-64"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluation.html"><a href="evaluation.html#base-evaluation"><i class="fa fa-check"></i><b>20.6</b> Base evaluation</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i><b>20.6.1</b> <code>substitute()</code></a></li>
<li class="chapter" data-level="20.6.2" data-path="evaluation.html"><a href="evaluation.html#match.call"><i class="fa fa-check"></i><b>20.6.2</b> <code>match.call()</code></a></li>
<li class="chapter" data-level="20.6.3" data-path="evaluation.html"><a href="evaluation.html#exercises-65"><i class="fa fa-check"></i><b>20.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a>
<ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#introduction-20"><i class="fa fa-check"></i><b>21.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prerequisites-14"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#html-env"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#exercises-66"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code>()</a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="translation.html"><a href="translation.html#exercises-67"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="" data-path="techniques.html"><a href="techniques.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a>
<ul>
<li class="chapter" data-level="22.1" data-path="debugging.html"><a href="debugging.html#introduction-21"><i class="fa fa-check"></i><b>22.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-20"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-strategy"><i class="fa fa-check"></i><b>22.2</b> Overall approach</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>22.3</b> Locating errors</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#debug-lazy"><i class="fa fa-check"></i><b>22.3.1</b> Lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="debugging.html"><a href="debugging.html#browser"><i class="fa fa-check"></i><b>22.4</b> Interactive debugger</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="debugging.html"><a href="debugging.html#browser-commands"><i class="fa fa-check"></i><b>22.4.1</b> <code>browser()</code> commands</a></li>
<li class="chapter" data-level="22.4.2" data-path="debugging.html"><a href="debugging.html#alternatives"><i class="fa fa-check"></i><b>22.4.2</b> Alternatives</a></li>
<li class="chapter" data-level="22.4.3" data-path="debugging.html"><a href="debugging.html#debug-compiled"><i class="fa fa-check"></i><b>22.4.3</b> Compiled code</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="debugging.html"><a href="debugging.html#non-interactive-debugging"><i class="fa fa-check"></i><b>22.5</b> Non-interactive debugging</a>
<ul>
<li class="chapter" data-level="22.5.1" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>22.5.1</b> <code>dump.frames()</code></a></li>
<li class="chapter" data-level="22.5.2" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>22.5.2</b> Print debugging</a></li>
<li class="chapter" data-level="22.5.3" data-path="debugging.html"><a href="debugging.html#rmarkdown"><i class="fa fa-check"></i><b>22.5.3</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="debugging.html"><a href="debugging.html#non-error-failures"><i class="fa fa-check"></i><b>22.6</b> Non-error failures</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="perf-measure.html"><a href="perf-measure.html"><i class="fa fa-check"></i><b>23</b> Measuring performance</a>
<ul>
<li class="chapter" data-level="23.1" data-path="perf-measure.html"><a href="perf-measure.html#introduction-22"><i class="fa fa-check"></i><b>23.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#outline-21"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-measure.html"><a href="perf-measure.html#prerequisites-15"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="perf-measure.html"><a href="perf-measure.html#profiling"><i class="fa fa-check"></i><b>23.2</b> Profiling</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="perf-measure.html"><a href="perf-measure.html#visualising-profiles"><i class="fa fa-check"></i><b>23.2.1</b> Visualising profiles</a></li>
<li class="chapter" data-level="23.2.2" data-path="perf-measure.html"><a href="perf-measure.html#memory-profiling"><i class="fa fa-check"></i><b>23.2.2</b> Memory profiling</a></li>
<li class="chapter" data-level="23.2.3" data-path="perf-measure.html"><a href="perf-measure.html#limitations"><i class="fa fa-check"></i><b>23.2.3</b> Limitations</a></li>
<li class="chapter" data-level="23.2.4" data-path="perf-measure.html"><a href="perf-measure.html#exercises-68"><i class="fa fa-check"></i><b>23.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="perf-measure.html"><a href="perf-measure.html#microbenchmarking"><i class="fa fa-check"></i><b>23.3</b> Microbenchmarking</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="perf-measure.html"><a href="perf-measure.html#benchmark-results"><i class="fa fa-check"></i><b>23.3.1</b> <code>bench::mark()</code> results</a></li>
<li class="chapter" data-level="23.3.2" data-path="perf-measure.html"><a href="perf-measure.html#interpreting-results"><i class="fa fa-check"></i><b>23.3.2</b> Interpreting results</a></li>
<li class="chapter" data-level="23.3.3" data-path="perf-measure.html"><a href="perf-measure.html#exercises-69"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="perf-improve.html"><a href="perf-improve.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a>
<ul>
<li class="chapter" data-level="24.1" data-path="perf-improve.html"><a href="perf-improve.html#introduction-23"><i class="fa fa-check"></i><b>24.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#outline-22"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="perf-improve.html"><a href="perf-improve.html#prerequisites-16"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="perf-improve.html"><a href="perf-improve.html#code-organisation"><i class="fa fa-check"></i><b>24.2</b> Code organisation</a></li>
<li class="chapter" data-level="24.3" data-path="perf-improve.html"><a href="perf-improve.html#already-solved"><i class="fa fa-check"></i><b>24.3</b> Checking for existing solutions</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-70"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="perf-improve.html"><a href="perf-improve.html#be-lazy"><i class="fa fa-check"></i><b>24.4</b> Doing as little as possible</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="perf-improve.html"><a href="perf-improve.html#mean"><i class="fa fa-check"></i><b>24.4.1</b> <code>mean()</code></a></li>
<li class="chapter" data-level="24.4.2" data-path="perf-improve.html"><a href="perf-improve.html#as.data.frame"><i class="fa fa-check"></i><b>24.4.2</b> <code>as.data.frame()</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="perf-improve.html"><a href="perf-improve.html#exercises-71"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="perf-improve.html"><a href="perf-improve.html#vectorise"><i class="fa fa-check"></i><b>24.5</b> Vectorise</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="perf-improve.html"><a href="perf-improve.html#exercises-72"><i class="fa fa-check"></i><b>24.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="perf-improve.html"><a href="perf-improve.html#avoid-copies"><i class="fa fa-check"></i><b>24.6</b> Avoiding copies</a></li>
<li class="chapter" data-level="24.7" data-path="perf-improve.html"><a href="perf-improve.html#t-test"><i class="fa fa-check"></i><b>24.7</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.8" data-path="perf-improve.html"><a href="perf-improve.html#more-techniques"><i class="fa fa-check"></i><b>24.8</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a>
<ul>
<li class="chapter" data-level="25.1" data-path="rcpp.html"><a href="rcpp.html#introduction-24"><i class="fa fa-check"></i><b>25.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-23"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequisites-17"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.5</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#exercise-started"><i class="fa fa-check"></i><b>25.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Other classes</a>
<ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="rcpp.html"><a href="rcpp.html#attributes-1"><i class="fa fa-check"></i><b>25.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-73"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.5</b> Standard Template Library</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.5.3</b> Data structures</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.5.4</b> Vectors</a></li>
<li class="chapter" data-level="25.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.5.5</b> Sets</a></li>
<li class="chapter" data-level="25.5.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>25.5.6</b> Map</a></li>
<li class="chapter" data-level="25.5.7" data-path="rcpp.html"><a href="rcpp.html#exercises-74"><i class="fa fa-check"></i><b>25.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.6</b> Case studies</a>
<ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-versus-c-vectorisation"><i class="fa fa-check"></i><b>25.6.2</b> R vectorisation versus C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.8</b> Learning more</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.9</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rcpp" class="section level1" number="25">
<h1><span class="header-section-number">25</span> Rewriting R code in C++</h1>
<div id="introduction-24" class="section level2" number="25.1">
<h2><span class="header-section-number">25.1</span> Introduction</h2>
<p>Sometimes R code just isn’t fast enough. You’ve used profiling to figure out where your bottlenecks are, and you’ve done everything you can in R, but your code still isn’t fast enough. In this chapter you’ll learn how to improve performance by rewriting key functions in C++. This magic comes by way of the <a href="http://www.rcpp.org/">Rcpp</a> package<span class="citation"><a href="#fn117" class="footnote-ref" id="fnref117"><sup>117</sup></a></span> (with key contributions by Doug Bates, John Chambers, and JJ Allaire).</p>
<p>Rcpp makes it very simple to connect C++ to R. While it is <em>possible</em> to write C or Fortran code for use in R, it will be painful by comparison. Rcpp provides a clean, approachable API that lets you write high-performance code, insulated from R’s complex C API.  </p>
<p>Typical bottlenecks that C++ can address include:</p>
<ul>
<li><p>Loops that can’t be easily vectorised because subsequent iterations depend
on previous ones.</p></li>
<li><p>Recursive functions, or problems which involve calling functions millions of
times. The overhead of calling a function in C++ is much lower than in R.</p></li>
<li><p>Problems that require advanced data structures and algorithms that R doesn’t
provide. Through the standard template library (STL), C++ has efficient
implementations of many important data structures, from ordered maps to
double-ended queues.</p></li>
</ul>
<p>The aim of this chapter is to discuss only those aspects of C++ and Rcpp that are absolutely necessary to help you eliminate bottlenecks in your code. We won’t spend much time on advanced features like object-oriented programming or templates because the focus is on writing small, self-contained functions, not big programs. A working knowledge of C++ is helpful, but not essential. Many good tutorials and references are freely available, including <a href="http://www.learncpp.com/" class="uri">http://www.learncpp.com/</a> and <a href="https://en.cppreference.com/w/cpp" class="uri">https://en.cppreference.com/w/cpp</a>. For more advanced topics, the <em>Effective C++</em> series by Scott Meyers is a popular choice.</p>
<div id="outline-23" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="rcpp.html#rcpp-intro">25.2</a> teaches you how to write C++ by
converting simple R functions to their C++ equivalents. You’ll learn how
C++ differs from R, and what the key scalar, vector, and matrix classes
are called.</p></li>
<li><p>Section <a href="rcpp.html#sourceCpp">25.2.5</a> shows you how to use <code>sourceCpp()</code> to load
a C++ file from disk in the same way you use <code>source()</code> to load a file of
R code.</p></li>
<li><p>Section <a href="rcpp.html#rcpp-classes">25.3</a> discusses how to modify
attributes from Rcpp, and mentions some of the other important classes.</p></li>
<li><p>Section <a href="rcpp.html#rcpp-na">25.4</a> teaches you how to work with R’s missing values
in C++.</p></li>
<li><p>Section <a href="rcpp.html#stl">25.5</a> shows you how to use some of the most important data
structures and algorithms from the standard template library, or STL,
built-in to C++.</p></li>
<li><p>Section <a href="rcpp.html#rcpp-case-studies">25.6</a> shows two real case studies where
Rcpp was used to get considerable performance improvements.</p></li>
<li><p>Section <a href="rcpp.html#rcpp-package">25.7</a> teaches you how to add C++ code
to a package.</p></li>
<li><p>Section <a href="rcpp.html#rcpp-more">25.8</a> concludes the chapter with pointers to
more resources to help you learn Rcpp and C++.</p></li>
</ul>
</div>
<div id="prerequisites-17" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>We’ll use <a href="http://www.rcpp.org/">Rcpp</a> to call C++ from R:</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="rcpp.html#cb999-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span></code></pre></div>
<p>You’ll also need a working C++ compiler. To get it:</p>
<ul>
<li>On Windows, install <a href="http://cran.r-project.org/bin/windows/Rtools/">Rtools</a>.</li>
<li>On Mac, install Xcode from the app store.</li>
<li>On Linux, <code>sudo apt-get install r-base-dev</code> or similar.</li>
</ul>
</div>
</div>
<div id="rcpp-intro" class="section level2" number="25.2">
<h2><span class="header-section-number">25.2</span> Getting started with C++</h2>
<p><code>cppFunction()</code> allows you to write C++ functions in R: </p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="rcpp.html#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;int add(int x, int y, int z) {</span></span>
<span id="cb1000-2"><a href="rcpp.html#cb1000-2" aria-hidden="true" tabindex="-1"></a><span class="st">  int sum = x + y + z;</span></span>
<span id="cb1000-3"><a href="rcpp.html#cb1000-3" aria-hidden="true" tabindex="-1"></a><span class="st">  return sum;</span></span>
<span id="cb1000-4"><a href="rcpp.html#cb1000-4" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span>
<span id="cb1000-5"><a href="rcpp.html#cb1000-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add works like a regular R function</span></span>
<span id="cb1000-6"><a href="rcpp.html#cb1000-6" aria-hidden="true" tabindex="-1"></a>add</span>
<span id="cb1000-7"><a href="rcpp.html#cb1000-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (x, y, z) </span></span>
<span id="cb1000-8"><a href="rcpp.html#cb1000-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; .Call(&lt;pointer: 0x7f72392f0480&gt;, x, y, z)</span></span>
<span id="cb1000-9"><a href="rcpp.html#cb1000-9" aria-hidden="true" tabindex="-1"></a><span class="fu">add</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1000-10"><a href="rcpp.html#cb1000-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 6</span></span></code></pre></div>
<p>When you run this code, Rcpp will compile the C++ code and construct an R function that connects to the compiled C++ function. There’s a lot going on underneath the hood but Rcpp takes care of all the details so you don’t need to worry about them.</p>
<p>The following sections will teach you the basics by translating simple R functions to their C++ equivalents. We’ll start simple with a function that has no inputs and a scalar output, and then make it progressively more complicated:</p>
<ul>
<li>Scalar input and scalar output</li>
<li>Vector input and scalar output</li>
<li>Vector input and vector output</li>
<li>Matrix input and vector output</li>
</ul>
<div id="no-inputs-scalar-output" class="section level3" number="25.2.1">
<h3><span class="header-section-number">25.2.1</span> No inputs, scalar output</h3>
<p>Let’s start with a very simple function. It has no arguments and always returns the integer 1:</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="rcpp.html#cb1001-1" aria-hidden="true" tabindex="-1"></a>one <span class="ot">&lt;-</span> <span class="cf">function</span>() 1L</span></code></pre></div>
<p>The equivalent C++ function is:</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1002-1"><a href="rcpp.html#cb1002-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> one() {</span>
<span id="cb1002-2"><a href="rcpp.html#cb1002-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb1002-3"><a href="rcpp.html#cb1002-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can compile and use this from R with <code>cppFunction()</code></p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="rcpp.html#cb1003-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;int one() {</span></span>
<span id="cb1003-2"><a href="rcpp.html#cb1003-2" aria-hidden="true" tabindex="-1"></a><span class="st">  return 1;</span></span>
<span id="cb1003-3"><a href="rcpp.html#cb1003-3" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<p>This small function illustrates a number of important differences between R and C++:</p>
<ul>
<li><p>The syntax to create a function looks like the syntax to call a function;
you don’t use assignment to create functions as you do in R.</p></li>
<li><p>You must declare the type of output the function returns. This function
returns an <code>int</code> (a scalar integer). The classes for the most common types
of R vectors are: <code>NumericVector</code>, <code>IntegerVector</code>, <code>CharacterVector</code>, and
<code>LogicalVector</code>.</p></li>
<li><p>Scalars and vectors are different. The scalar equivalents of numeric,
integer, character, and logical vectors are: <code>double</code>, <code>int</code>, <code>String</code>, and
<code>bool</code>.</p></li>
<li><p>You must use an explicit <code>return</code> statement to return a value from a
function.</p></li>
<li><p>Every statement is terminated by a <code>;</code>.</p></li>
</ul>
</div>
<div id="scalar-input-scalar-output" class="section level3" number="25.2.2">
<h3><span class="header-section-number">25.2.2</span> Scalar input, scalar output</h3>
<p>The next example function implements a scalar version of the <code>sign()</code> function which returns 1 if the input is positive, and -1 if it’s negative:</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="rcpp.html#cb1004-1" aria-hidden="true" tabindex="-1"></a>signR <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1004-2"><a href="rcpp.html#cb1004-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1004-3"><a href="rcpp.html#cb1004-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span></span>
<span id="cb1004-4"><a href="rcpp.html#cb1004-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1004-5"><a href="rcpp.html#cb1004-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb1004-6"><a href="rcpp.html#cb1004-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1004-7"><a href="rcpp.html#cb1004-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb1004-8"><a href="rcpp.html#cb1004-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1004-9"><a href="rcpp.html#cb1004-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1004-10"><a href="rcpp.html#cb1004-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-11"><a href="rcpp.html#cb1004-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;int signC(int x) {</span></span>
<span id="cb1004-12"><a href="rcpp.html#cb1004-12" aria-hidden="true" tabindex="-1"></a><span class="st">  if (x &gt; 0) {</span></span>
<span id="cb1004-13"><a href="rcpp.html#cb1004-13" aria-hidden="true" tabindex="-1"></a><span class="st">    return 1;</span></span>
<span id="cb1004-14"><a href="rcpp.html#cb1004-14" aria-hidden="true" tabindex="-1"></a><span class="st">  } else if (x == 0) {</span></span>
<span id="cb1004-15"><a href="rcpp.html#cb1004-15" aria-hidden="true" tabindex="-1"></a><span class="st">    return 0;</span></span>
<span id="cb1004-16"><a href="rcpp.html#cb1004-16" aria-hidden="true" tabindex="-1"></a><span class="st">  } else {</span></span>
<span id="cb1004-17"><a href="rcpp.html#cb1004-17" aria-hidden="true" tabindex="-1"></a><span class="st">    return -1;</span></span>
<span id="cb1004-18"><a href="rcpp.html#cb1004-18" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1004-19"><a href="rcpp.html#cb1004-19" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<p>In the C++ version:</p>
<ul>
<li><p>We declare the type of each input in the same way we declare the type of the
output. While this makes the code a little more verbose, it also makes clear
the type of input the function needs.</p></li>
<li><p>The <code>if</code> syntax is identical — while there are some big differences between
R and C++, there are also lots of similarities! C++ also has a <code>while</code>
statement that works the same way as R’s. As in R you can use <code>break</code> to
exit the loop, but to skip one iteration you need to use <code>continue</code> instead
of <code>next</code>.</p></li>
</ul>
</div>
<div id="vector-input-scalar-output" class="section level3" number="25.2.3">
<h3><span class="header-section-number">25.2.3</span> Vector input, scalar output</h3>
<p>One big difference between R and C++ is that the cost of loops is much lower in C++. For example, we could implement the <code>sum</code> function in R using a loop. If you’ve been programming in R a while, you’ll probably have a visceral reaction to this function!</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="rcpp.html#cb1005-1" aria-hidden="true" tabindex="-1"></a>sumR <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1005-2"><a href="rcpp.html#cb1005-2" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1005-3"><a href="rcpp.html#cb1005-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb1005-4"><a href="rcpp.html#cb1005-4" aria-hidden="true" tabindex="-1"></a>    total <span class="ot">&lt;-</span> total <span class="sc">+</span> x[i]</span>
<span id="cb1005-5"><a href="rcpp.html#cb1005-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1005-6"><a href="rcpp.html#cb1005-6" aria-hidden="true" tabindex="-1"></a>  total</span>
<span id="cb1005-7"><a href="rcpp.html#cb1005-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In C++, loops have very little overhead, so it’s fine to use them. In Section <a href="rcpp.html#stl">25.5</a>, you’ll see alternatives to <code>for</code> loops that more clearly express your intent; they’re not faster, but they can make your code easier to understand.</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="rcpp.html#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;double sumC(NumericVector x) {</span></span>
<span id="cb1006-2"><a href="rcpp.html#cb1006-2" aria-hidden="true" tabindex="-1"></a><span class="st">  int n = x.size();</span></span>
<span id="cb1006-3"><a href="rcpp.html#cb1006-3" aria-hidden="true" tabindex="-1"></a><span class="st">  double total = 0;</span></span>
<span id="cb1006-4"><a href="rcpp.html#cb1006-4" aria-hidden="true" tabindex="-1"></a><span class="st">  for(int i = 0; i &lt; n; ++i) {</span></span>
<span id="cb1006-5"><a href="rcpp.html#cb1006-5" aria-hidden="true" tabindex="-1"></a><span class="st">    total += x[i];</span></span>
<span id="cb1006-6"><a href="rcpp.html#cb1006-6" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1006-7"><a href="rcpp.html#cb1006-7" aria-hidden="true" tabindex="-1"></a><span class="st">  return total;</span></span>
<span id="cb1006-8"><a href="rcpp.html#cb1006-8" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<p>The C++ version is similar, but:</p>
<ul>
<li><p>To find the length of the vector, we use the <code>.size()</code> method, which returns
an integer. C++ methods are called with <code>.</code> (i.e., a full stop).</p></li>
<li><p>The <code>for</code> statement has a different syntax: <code>for(init; check; increment)</code>.
This loop is initialised by creating a new variable called <code>i</code> with value 0.
Before each iteration we check that <code>i &lt; n</code>, and terminate the loop if it’s
not. After each iteration, we increment the value of <code>i</code> by one, using the
special prefix operator <code>++</code> which increases the value of <code>i</code> by 1.</p></li>
<li><p>In C++, vector indices start at 0, which means that the last element is
at position <code>n - 1</code>. I’ll say this again because it’s so important:
<strong>IN C++, VECTOR INDICES START AT 0</strong>! This is a very common
source of bugs when converting R functions to C++.</p></li>
<li><p>Use <code>=</code> for assignment, not <code>&lt;-</code>.</p></li>
<li><p>C++ provides operators that modify in-place: <code>total += x[i]</code> is equivalent to
<code>total = total + x[i]</code>. Similar in-place operators are <code>-=</code>, <code>*=</code>, and <code>/=</code>.</p></li>
</ul>
<p>This is a good example of where C++ is much more efficient than R. As shown by the following microbenchmark, <code>sumC()</code> is competitive with the built-in (and highly optimised) <code>sum()</code>, while <code>sumR()</code> is several orders of magnitude slower.</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="rcpp.html#cb1007-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e3</span>)</span>
<span id="cb1007-2"><a href="rcpp.html#cb1007-2" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb1007-3"><a href="rcpp.html#cb1007-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x),</span>
<span id="cb1007-4"><a href="rcpp.html#cb1007-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sumC</span>(x),</span>
<span id="cb1007-5"><a href="rcpp.html#cb1007-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sumR</span>(x)</span>
<span id="cb1007-6"><a href="rcpp.html#cb1007-6" aria-hidden="true" tabindex="-1"></a>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb1007-7"><a href="rcpp.html#cb1007-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb1007-8"><a href="rcpp.html#cb1007-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb1007-9"><a href="rcpp.html#cb1007-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb1007-10"><a href="rcpp.html#cb1007-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 sum(x)        1.2µs    1.3µs   700238.        0B        0</span></span>
<span id="cb1007-11"><a href="rcpp.html#cb1007-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 sumC(x)       3.1µs    5.2µs   202997.    2.49KB        0</span></span>
<span id="cb1007-12"><a href="rcpp.html#cb1007-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sumR(x)        35µs   35.4µs    27883.  126.53KB        0</span></span></code></pre></div>
</div>
<div id="vector-input-vector-output" class="section level3" number="25.2.4">
<h3><span class="header-section-number">25.2.4</span> Vector input, vector output</h3>
<!-- FIXME: come up with better example. Also fix in two other places it occurs -->
<p>Next we’ll create a function that computes the Euclidean distance between a value and a vector of values:</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="rcpp.html#cb1008-1" aria-hidden="true" tabindex="-1"></a>pdistR <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ys) {</span>
<span id="cb1008-2"><a href="rcpp.html#cb1008-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((x <span class="sc">-</span> ys) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb1008-3"><a href="rcpp.html#cb1008-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In R, it’s not obvious that we want <code>x</code> to be a scalar from the function definition, and we’d need to make that clear in the documentation. That’s not a problem in the C++ version because we have to be explicit about types:</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="rcpp.html#cb1009-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cppFunction</span>(<span class="st">&#39;NumericVector pdistC(double x, NumericVector ys) {</span></span>
<span id="cb1009-2"><a href="rcpp.html#cb1009-2" aria-hidden="true" tabindex="-1"></a><span class="st">  int n = ys.size();</span></span>
<span id="cb1009-3"><a href="rcpp.html#cb1009-3" aria-hidden="true" tabindex="-1"></a><span class="st">  NumericVector out(n);</span></span>
<span id="cb1009-4"><a href="rcpp.html#cb1009-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-5"><a href="rcpp.html#cb1009-5" aria-hidden="true" tabindex="-1"></a><span class="st">  for(int i = 0; i &lt; n; ++i) {</span></span>
<span id="cb1009-6"><a href="rcpp.html#cb1009-6" aria-hidden="true" tabindex="-1"></a><span class="st">    out[i] = sqrt(pow(ys[i] - x, 2.0));</span></span>
<span id="cb1009-7"><a href="rcpp.html#cb1009-7" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1009-8"><a href="rcpp.html#cb1009-8" aria-hidden="true" tabindex="-1"></a><span class="st">  return out;</span></span>
<span id="cb1009-9"><a href="rcpp.html#cb1009-9" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span>)</span></code></pre></div>
<p>This function introduces only a few new concepts:</p>
<ul>
<li><p>We create a new numeric vector of length <code>n</code> with a constructor:
<code>NumericVector out(n)</code>. Another useful way of making a vector is to copy an
existing one: <code>NumericVector zs = clone(ys)</code>.</p></li>
<li><p>C++ uses <code>pow()</code>, not <code>^</code>, for exponentiation.</p></li>
</ul>
<p>Note that because the R version is fully vectorised, it’s already going to be fast.</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="rcpp.html#cb1010-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e6</span>)</span>
<span id="cb1010-2"><a href="rcpp.html#cb1010-2" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb1010-3"><a href="rcpp.html#cb1010-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdistR</span>(<span class="fl">0.5</span>, y),</span>
<span id="cb1010-4"><a href="rcpp.html#cb1010-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdistC</span>(<span class="fl">0.5</span>, y)</span>
<span id="cb1010-5"><a href="rcpp.html#cb1010-5" aria-hidden="true" tabindex="-1"></a>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb1010-6"><a href="rcpp.html#cb1010-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb1010-7"><a href="rcpp.html#cb1010-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expression          min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb1010-8"><a href="rcpp.html#cb1010-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;bch:expr&gt;     &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb1010-9"><a href="rcpp.html#cb1010-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 pdistR(0.5, y)    6.6ms   6.85ms      146.    7.63MB     72.9</span></span>
<span id="cb1010-10"><a href="rcpp.html#cb1010-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 pdistC(0.5, y)   8.93ms   9.01ms      111.    7.63MB     68.3</span></span></code></pre></div>
<p>On my computer, it takes around 5 ms with a 1 million element <code>y</code> vector. The C++ function is about 2.5 times faster, ~2 ms, but assuming it took you 10 minutes to write the C++ function, you’d need to run it ~200,000 times to make rewriting worthwhile. The reason why the C++ function is faster is subtle, and relates to memory management. The R version needs to create an intermediate vector the same length as y (<code>x - ys</code>), and allocating memory is an expensive operation. The C++ function avoids this overhead because it uses an intermediate scalar.</p>
</div>
<div id="sourceCpp" class="section level3" number="25.2.5">
<h3><span class="header-section-number">25.2.5</span> Using sourceCpp</h3>
<p>So far, we’ve used inline C++ with <code>cppFunction()</code>. This makes presentation simpler, but for real problems, it’s usually easier to use stand-alone C++ files and then source them into R using <code>sourceCpp()</code>. This lets you take advantage of text editor support for C++ files (e.g., syntax highlighting) as well as making it easier to identify the line numbers in compilation errors. </p>
<p>Your stand-alone C++ file should have extension <code>.cpp</code>, and needs to start with:</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1011-1"><a href="rcpp.html#cb1011-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1011-2"><a href="rcpp.html#cb1011-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span></code></pre></div>
<p>And for each function that you want available within R, you need to prefix it with:</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1012-1"><a href="rcpp.html#cb1012-1" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span></code></pre></div>
<div class="sidebar">
<p>If you’re familiar with roxygen2, you might wonder how this relates to <code>@export</code>. <code>Rcpp::export</code> controls whether a function is exported from C++ to R; <code>@export</code> controls whether a function is exported from a package and made available to the user.</p>
</div>
<p>You can embed R code in special C++ comment blocks. This is really convenient if you want to run some test code:</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1013-1"><a href="rcpp.html#cb1013-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb1013-2"><a href="rcpp.html#cb1013-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This is R code</span></span>
<span id="cb1013-3"><a href="rcpp.html#cb1013-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>The R code is run with <code>source(echo = TRUE)</code> so you don’t need to explicitly print output.</p>
<p>To compile the C++ code, use <code>sourceCpp("path/to/file.cpp")</code>. This will create the matching R functions and add them to your current session. Note that these functions can not be saved in a <code>.Rdata</code> file and reloaded in a later session; they must be recreated each time you restart R.</p>
<p>For example, running <code>sourceCpp()</code> on the following file implements mean in C++ and then compares it to the built-in <code>mean()</code>:</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1014-1"><a href="rcpp.html#cb1014-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1014-2"><a href="rcpp.html#cb1014-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1014-3"><a href="rcpp.html#cb1014-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-4"><a href="rcpp.html#cb1014-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1014-5"><a href="rcpp.html#cb1014-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> meanC(NumericVector x) {</span>
<span id="cb1014-6"><a href="rcpp.html#cb1014-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1014-7"><a href="rcpp.html#cb1014-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> total = <span class="dv">0</span>;</span>
<span id="cb1014-8"><a href="rcpp.html#cb1014-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-9"><a href="rcpp.html#cb1014-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1014-10"><a href="rcpp.html#cb1014-10" aria-hidden="true" tabindex="-1"></a>    total += x[i];</span>
<span id="cb1014-11"><a href="rcpp.html#cb1014-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1014-12"><a href="rcpp.html#cb1014-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> total / n;</span>
<span id="cb1014-13"><a href="rcpp.html#cb1014-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1014-14"><a href="rcpp.html#cb1014-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1014-15"><a href="rcpp.html#cb1014-15" aria-hidden="true" tabindex="-1"></a><span class="co">/*** R</span></span>
<span id="cb1014-16"><a href="rcpp.html#cb1014-16" aria-hidden="true" tabindex="-1"></a><span class="co">x &lt;- runif(1e5)</span></span>
<span id="cb1014-17"><a href="rcpp.html#cb1014-17" aria-hidden="true" tabindex="-1"></a><span class="co">bench::mark(</span></span>
<span id="cb1014-18"><a href="rcpp.html#cb1014-18" aria-hidden="true" tabindex="-1"></a><span class="co">  mean(x),</span></span>
<span id="cb1014-19"><a href="rcpp.html#cb1014-19" aria-hidden="true" tabindex="-1"></a><span class="co">  meanC(x)</span></span>
<span id="cb1014-20"><a href="rcpp.html#cb1014-20" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb1014-21"><a href="rcpp.html#cb1014-21" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p>NB: If you run this code, you’ll notice that <code>meanC()</code> is much faster than the built-in <code>mean()</code>. This is because it trades numerical accuracy for speed.</p>
<p>For the remainder of this chapter C++ code will be presented stand-alone rather than wrapped in a call to <code>cppFunction</code>. If you want to try compiling and/or modifying the examples you should paste them into a C++ source file that includes the elements described above. This is easy to do in RMarkdown: all you need to do is specify <code>engine = "Rcpp"</code>.</p>
</div>
<div id="exercise-started" class="section level3" number="25.2.6">
<h3><span class="header-section-number">25.2.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>With the basics of C++ in hand, it’s now a great time to practice by reading
and writing some simple C++ functions. For each of the following functions,
read the code and figure out what the corresponding base R function is. You
might not understand every part of the code yet, but you should be able to
figure out the basics of what the function does.</p>
<div class="sourceCode" id="cb1015"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1015-1"><a href="rcpp.html#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> f1(NumericVector x) {</span>
<span id="cb1015-2"><a href="rcpp.html#cb1015-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1015-3"><a href="rcpp.html#cb1015-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> y = <span class="dv">0</span>;</span>
<span id="cb1015-4"><a href="rcpp.html#cb1015-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-5"><a href="rcpp.html#cb1015-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1015-6"><a href="rcpp.html#cb1015-6" aria-hidden="true" tabindex="-1"></a>    y += x[i] / n;</span>
<span id="cb1015-7"><a href="rcpp.html#cb1015-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1015-8"><a href="rcpp.html#cb1015-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y;</span>
<span id="cb1015-9"><a href="rcpp.html#cb1015-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1015-10"><a href="rcpp.html#cb1015-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-11"><a href="rcpp.html#cb1015-11" aria-hidden="true" tabindex="-1"></a>NumericVector f2(NumericVector x) {</span>
<span id="cb1015-12"><a href="rcpp.html#cb1015-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1015-13"><a href="rcpp.html#cb1015-13" aria-hidden="true" tabindex="-1"></a>  NumericVector out(n);</span>
<span id="cb1015-14"><a href="rcpp.html#cb1015-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-15"><a href="rcpp.html#cb1015-15" aria-hidden="true" tabindex="-1"></a>  out[<span class="dv">0</span>] = x[<span class="dv">0</span>];</span>
<span id="cb1015-16"><a href="rcpp.html#cb1015-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">1</span>; i &lt; n; ++i) {</span>
<span id="cb1015-17"><a href="rcpp.html#cb1015-17" aria-hidden="true" tabindex="-1"></a>    out[i] = out[i - <span class="dv">1</span>] + x[i];</span>
<span id="cb1015-18"><a href="rcpp.html#cb1015-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1015-19"><a href="rcpp.html#cb1015-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1015-20"><a href="rcpp.html#cb1015-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1015-21"><a href="rcpp.html#cb1015-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-22"><a href="rcpp.html#cb1015-22" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> f3(LogicalVector x) {</span>
<span id="cb1015-23"><a href="rcpp.html#cb1015-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1015-24"><a href="rcpp.html#cb1015-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-25"><a href="rcpp.html#cb1015-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1015-26"><a href="rcpp.html#cb1015-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[i]) <span class="cf">return</span> <span class="kw">true</span>;</span>
<span id="cb1015-27"><a href="rcpp.html#cb1015-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1015-28"><a href="rcpp.html#cb1015-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">false</span>;</span>
<span id="cb1015-29"><a href="rcpp.html#cb1015-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1015-30"><a href="rcpp.html#cb1015-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-31"><a href="rcpp.html#cb1015-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> f4(Function pred, List x) {</span>
<span id="cb1015-32"><a href="rcpp.html#cb1015-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1015-33"><a href="rcpp.html#cb1015-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-34"><a href="rcpp.html#cb1015-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1015-35"><a href="rcpp.html#cb1015-35" aria-hidden="true" tabindex="-1"></a>    LogicalVector res = pred(x[i]);</span>
<span id="cb1015-36"><a href="rcpp.html#cb1015-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (res[<span class="dv">0</span>]) <span class="cf">return</span> i + <span class="dv">1</span>;</span>
<span id="cb1015-37"><a href="rcpp.html#cb1015-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1015-38"><a href="rcpp.html#cb1015-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb1015-39"><a href="rcpp.html#cb1015-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1015-40"><a href="rcpp.html#cb1015-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-41"><a href="rcpp.html#cb1015-41" aria-hidden="true" tabindex="-1"></a>NumericVector f5(NumericVector x, NumericVector y) {</span>
<span id="cb1015-42"><a href="rcpp.html#cb1015-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = <span class="bu">std::</span>max(x.size(), y.size());</span>
<span id="cb1015-43"><a href="rcpp.html#cb1015-43" aria-hidden="true" tabindex="-1"></a>  NumericVector x1 = rep_len(x, n);</span>
<span id="cb1015-44"><a href="rcpp.html#cb1015-44" aria-hidden="true" tabindex="-1"></a>  NumericVector y1 = rep_len(y, n);</span>
<span id="cb1015-45"><a href="rcpp.html#cb1015-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-46"><a href="rcpp.html#cb1015-46" aria-hidden="true" tabindex="-1"></a>  NumericVector out(n);</span>
<span id="cb1015-47"><a href="rcpp.html#cb1015-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-48"><a href="rcpp.html#cb1015-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1015-49"><a href="rcpp.html#cb1015-49" aria-hidden="true" tabindex="-1"></a>    out[i] = <span class="bu">std::</span>min(x1[i], y1[i]);</span>
<span id="cb1015-50"><a href="rcpp.html#cb1015-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1015-51"><a href="rcpp.html#cb1015-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1015-52"><a href="rcpp.html#cb1015-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1015-53"><a href="rcpp.html#cb1015-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>To practice your function writing skills, convert the following functions
into C++. For now, assume the inputs have no missing values.</p>
<ol style="list-style-type: decimal">
<li><p><code>all()</code>.</p></li>
<li><p><code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code>.</p></li>
<li><p><code>diff()</code>. Start by assuming lag 1, and then generalise for lag <code>n</code>.</p></li>
<li><p><code>range()</code>.</p></li>
<li><p><code>var()</code>. Read about the approaches you can take on
<a href="http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance">Wikipedia</a>.
Whenever implementing a numerical algorithm, it’s always good to check
what is already known about the problem.</p></li>
</ol></li>
</ol>
</div>
</div>
<div id="rcpp-classes" class="section level2" number="25.3">
<h2><span class="header-section-number">25.3</span> Other classes</h2>
<p>You’ve already seen the basic vector classes (<code>IntegerVector</code>, <code>NumericVector</code>, <code>LogicalVector</code>, <code>CharacterVector</code>) and their scalar (<code>int</code>, <code>double</code>, <code>bool</code>, <code>String</code>) equivalents. Rcpp also provides wrappers for all other base data types. The most important are for lists and data frames, functions, and attributes, as described below. Rcpp also provides classes for more types like <code>Environment</code>, <code>DottedPair</code>, <code>Language</code>, <code>Symbol</code>, etc, but these are beyond the scope of this chapter.</p>
<div id="lists-and-data-frames" class="section level3" number="25.3.1">
<h3><span class="header-section-number">25.3.1</span> Lists and data frames</h3>
<p>Rcpp also provides <code>List</code> and <code>DataFrame</code> classes, but they are more useful for output than input. This is because lists and data frames can contain arbitrary classes but C++ needs to know their classes in advance. If the list has known structure (e.g., it’s an S3 object), you can extract the components and manually convert them to their C++ equivalents with <code>as()</code>. For example, the object created by <code>lm()</code>, the function that fits a linear model, is a list whose components are always of the same type. The following code illustrates how you might extract the mean percentage error (<code>mpe()</code>) of a linear model. This isn’t a good example of when to use C++, because it’s so easily implemented in R, but it shows how to work with an important S3 class. Note the use of <code>.inherits()</code> and the <code>stop()</code> to check that the object really is a linear model.  </p>
<!-- FIXME: needs better motivation -->
<div class="sourceCode" id="cb1016"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1016-1"><a href="rcpp.html#cb1016-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1016-2"><a href="rcpp.html#cb1016-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1016-3"><a href="rcpp.html#cb1016-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-4"><a href="rcpp.html#cb1016-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1016-5"><a href="rcpp.html#cb1016-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> mpe(List mod) {</span>
<span id="cb1016-6"><a href="rcpp.html#cb1016-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (!mod.inherits(<span class="st">&quot;lm&quot;</span>)) stop(<span class="st">&quot;Input must be a linear model&quot;</span>);</span>
<span id="cb1016-7"><a href="rcpp.html#cb1016-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-8"><a href="rcpp.html#cb1016-8" aria-hidden="true" tabindex="-1"></a>  NumericVector resid = as&lt;NumericVector&gt;(mod[<span class="st">&quot;residuals&quot;</span>]);</span>
<span id="cb1016-9"><a href="rcpp.html#cb1016-9" aria-hidden="true" tabindex="-1"></a>  NumericVector fitted = as&lt;NumericVector&gt;(mod[<span class="st">&quot;fitted.values&quot;</span>]);</span>
<span id="cb1016-10"><a href="rcpp.html#cb1016-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1016-11"><a href="rcpp.html#cb1016-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = resid.size();</span>
<span id="cb1016-12"><a href="rcpp.html#cb1016-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> err = <span class="dv">0</span>;</span>
<span id="cb1016-13"><a href="rcpp.html#cb1016-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1016-14"><a href="rcpp.html#cb1016-14" aria-hidden="true" tabindex="-1"></a>    err += resid[i] / (fitted[i] + resid[i]);</span>
<span id="cb1016-15"><a href="rcpp.html#cb1016-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1016-16"><a href="rcpp.html#cb1016-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> err / n;</span>
<span id="cb1016-17"><a href="rcpp.html#cb1016-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="rcpp.html#cb1017-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb1017-2"><a href="rcpp.html#cb1017-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mpe</span>(mod)</span>
<span id="cb1017-3"><a href="rcpp.html#cb1017-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -0.0154</span></span></code></pre></div>
</div>
<div id="functions-rcpp" class="section level3" number="25.3.2">
<h3><span class="header-section-number">25.3.2</span> Functions</h3>
<p></p>
<p>You can put R functions in an object of type <code>Function</code>. This makes calling an R function from C++ straightforward. The only challenge is that we don’t know what type of output the function will return, so we use the catchall type <code>RObject</code>.</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1018-1"><a href="rcpp.html#cb1018-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1018-2"><a href="rcpp.html#cb1018-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1018-3"><a href="rcpp.html#cb1018-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1018-4"><a href="rcpp.html#cb1018-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1018-5"><a href="rcpp.html#cb1018-5" aria-hidden="true" tabindex="-1"></a>RObject callWithOne(Function f) {</span>
<span id="cb1018-6"><a href="rcpp.html#cb1018-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> f(<span class="dv">1</span>);</span>
<span id="cb1018-7"><a href="rcpp.html#cb1018-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="rcpp.html#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="fu">callWithOne</span>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1019-2"><a href="rcpp.html#cb1019-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb1019-3"><a href="rcpp.html#cb1019-3" aria-hidden="true" tabindex="-1"></a><span class="fu">callWithOne</span>(paste)</span>
<span id="cb1019-4"><a href="rcpp.html#cb1019-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1&quot;</span></span></code></pre></div>
<p>Calling R functions with positional arguments is obvious:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1020-1"><a href="rcpp.html#cb1020-1" aria-hidden="true" tabindex="-1"></a>f(<span class="st">&quot;y&quot;</span>, <span class="dv">1</span>);</span></code></pre></div>
<p>But you need a special syntax for named arguments:</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1021-1"><a href="rcpp.html#cb1021-1" aria-hidden="true" tabindex="-1"></a>f(_[<span class="st">&quot;x&quot;</span>] = <span class="st">&quot;y&quot;</span>, _[<span class="st">&quot;value&quot;</span>] = <span class="dv">1</span>);</span></code></pre></div>
</div>
<div id="attributes-1" class="section level3" number="25.3.3">
<h3><span class="header-section-number">25.3.3</span> Attributes</h3>
<p></p>
<p>All R objects have attributes, which can be queried and modified with <code>.attr()</code>. Rcpp also provides <code>.names()</code> as an alias for the name attribute. The following code snippet illustrates these methods. Note the use of <code>::create()</code>, a <em>class</em> method. This allows you to create an R vector from C++ scalar values:</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1022-1"><a href="rcpp.html#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1022-2"><a href="rcpp.html#cb1022-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1022-3"><a href="rcpp.html#cb1022-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-4"><a href="rcpp.html#cb1022-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1022-5"><a href="rcpp.html#cb1022-5" aria-hidden="true" tabindex="-1"></a>NumericVector attribs() {</span>
<span id="cb1022-6"><a href="rcpp.html#cb1022-6" aria-hidden="true" tabindex="-1"></a>  NumericVector out = NumericVector::create(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>);</span>
<span id="cb1022-7"><a href="rcpp.html#cb1022-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-8"><a href="rcpp.html#cb1022-8" aria-hidden="true" tabindex="-1"></a>  out.names() = CharacterVector::create(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>);</span>
<span id="cb1022-9"><a href="rcpp.html#cb1022-9" aria-hidden="true" tabindex="-1"></a>  out.attr(<span class="st">&quot;my-attr&quot;</span>) = <span class="st">&quot;my-value&quot;</span>;</span>
<span id="cb1022-10"><a href="rcpp.html#cb1022-10" aria-hidden="true" tabindex="-1"></a>  out.attr(<span class="st">&quot;class&quot;</span>) = <span class="st">&quot;my-class&quot;</span>;</span>
<span id="cb1022-11"><a href="rcpp.html#cb1022-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-12"><a href="rcpp.html#cb1022-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1022-13"><a href="rcpp.html#cb1022-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For S4 objects, <code>.slot()</code> plays a similar role to <code>.attr()</code>.</p>
</div>
</div>
<div id="rcpp-na" class="section level2" number="25.4">
<h2><span class="header-section-number">25.4</span> Missing values</h2>
<p>If you’re working with missing values, you need to know two things:</p>
<ul>
<li>How R’s missing values behave in C++’s scalars (e.g., <code>double</code>).</li>
<li>How to get and set missing values in vectors (e.g., <code>NumericVector</code>).</li>
</ul>
<div id="scalars-1" class="section level3" number="25.4.1">
<h3><span class="header-section-number">25.4.1</span> Scalars</h3>
<p>The following code explores what happens when you take one of R’s missing values, coerce it into a scalar, and then coerce back to an R vector. Note that this kind of experimentation is a useful way to figure out what any operation does.</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1023-1"><a href="rcpp.html#cb1023-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1023-2"><a href="rcpp.html#cb1023-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1023-3"><a href="rcpp.html#cb1023-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1023-4"><a href="rcpp.html#cb1023-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1023-5"><a href="rcpp.html#cb1023-5" aria-hidden="true" tabindex="-1"></a>List scalar_missings() {</span>
<span id="cb1023-6"><a href="rcpp.html#cb1023-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> int_s = NA_INTEGER;</span>
<span id="cb1023-7"><a href="rcpp.html#cb1023-7" aria-hidden="true" tabindex="-1"></a>  String chr_s = NA_STRING;</span>
<span id="cb1023-8"><a href="rcpp.html#cb1023-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> lgl_s = NA_LOGICAL;</span>
<span id="cb1023-9"><a href="rcpp.html#cb1023-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> num_s = NA_REAL;</span>
<span id="cb1023-10"><a href="rcpp.html#cb1023-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1023-11"><a href="rcpp.html#cb1023-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> List::create(int_s, chr_s, lgl_s, num_s);</span>
<span id="cb1023-12"><a href="rcpp.html#cb1023-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="rcpp.html#cb1024-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">scalar_missings</span>())</span>
<span id="cb1024-2"><a href="rcpp.html#cb1024-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 4</span></span>
<span id="cb1024-3"><a href="rcpp.html#cb1024-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : int NA</span></span>
<span id="cb1024-4"><a href="rcpp.html#cb1024-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : chr NA</span></span>
<span id="cb1024-5"><a href="rcpp.html#cb1024-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : logi TRUE</span></span>
<span id="cb1024-6"><a href="rcpp.html#cb1024-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : num NA</span></span></code></pre></div>
<p>With the exception of <code>bool</code>, things look pretty good here: all of the missing values have been preserved. However, as we’ll see in the following sections, things are not quite as straightforward as they seem.</p>
<div id="integers" class="section level4" number="25.4.1.1">
<h4><span class="header-section-number">25.4.1.1</span> Integers</h4>
<p>With integers, missing values are stored as the smallest integer. If you don’t do anything to them, they’ll be preserved. But, since C++ doesn’t know that the smallest integer has this special behaviour, if you do anything to it you’re likely to get an incorrect value: for example, <code>evalCpp('NA_INTEGER + 1')</code> gives -2147483647.</p>
<p>So if you want to work with missing values in integers, either use a length 1 <code>IntegerVector</code> or be very careful with your code.</p>
</div>
<div id="doubles" class="section level4" number="25.4.1.2">
<h4><span class="header-section-number">25.4.1.2</span> Doubles</h4>
<p>With doubles, you may be able to get away with ignoring missing values and working with NaNs (not a number). This is because R’s NA is a special type of IEEE 754 floating point number NaN. So any logical expression that involves a NaN (or in C++, NAN) always evaluates as FALSE:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="rcpp.html#cb1025-1" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN == 1&quot;</span>)</span>
<span id="cb1025-2"><a href="rcpp.html#cb1025-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb1025-3"><a href="rcpp.html#cb1025-3" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN &lt; 1&quot;</span>)</span>
<span id="cb1025-4"><a href="rcpp.html#cb1025-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb1025-5"><a href="rcpp.html#cb1025-5" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN &gt; 1&quot;</span>)</span>
<span id="cb1025-6"><a href="rcpp.html#cb1025-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb1025-7"><a href="rcpp.html#cb1025-7" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN == NAN&quot;</span>)</span>
<span id="cb1025-8"><a href="rcpp.html#cb1025-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>(Here I’m using <code>evalCpp()</code> which allows you to see the result of running a single C++ expression, making it excellent for this sort of interactive experimentation.)</p>
<p>But be careful when combining them with Boolean values:</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="rcpp.html#cb1026-1" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN &amp;&amp; TRUE&quot;</span>)</span>
<span id="cb1026-2"><a href="rcpp.html#cb1026-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb1026-3"><a href="rcpp.html#cb1026-3" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN || FALSE&quot;</span>)</span>
<span id="cb1026-4"><a href="rcpp.html#cb1026-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>However, in numeric contexts NaNs will propagate NAs:</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="rcpp.html#cb1027-1" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN + 1&quot;</span>)</span>
<span id="cb1027-2"><a href="rcpp.html#cb1027-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NaN</span></span>
<span id="cb1027-3"><a href="rcpp.html#cb1027-3" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN - 1&quot;</span>)</span>
<span id="cb1027-4"><a href="rcpp.html#cb1027-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NaN</span></span>
<span id="cb1027-5"><a href="rcpp.html#cb1027-5" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN / 1&quot;</span>)</span>
<span id="cb1027-6"><a href="rcpp.html#cb1027-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NaN</span></span>
<span id="cb1027-7"><a href="rcpp.html#cb1027-7" aria-hidden="true" tabindex="-1"></a><span class="fu">evalCpp</span>(<span class="st">&quot;NAN * 1&quot;</span>)</span>
<span id="cb1027-8"><a href="rcpp.html#cb1027-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NaN</span></span></code></pre></div>
</div>
</div>
<div id="strings" class="section level3" number="25.4.2">
<h3><span class="header-section-number">25.4.2</span> Strings</h3>
<p><code>String</code> is a scalar string class introduced by Rcpp, so it knows how to deal with missing values.</p>
</div>
<div id="boolean" class="section level3" number="25.4.3">
<h3><span class="header-section-number">25.4.3</span> Boolean</h3>
<p>While C++’s <code>bool</code> has two possible values (<code>true</code> or <code>false</code>), a logical vector in R has three (<code>TRUE</code>, <code>FALSE</code>, and <code>NA</code>). If you coerce a length 1 logical vector, make sure it doesn’t contain any missing values; otherwise they will be converted to TRUE. An easy fix is to use <code>int</code> instead, as this can represent <code>TRUE</code>, <code>FALSE</code>, and <code>NA</code>.</p>
</div>
<div id="vectors-rcpp" class="section level3" number="25.4.4">
<h3><span class="header-section-number">25.4.4</span> Vectors</h3>
<p>With vectors, you need to use a missing value specific to the type of vector, <code>NA_REAL</code>, <code>NA_INTEGER</code>, <code>NA_LOGICAL</code>, <code>NA_STRING</code>:</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1028-1"><a href="rcpp.html#cb1028-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1028-2"><a href="rcpp.html#cb1028-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1028-3"><a href="rcpp.html#cb1028-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-4"><a href="rcpp.html#cb1028-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1028-5"><a href="rcpp.html#cb1028-5" aria-hidden="true" tabindex="-1"></a>List missing_sampler() {</span>
<span id="cb1028-6"><a href="rcpp.html#cb1028-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> List::create(</span>
<span id="cb1028-7"><a href="rcpp.html#cb1028-7" aria-hidden="true" tabindex="-1"></a>    NumericVector::create(NA_REAL),</span>
<span id="cb1028-8"><a href="rcpp.html#cb1028-8" aria-hidden="true" tabindex="-1"></a>    IntegerVector::create(NA_INTEGER),</span>
<span id="cb1028-9"><a href="rcpp.html#cb1028-9" aria-hidden="true" tabindex="-1"></a>    LogicalVector::create(NA_LOGICAL),</span>
<span id="cb1028-10"><a href="rcpp.html#cb1028-10" aria-hidden="true" tabindex="-1"></a>    CharacterVector::create(NA_STRING)</span>
<span id="cb1028-11"><a href="rcpp.html#cb1028-11" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb1028-12"><a href="rcpp.html#cb1028-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="rcpp.html#cb1029-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">missing_sampler</span>())</span>
<span id="cb1029-2"><a href="rcpp.html#cb1029-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 4</span></span>
<span id="cb1029-3"><a href="rcpp.html#cb1029-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : num NA</span></span>
<span id="cb1029-4"><a href="rcpp.html#cb1029-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : int NA</span></span>
<span id="cb1029-5"><a href="rcpp.html#cb1029-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : logi NA</span></span>
<span id="cb1029-6"><a href="rcpp.html#cb1029-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ : chr NA</span></span></code></pre></div>
</div>
<div id="exercises-73" class="section level3" number="25.4.5">
<h3><span class="header-section-number">25.4.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Rewrite any of the functions from the first exercise of
Section <a href="rcpp.html#exercise-started">25.2.6</a> to deal with missing
values. If <code>na.rm</code> is true, ignore the missing values. If <code>na.rm</code> is false,
return a missing value if the input contains any missing values. Some
good functions to practice with are <code>min()</code>, <code>max()</code>, <code>range()</code>, <code>mean()</code>,
and <code>var()</code>.</p></li>
<li><p>Rewrite <code>cumsum()</code> and <code>diff()</code> so they can handle missing values. Note that
these functions have slightly more complicated behaviour.</p></li>
</ol>
</div>
</div>
<div id="stl" class="section level2" number="25.5">
<h2><span class="header-section-number">25.5</span> Standard Template Library</h2>
<p>The real strength of C++ is revealed when you need to implement more complex algorithms. The standard template library (STL) provides a set of extremely useful data structures and algorithms. This section will explain some of the most important algorithms and data structures and point you in the right direction to learn more. I can’t teach you everything you need to know about the STL, but hopefully the examples will show you the power of the STL, and persuade you that it’s useful to learn more. </p>
<p>If you need an algorithm or data structure that isn’t implemented in STL, a good place to look is <a href="http://www.boost.org/doc/">boost</a>. Installing boost on your computer is beyond the scope of this chapter, but once you have it installed, you can use boost data structures and algorithms by including the appropriate header file with (e.g.) <code>#include &lt;boost/array.hpp&gt;</code>.</p>
<div id="using-iterators" class="section level3" number="25.5.1">
<h3><span class="header-section-number">25.5.1</span> Using iterators</h3>
<p>Iterators are used extensively in the STL: many functions either accept or return iterators. They are the next step up from basic loops, abstracting away the details of the underlying data structure. Iterators have three main operators: </p>
<ol style="list-style-type: decimal">
<li>Advance with <code>++</code>.</li>
<li>Get the value they refer to, or <strong>dereference</strong>, with <code>*</code>.</li>
<li>Compare with <code>==</code>.</li>
</ol>
<p>For example we could re-write our sum function using iterators:</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1030-1"><a href="rcpp.html#cb1030-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1030-2"><a href="rcpp.html#cb1030-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1030-3"><a href="rcpp.html#cb1030-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1030-4"><a href="rcpp.html#cb1030-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1030-5"><a href="rcpp.html#cb1030-5" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sum3(NumericVector x) {</span>
<span id="cb1030-6"><a href="rcpp.html#cb1030-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> total = <span class="dv">0</span>;</span>
<span id="cb1030-7"><a href="rcpp.html#cb1030-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1030-8"><a href="rcpp.html#cb1030-8" aria-hidden="true" tabindex="-1"></a>  NumericVector::iterator it;</span>
<span id="cb1030-9"><a href="rcpp.html#cb1030-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(it = x.begin(); it != x.end(); ++it) {</span>
<span id="cb1030-10"><a href="rcpp.html#cb1030-10" aria-hidden="true" tabindex="-1"></a>    total += *it;</span>
<span id="cb1030-11"><a href="rcpp.html#cb1030-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1030-12"><a href="rcpp.html#cb1030-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> total;</span>
<span id="cb1030-13"><a href="rcpp.html#cb1030-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The main changes are in the for loop:</p>
<ul>
<li><p>We start at <code>x.begin()</code> and loop until we get to <code>x.end()</code>. A small
optimization is to store the value of the end iterator so we don’t need to
look it up each time. This only saves about 2 ns per iteration, so it’s only
important when the calculations in the loop are very simple.</p></li>
<li><p>Instead of indexing into x, we use the dereference operator to get its
current value: <code>*it</code>.</p></li>
<li><p>Notice the type of the iterator: <code>NumericVector::iterator</code>. Each vector
type has its own iterator type: <code>LogicalVector::iterator</code>,
<code>CharacterVector::iterator</code>, etc.</p></li>
</ul>
<p>This code can be simplified still further through the use of a C++11 feature: range-based for loops. C++11 is widely available, and can easily be activated for use with Rcpp by adding <code>[[Rcpp::plugins(cpp11)]]</code>.</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1031-1"><a href="rcpp.html#cb1031-1" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::plugins(cpp11)]]</span></span>
<span id="cb1031-2"><a href="rcpp.html#cb1031-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1031-3"><a href="rcpp.html#cb1031-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1031-4"><a href="rcpp.html#cb1031-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1031-5"><a href="rcpp.html#cb1031-5" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1031-6"><a href="rcpp.html#cb1031-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sum4(NumericVector xs) {</span>
<span id="cb1031-7"><a href="rcpp.html#cb1031-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> total = <span class="dv">0</span>;</span>
<span id="cb1031-8"><a href="rcpp.html#cb1031-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1031-9"><a href="rcpp.html#cb1031-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="at">const</span> <span class="kw">auto</span> &amp;x : xs) {</span>
<span id="cb1031-10"><a href="rcpp.html#cb1031-10" aria-hidden="true" tabindex="-1"></a>    total += x;</span>
<span id="cb1031-11"><a href="rcpp.html#cb1031-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1031-12"><a href="rcpp.html#cb1031-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> total;</span>
<span id="cb1031-13"><a href="rcpp.html#cb1031-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Iterators also allow us to use the C++ equivalents of the apply family of functions. For example, we could again rewrite <code>sum()</code> to use the <code>accumulate()</code> function, which takes a starting and an ending iterator, and adds up all the values in the vector. The third argument to <code>accumulate</code> gives the initial value: it’s particularly important because this also determines the data type that <code>accumulate</code> uses (so we use <code>0.0</code> and not <code>0</code> so that <code>accumulate</code> uses a <code>double</code>, not an <code>int</code>.). To use <code>accumulate()</code> we need to include the <code>&lt;numeric&gt;</code> header.</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1032-1"><a href="rcpp.html#cb1032-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;numeric&gt;</span></span>
<span id="cb1032-2"><a href="rcpp.html#cb1032-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1032-3"><a href="rcpp.html#cb1032-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1032-4"><a href="rcpp.html#cb1032-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1032-5"><a href="rcpp.html#cb1032-5" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1032-6"><a href="rcpp.html#cb1032-6" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sum5(NumericVector x) {</span>
<span id="cb1032-7"><a href="rcpp.html#cb1032-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">std::</span>accumulate(x.begin(), x.end(), <span class="fl">0.0</span>);</span>
<span id="cb1032-8"><a href="rcpp.html#cb1032-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="algorithms" class="section level3" number="25.5.2">
<h3><span class="header-section-number">25.5.2</span> Algorithms</h3>
<p>The <code>&lt;algorithm&gt;</code> header provides a large number of algorithms that work with iterators. A good reference is available at <a href="https://en.cppreference.com/w/cpp/algorithm" class="uri">https://en.cppreference.com/w/cpp/algorithm</a>. For example, we could write a basic Rcpp version of <code>findInterval()</code> that takes two arguments a vector of values and a vector of breaks, and locates the bin that each x falls into. This shows off a few more advanced iterator features. Read the code below and see if you can figure out how it works. </p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1033-1"><a href="rcpp.html#cb1033-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb1033-2"><a href="rcpp.html#cb1033-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1033-3"><a href="rcpp.html#cb1033-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1033-4"><a href="rcpp.html#cb1033-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1033-5"><a href="rcpp.html#cb1033-5" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1033-6"><a href="rcpp.html#cb1033-6" aria-hidden="true" tabindex="-1"></a>IntegerVector findInterval2(NumericVector x, NumericVector breaks) {</span>
<span id="cb1033-7"><a href="rcpp.html#cb1033-7" aria-hidden="true" tabindex="-1"></a>  IntegerVector out(x.size());</span>
<span id="cb1033-8"><a href="rcpp.html#cb1033-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1033-9"><a href="rcpp.html#cb1033-9" aria-hidden="true" tabindex="-1"></a>  NumericVector::iterator it, pos;</span>
<span id="cb1033-10"><a href="rcpp.html#cb1033-10" aria-hidden="true" tabindex="-1"></a>  IntegerVector::iterator out_it;</span>
<span id="cb1033-11"><a href="rcpp.html#cb1033-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1033-12"><a href="rcpp.html#cb1033-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(it = x.begin(), out_it = out.begin(); it != x.end(); </span>
<span id="cb1033-13"><a href="rcpp.html#cb1033-13" aria-hidden="true" tabindex="-1"></a>      ++it, ++out_it) {</span>
<span id="cb1033-14"><a href="rcpp.html#cb1033-14" aria-hidden="true" tabindex="-1"></a>    pos = <span class="bu">std::</span>upper_bound(breaks.begin(), breaks.end(), *it);</span>
<span id="cb1033-15"><a href="rcpp.html#cb1033-15" aria-hidden="true" tabindex="-1"></a>    *out_it = <span class="bu">std::</span>distance(breaks.begin(), pos);</span>
<span id="cb1033-16"><a href="rcpp.html#cb1033-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1033-17"><a href="rcpp.html#cb1033-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1033-18"><a href="rcpp.html#cb1033-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1033-19"><a href="rcpp.html#cb1033-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The key points are:</p>
<ul>
<li><p>We step through two iterators (input and output) simultaneously.</p></li>
<li><p>We can assign into an dereferenced iterator (<code>out_it</code>) to change the values
in <code>out</code>.</p></li>
<li><p><code>upper_bound()</code> returns an iterator. If we wanted the value of the
<code>upper_bound()</code> we could dereference it; to figure out its location, we
use the <code>distance()</code> function.</p></li>
<li><p>Small note: if we want this function to be as fast as <code>findInterval()</code> in R
(which uses handwritten C code), we need to compute the calls to <code>.begin()</code>
and <code>.end()</code> once and save the results. This is easy, but it distracts from
this example so it has been omitted. Making this change yields a function
that’s slightly faster than R’s <code>findInterval()</code> function, but is about 1/10
of the code.</p></li>
</ul>
<p>It’s generally better to use algorithms from the STL than hand rolled loops. In <em>Effective STL</em>, Scott Meyers gives three reasons: efficiency, correctness, and maintainability. Algorithms from the STL are written by C++ experts to be extremely efficient, and they have been around for a long time so they are well tested. Using standard algorithms also makes the intent of your code more clear, helping to make it more readable and more maintainable.</p>
</div>
<div id="data-structures-rcpp" class="section level3" number="25.5.3">
<h3><span class="header-section-number">25.5.3</span> Data structures</h3>
<p>The STL provides a large set of data structures: <code>array</code>, <code>bitset</code>, <code>list</code>, <code>forward_list</code>, <code>map</code>, <code>multimap</code>, <code>multiset</code>, <code>priority_queue</code>, <code>queue</code>, <code>deque</code>, <code>set</code>, <code>stack</code>, <code>unordered_map</code>, <code>unordered_set</code>, <code>unordered_multimap</code>, <code>unordered_multiset</code>, and <code>vector</code>. The most important of these data structures are the <code>vector</code>, the <code>unordered_set</code>, and the <code>unordered_map</code>. We’ll focus on these three in this section, but using the others is similar: they just have different performance trade-offs. For example, the <code>deque</code> (pronounced “deck”) has a very similar interface to vectors but a different underlying implementation that has different performance trade-offs. You may want to try it for your problem. A good reference for STL data structures is <a href="https://en.cppreference.com/w/cpp/container" class="uri">https://en.cppreference.com/w/cpp/container</a> — I recommend you keep it open while working with the STL.</p>
<p>Rcpp knows how to convert from many STL data structures to their R equivalents, so you can return them from your functions without explicitly converting to R data structures.</p>
</div>
<div id="vectors-stl" class="section level3" number="25.5.4">
<h3><span class="header-section-number">25.5.4</span> Vectors</h3>
<p>An STL vector is very similar to an R vector, except that it grows efficiently. This makes vectors appropriate to use when you don’t know in advance how big the output will be. Vectors are templated, which means that you need to specify the type of object the vector will contain when you create it: <code>vector&lt;int&gt;</code>, <code>vector&lt;bool&gt;</code>, <code>vector&lt;double&gt;</code>, <code>vector&lt;String&gt;</code>. You can access individual elements of a vector using the standard <code>[]</code> notation, and you can add a new element to the end of the vector using <code>.push_back()</code>. If you have some idea in advance how big the vector will be, you can use <code>.reserve()</code> to allocate sufficient storage. </p>
<p>The following code implements run length encoding (<code>rle()</code>). It produces two vectors of output: a vector of values, and a vector <code>lengths</code> giving how many times each element is repeated. It works by looping through the input vector <code>x</code> comparing each value to the previous: if it’s the same, then it increments the last value in <code>lengths</code>; if it’s different, it adds the value to the end of <code>values</code>, and sets the corresponding length to 1.</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1034-1"><a href="rcpp.html#cb1034-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1034-2"><a href="rcpp.html#cb1034-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1034-3"><a href="rcpp.html#cb1034-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-4"><a href="rcpp.html#cb1034-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1034-5"><a href="rcpp.html#cb1034-5" aria-hidden="true" tabindex="-1"></a>List rleC(NumericVector x) {</span>
<span id="cb1034-6"><a href="rcpp.html#cb1034-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; lengths;</span>
<span id="cb1034-7"><a href="rcpp.html#cb1034-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>vector&lt;<span class="dt">double</span>&gt; values;</span>
<span id="cb1034-8"><a href="rcpp.html#cb1034-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-9"><a href="rcpp.html#cb1034-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialise first value</span></span>
<span id="cb1034-10"><a href="rcpp.html#cb1034-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> i = <span class="dv">0</span>;</span>
<span id="cb1034-11"><a href="rcpp.html#cb1034-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> prev = x[<span class="dv">0</span>];</span>
<span id="cb1034-12"><a href="rcpp.html#cb1034-12" aria-hidden="true" tabindex="-1"></a>  values.push_back(prev);</span>
<span id="cb1034-13"><a href="rcpp.html#cb1034-13" aria-hidden="true" tabindex="-1"></a>  lengths.push_back(<span class="dv">1</span>);</span>
<span id="cb1034-14"><a href="rcpp.html#cb1034-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-15"><a href="rcpp.html#cb1034-15" aria-hidden="true" tabindex="-1"></a>  NumericVector::iterator it;</span>
<span id="cb1034-16"><a href="rcpp.html#cb1034-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(it = x.begin() + <span class="dv">1</span>; it != x.end(); ++it) {</span>
<span id="cb1034-17"><a href="rcpp.html#cb1034-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prev == *it) {</span>
<span id="cb1034-18"><a href="rcpp.html#cb1034-18" aria-hidden="true" tabindex="-1"></a>      lengths[i]++;</span>
<span id="cb1034-19"><a href="rcpp.html#cb1034-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1034-20"><a href="rcpp.html#cb1034-20" aria-hidden="true" tabindex="-1"></a>      values.push_back(*it);</span>
<span id="cb1034-21"><a href="rcpp.html#cb1034-21" aria-hidden="true" tabindex="-1"></a>      lengths.push_back(<span class="dv">1</span>);</span>
<span id="cb1034-22"><a href="rcpp.html#cb1034-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-23"><a href="rcpp.html#cb1034-23" aria-hidden="true" tabindex="-1"></a>      i++;</span>
<span id="cb1034-24"><a href="rcpp.html#cb1034-24" aria-hidden="true" tabindex="-1"></a>      prev = *it;</span>
<span id="cb1034-25"><a href="rcpp.html#cb1034-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1034-26"><a href="rcpp.html#cb1034-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1034-27"><a href="rcpp.html#cb1034-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1034-28"><a href="rcpp.html#cb1034-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> List::create(</span>
<span id="cb1034-29"><a href="rcpp.html#cb1034-29" aria-hidden="true" tabindex="-1"></a>    _[<span class="st">&quot;lengths&quot;</span>] = lengths, </span>
<span id="cb1034-30"><a href="rcpp.html#cb1034-30" aria-hidden="true" tabindex="-1"></a>    _[<span class="st">&quot;values&quot;</span>] = values</span>
<span id="cb1034-31"><a href="rcpp.html#cb1034-31" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb1034-32"><a href="rcpp.html#cb1034-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>(An alternative implementation would be to replace <code>i</code> with the iterator <code>lengths.rbegin()</code> which always points to the last element of the vector. You might want to try implementing that.)</p>
<p>Other methods of a vector are described at <a href="https://en.cppreference.com/w/cpp/container/vector" class="uri">https://en.cppreference.com/w/cpp/container/vector</a>.</p>
</div>
<div id="sets" class="section level3" number="25.5.5">
<h3><span class="header-section-number">25.5.5</span> Sets</h3>
<p>Sets maintain a unique set of values, and can efficiently tell if you’ve seen a value before. They are useful for problems that involve duplicates or unique values (like <code>unique</code>, <code>duplicated</code>, or <code>in</code>). C++ provides both ordered (<code>std::set</code>) and unordered sets (<code>std::unordered_set</code>), depending on whether or not order matters for you. Unordered sets tend to be much faster (because they use a hash table internally rather than a tree), so even if you need an ordered set, you should consider using an unordered set and then sorting the output. Like vectors, sets are templated, so you need to request the appropriate type of set for your purpose: <code>unordered_set&lt;int&gt;</code>, <code>unordered_set&lt;bool&gt;</code>, etc. More details are available at <a href="https://en.cppreference.com/w/cpp/container/set" class="uri">https://en.cppreference.com/w/cpp/container/set</a> and <a href="https://en.cppreference.com/w/cpp/container/unordered_set" class="uri">https://en.cppreference.com/w/cpp/container/unordered_set</a>. </p>
<p>The following function uses an unordered set to implement an equivalent to <code>duplicated()</code> for integer vectors. Note the use of <code>seen.insert(x[i]).second</code>. <code>insert()</code> returns a pair, the <code>.first</code> value is an iterator that points to element and the <code>.second</code> value is a Boolean that’s true if the value was a new addition to the set.</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1035-1"><a href="rcpp.html#cb1035-1" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::plugins(cpp11)]]</span></span>
<span id="cb1035-2"><a href="rcpp.html#cb1035-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1035-3"><a href="rcpp.html#cb1035-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unordered_set&gt;</span></span>
<span id="cb1035-4"><a href="rcpp.html#cb1035-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1035-5"><a href="rcpp.html#cb1035-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-6"><a href="rcpp.html#cb1035-6" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1035-7"><a href="rcpp.html#cb1035-7" aria-hidden="true" tabindex="-1"></a>LogicalVector duplicatedC(IntegerVector x) {</span>
<span id="cb1035-8"><a href="rcpp.html#cb1035-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>unordered_set&lt;<span class="dt">int</span>&gt; seen;</span>
<span id="cb1035-9"><a href="rcpp.html#cb1035-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1035-10"><a href="rcpp.html#cb1035-10" aria-hidden="true" tabindex="-1"></a>  LogicalVector out(n);</span>
<span id="cb1035-11"><a href="rcpp.html#cb1035-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-12"><a href="rcpp.html#cb1035-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1035-13"><a href="rcpp.html#cb1035-13" aria-hidden="true" tabindex="-1"></a>    out[i] = !seen.insert(x[i]).second;</span>
<span id="cb1035-14"><a href="rcpp.html#cb1035-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1035-15"><a href="rcpp.html#cb1035-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-16"><a href="rcpp.html#cb1035-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1035-17"><a href="rcpp.html#cb1035-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="map-1" class="section level3" number="25.5.6">
<h3><span class="header-section-number">25.5.6</span> Map</h3>
<p></p>
<p>A map is similar to a set, but instead of storing presence or absence, it can store additional data. It’s useful for functions like <code>table()</code> or <code>match()</code> that need to look up a value. As with sets, there are ordered (<code>std::map</code>) and unordered (<code>std::unordered_map</code>) versions. Since maps have a value and a key, you need to specify both types when initialising a map: <code>map&lt;double, int&gt;</code>, <code>unordered_map&lt;int, double&gt;</code>, and so on. The following example shows how you could use a <code>map</code> to implement <code>table()</code> for numeric vectors:</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1036-1"><a href="rcpp.html#cb1036-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1036-2"><a href="rcpp.html#cb1036-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1036-3"><a href="rcpp.html#cb1036-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-4"><a href="rcpp.html#cb1036-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1036-5"><a href="rcpp.html#cb1036-5" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>map&lt;<span class="dt">double</span>, <span class="dt">int</span>&gt; tableC(NumericVector x) {</span>
<span id="cb1036-6"><a href="rcpp.html#cb1036-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>map&lt;<span class="dt">double</span>, <span class="dt">int</span>&gt; counts;</span>
<span id="cb1036-7"><a href="rcpp.html#cb1036-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-8"><a href="rcpp.html#cb1036-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = x.size();</span>
<span id="cb1036-9"><a href="rcpp.html#cb1036-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; i++) {</span>
<span id="cb1036-10"><a href="rcpp.html#cb1036-10" aria-hidden="true" tabindex="-1"></a>    counts[x[i]]++;</span>
<span id="cb1036-11"><a href="rcpp.html#cb1036-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1036-12"><a href="rcpp.html#cb1036-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-13"><a href="rcpp.html#cb1036-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> counts;</span>
<span id="cb1036-14"><a href="rcpp.html#cb1036-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="exercises-74" class="section level3" number="25.5.7">
<h3><span class="header-section-number">25.5.7</span> Exercises</h3>
<p>To practice using the STL algorithms and data structures, implement the following using R functions in C++, using the hints provided:</p>
<ol style="list-style-type: decimal">
<li><p><code>median.default()</code> using <code>partial_sort</code>.</p></li>
<li><p><code>%in%</code> using <code>unordered_set</code> and the <code>find()</code> or <code>count()</code> methods.</p></li>
<li><p><code>unique()</code> using an <code>unordered_set</code> (challenge: do it in one line!).</p></li>
<li><p><code>min()</code> using <code>std::min()</code>, or <code>max()</code> using <code>std::max()</code>.</p></li>
<li><p><code>which.min()</code> using <code>min_element</code>, or <code>which.max()</code> using <code>max_element</code>.</p></li>
<li><p><code>setdiff()</code>, <code>union()</code>, and <code>intersect()</code> for integers using sorted ranges
and <code>set_union</code>, <code>set_intersection</code> and <code>set_difference</code>.</p></li>
</ol>
</div>
</div>
<div id="rcpp-case-studies" class="section level2" number="25.6">
<h2><span class="header-section-number">25.6</span> Case studies</h2>
<p>The following case studies illustrate some real life uses of C++ to replace slow R code.</p>
<div id="gibbs-sampler" class="section level3" number="25.6.1">
<h3><span class="header-section-number">25.6.1</span> Gibbs sampler</h3>
<!-- FIXME: needs more context? -->
<p>The following case study updates an example <a href="http://dirk.eddelbuettel.com/blog/2011/07/14/">blogged about</a> by Dirk Eddelbuettel, illustrating the conversion of a Gibbs sampler in R to C++. The R and C++ code shown below is very similar (it only took a few minutes to convert the R version to the C++ version), but runs about 20 times faster on my computer. Dirk’s blog post also shows another way to make it even faster: using the faster random number generator functions in GSL (easily accessible from R through the RcppGSL package) can make it another two to three times faster. </p>
<p>The R code is as follows:</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="rcpp.html#cb1037-1" aria-hidden="true" tabindex="-1"></a>gibbs_r <span class="ot">&lt;-</span> <span class="cf">function</span>(N, thin) {</span>
<span id="cb1037-2"><a href="rcpp.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> N, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1037-3"><a href="rcpp.html#cb1037-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1037-4"><a href="rcpp.html#cb1037-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1037-5"><a href="rcpp.html#cb1037-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb1037-6"><a href="rcpp.html#cb1037-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>thin) {</span>
<span id="cb1037-7"><a href="rcpp.html#cb1037-7" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="dv">3</span>, y <span class="sc">*</span> y <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb1037-8"><a href="rcpp.html#cb1037-8" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">1</span> <span class="sc">/</span> (x <span class="sc">+</span> <span class="dv">1</span>), <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> (x <span class="sc">+</span> <span class="dv">1</span>)))</span>
<span id="cb1037-9"><a href="rcpp.html#cb1037-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1037-10"><a href="rcpp.html#cb1037-10" aria-hidden="true" tabindex="-1"></a>    mat[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb1037-11"><a href="rcpp.html#cb1037-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1037-12"><a href="rcpp.html#cb1037-12" aria-hidden="true" tabindex="-1"></a>  mat</span>
<span id="cb1037-13"><a href="rcpp.html#cb1037-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This is straightforward to convert to C++. We:</p>
<ul>
<li><p>Add type declarations to all variables.</p></li>
<li><p>Use <code>(</code> instead of <code>[</code> to index into the matrix.</p></li>
<li><p>Subscript the results of <code>rgamma</code> and <code>rnorm</code> to convert from a vector
into a scalar.</p></li>
</ul>
<div class="sourceCode" id="cb1038"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1038-1"><a href="rcpp.html#cb1038-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1038-2"><a href="rcpp.html#cb1038-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1038-3"><a href="rcpp.html#cb1038-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-4"><a href="rcpp.html#cb1038-4" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1038-5"><a href="rcpp.html#cb1038-5" aria-hidden="true" tabindex="-1"></a>NumericMatrix gibbs_cpp(<span class="dt">int</span> N, <span class="dt">int</span> thin) {</span>
<span id="cb1038-6"><a href="rcpp.html#cb1038-6" aria-hidden="true" tabindex="-1"></a>  NumericMatrix mat(N, <span class="dv">2</span>);</span>
<span id="cb1038-7"><a href="rcpp.html#cb1038-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> x = <span class="dv">0</span>, y = <span class="dv">0</span>;</span>
<span id="cb1038-8"><a href="rcpp.html#cb1038-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-9"><a href="rcpp.html#cb1038-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; N; i++) {</span>
<span id="cb1038-10"><a href="rcpp.html#cb1038-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; thin; j++) {</span>
<span id="cb1038-11"><a href="rcpp.html#cb1038-11" aria-hidden="true" tabindex="-1"></a>      x = rgamma(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span> / (y * y + <span class="dv">4</span>))[<span class="dv">0</span>];</span>
<span id="cb1038-12"><a href="rcpp.html#cb1038-12" aria-hidden="true" tabindex="-1"></a>      y = rnorm(<span class="dv">1</span>, <span class="dv">1</span> / (x + <span class="dv">1</span>), <span class="dv">1</span> / sqrt(<span class="dv">2</span> * (x + <span class="dv">1</span>)))[<span class="dv">0</span>];</span>
<span id="cb1038-13"><a href="rcpp.html#cb1038-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1038-14"><a href="rcpp.html#cb1038-14" aria-hidden="true" tabindex="-1"></a>    mat(i, <span class="dv">0</span>) = x;</span>
<span id="cb1038-15"><a href="rcpp.html#cb1038-15" aria-hidden="true" tabindex="-1"></a>    mat(i, <span class="dv">1</span>) = y;</span>
<span id="cb1038-16"><a href="rcpp.html#cb1038-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1038-17"><a href="rcpp.html#cb1038-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1038-18"><a href="rcpp.html#cb1038-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(mat);</span>
<span id="cb1038-19"><a href="rcpp.html#cb1038-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Benchmarking the two implementations yields:</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="rcpp.html#cb1039-1" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb1039-2"><a href="rcpp.html#cb1039-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gibbs_r</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb1039-3"><a href="rcpp.html#cb1039-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gibbs_cpp</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb1039-4"><a href="rcpp.html#cb1039-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="cn">FALSE</span></span>
<span id="cb1039-5"><a href="rcpp.html#cb1039-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1039-6"><a href="rcpp.html#cb1039-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb1039-7"><a href="rcpp.html#cb1039-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expression              min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb1039-8"><a href="rcpp.html#cb1039-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;bch:expr&gt;         &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb1039-9"><a href="rcpp.html#cb1039-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 gibbs_r(100, 10)     5.66ms   5.76ms      168.    4.97MB     28.9</span></span>
<span id="cb1039-10"><a href="rcpp.html#cb1039-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 gibbs_cpp(100, 10) 285.91µs 313.31µs     3128.     4.1KB     26.8</span></span></code></pre></div>
</div>
<div id="r-vectorisation-versus-c-vectorisation" class="section level3" number="25.6.2">
<h3><span class="header-section-number">25.6.2</span> R vectorisation versus C++ vectorisation</h3>
<!-- FIXME: needs more context? -->
<p>This example is adapted from <a href="https://gweissman.github.io/post/rcpp-is-smoking-fast-for-agent-based-models-in-data-frames/">“Rcpp is smoking fast for agent-based models in data frames”</a>. The challenge is to predict a model response from three inputs. The basic R version of the predictor looks like:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="rcpp.html#cb1040-1" aria-hidden="true" tabindex="-1"></a>vacc1a <span class="ot">&lt;-</span> <span class="cf">function</span>(age, female, ily) {</span>
<span id="cb1040-2"><a href="rcpp.html#cb1040-2" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fl">0.25</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="fl">0.04</span> <span class="sc">*</span> age)) <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> ily</span>
<span id="cb1040-3"><a href="rcpp.html#cb1040-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">*</span> <span class="cf">if</span> (female) <span class="fl">1.25</span> <span class="cf">else</span> <span class="fl">0.75</span></span>
<span id="cb1040-4"><a href="rcpp.html#cb1040-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, p)</span>
<span id="cb1040-5"><a href="rcpp.html#cb1040-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, p)</span>
<span id="cb1040-6"><a href="rcpp.html#cb1040-6" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb1040-7"><a href="rcpp.html#cb1040-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We want to be able to apply this function to many inputs, so we might write a vector-input version using a for loop.</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="rcpp.html#cb1041-1" aria-hidden="true" tabindex="-1"></a>vacc1 <span class="ot">&lt;-</span> <span class="cf">function</span>(age, female, ily) {</span>
<span id="cb1041-2"><a href="rcpp.html#cb1041-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(age)</span>
<span id="cb1041-3"><a href="rcpp.html#cb1041-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb1041-4"><a href="rcpp.html#cb1041-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb1041-5"><a href="rcpp.html#cb1041-5" aria-hidden="true" tabindex="-1"></a>    out[i] <span class="ot">&lt;-</span> <span class="fu">vacc1a</span>(age[i], female[i], ily[i])</span>
<span id="cb1041-6"><a href="rcpp.html#cb1041-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1041-7"><a href="rcpp.html#cb1041-7" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb1041-8"><a href="rcpp.html#cb1041-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If you’re familiar with R, you’ll have a gut feeling that this will be slow, and indeed it is. There are two ways we could attack this problem. If you have a good R vocabulary, you might immediately see how to vectorise the function (using <code>ifelse()</code>, <code>pmin()</code>, and <code>pmax()</code>). Alternatively, we could rewrite <code>vacc1a()</code> and <code>vacc1()</code> in C++, using our knowledge that loops and function calls have much lower overhead in C++.</p>
<p>Either approach is fairly straightforward. In R:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="rcpp.html#cb1042-1" aria-hidden="true" tabindex="-1"></a>vacc2 <span class="ot">&lt;-</span> <span class="cf">function</span>(age, female, ily) {</span>
<span id="cb1042-2"><a href="rcpp.html#cb1042-2" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fl">0.25</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="fl">0.04</span> <span class="sc">*</span> age)) <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> ily</span>
<span id="cb1042-3"><a href="rcpp.html#cb1042-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p <span class="sc">*</span> <span class="fu">ifelse</span>(female, <span class="fl">1.25</span>, <span class="fl">0.75</span>)</span>
<span id="cb1042-4"><a href="rcpp.html#cb1042-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, p)</span>
<span id="cb1042-5"><a href="rcpp.html#cb1042-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="dv">1</span>, p)</span>
<span id="cb1042-6"><a href="rcpp.html#cb1042-6" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb1042-7"><a href="rcpp.html#cb1042-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>(If you’ve worked R a lot you might recognise some potential bottlenecks in this code: <code>ifelse</code>, <code>pmin</code>, and <code>pmax</code> are known to be slow, and could be replaced with <code>p * 0.75 + p * 0.5 * female</code>, <code>p[p &lt; 0] &lt;- 0</code>, <code>p[p &gt; 1] &lt;- 1</code>. You might want to try timing those variations.)</p>
<p>Or in C++:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1043-1"><a href="rcpp.html#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb1043-2"><a href="rcpp.html#cb1043-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp;</span>
<span id="cb1043-3"><a href="rcpp.html#cb1043-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-4"><a href="rcpp.html#cb1043-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> vacc3a(<span class="dt">double</span> age, <span class="dt">bool</span> female, <span class="dt">bool</span> ily){</span>
<span id="cb1043-5"><a href="rcpp.html#cb1043-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> p = <span class="fl">0.25</span> + <span class="fl">0.3</span> * <span class="dv">1</span> / (<span class="dv">1</span> - exp(<span class="fl">0.04</span> * age)) + <span class="fl">0.1</span> * ily;</span>
<span id="cb1043-6"><a href="rcpp.html#cb1043-6" aria-hidden="true" tabindex="-1"></a>  p = p * (female ? <span class="fl">1.25</span> : <span class="fl">0.75</span>);</span>
<span id="cb1043-7"><a href="rcpp.html#cb1043-7" aria-hidden="true" tabindex="-1"></a>  p = <span class="bu">std::</span>max(p, <span class="fl">0.0</span>);</span>
<span id="cb1043-8"><a href="rcpp.html#cb1043-8" aria-hidden="true" tabindex="-1"></a>  p = <span class="bu">std::</span>min(p, <span class="fl">1.0</span>);</span>
<span id="cb1043-9"><a href="rcpp.html#cb1043-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> p;</span>
<span id="cb1043-10"><a href="rcpp.html#cb1043-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1043-11"><a href="rcpp.html#cb1043-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-12"><a href="rcpp.html#cb1043-12" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb1043-13"><a href="rcpp.html#cb1043-13" aria-hidden="true" tabindex="-1"></a>NumericVector vacc3(NumericVector age, LogicalVector female, </span>
<span id="cb1043-14"><a href="rcpp.html#cb1043-14" aria-hidden="true" tabindex="-1"></a>                    LogicalVector ily) {</span>
<span id="cb1043-15"><a href="rcpp.html#cb1043-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> n = age.size();</span>
<span id="cb1043-16"><a href="rcpp.html#cb1043-16" aria-hidden="true" tabindex="-1"></a>  NumericVector out(n);</span>
<span id="cb1043-17"><a href="rcpp.html#cb1043-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-18"><a href="rcpp.html#cb1043-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; n; ++i) {</span>
<span id="cb1043-19"><a href="rcpp.html#cb1043-19" aria-hidden="true" tabindex="-1"></a>    out[i] = vacc3a(age[i], female[i], ily[i]);</span>
<span id="cb1043-20"><a href="rcpp.html#cb1043-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1043-21"><a href="rcpp.html#cb1043-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1043-22"><a href="rcpp.html#cb1043-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> out;</span>
<span id="cb1043-23"><a href="rcpp.html#cb1043-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We next generate some sample data, and check that all three versions return the same values:</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="rcpp.html#cb1044-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1044-2"><a href="rcpp.html#cb1044-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb1044-3"><a href="rcpp.html#cb1044-3" aria-hidden="true" tabindex="-1"></a>female <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(T, F), n, <span class="at">rep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1044-4"><a href="rcpp.html#cb1044-4" aria-hidden="true" tabindex="-1"></a>ily <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(T, F), n, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>), <span class="at">rep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1044-5"><a href="rcpp.html#cb1044-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1044-6"><a href="rcpp.html#cb1044-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb1044-7"><a href="rcpp.html#cb1044-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all.equal</span>(<span class="fu">vacc1</span>(age, female, ily), <span class="fu">vacc2</span>(age, female, ily)),</span>
<span id="cb1044-8"><a href="rcpp.html#cb1044-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all.equal</span>(<span class="fu">vacc1</span>(age, female, ily), <span class="fu">vacc3</span>(age, female, ily))</span>
<span id="cb1044-9"><a href="rcpp.html#cb1044-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The original blog post forgot to do this, and introduced a bug in the C++ version: it used <code>0.004</code> instead of <code>0.04</code>. Finally, we can benchmark our three approaches:</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="rcpp.html#cb1045-1" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb1045-2"><a href="rcpp.html#cb1045-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">vacc1 =</span> <span class="fu">vacc1</span>(age, female, ily),</span>
<span id="cb1045-3"><a href="rcpp.html#cb1045-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">vacc2 =</span> <span class="fu">vacc2</span>(age, female, ily),</span>
<span id="cb1045-4"><a href="rcpp.html#cb1045-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vacc3 =</span> <span class="fu">vacc3</span>(age, female, ily)</span>
<span id="cb1045-5"><a href="rcpp.html#cb1045-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1045-6"><a href="rcpp.html#cb1045-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 6</span></span>
<span id="cb1045-7"><a href="rcpp.html#cb1045-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb1045-8"><a href="rcpp.html#cb1045-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb1045-9"><a href="rcpp.html#cb1045-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 vacc1        1.95ms   2.11ms      471.    7.86KB     31.4</span></span>
<span id="cb1045-10"><a href="rcpp.html#cb1045-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 vacc2        66.8µs   72.9µs    13325.  148.85KB     32.0</span></span>
<span id="cb1045-11"><a href="rcpp.html#cb1045-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 vacc3        25.3µs   26.6µs    37256.   14.48KB     11.2</span></span></code></pre></div>
<p>Not surprisingly, our original approach with loops is very slow. Vectorising in R gives a huge speedup, and we can eke out even more performance (about ten times) with the C++ loop. I was a little surprised that the C++ was so much faster, but it is because the R version has to create 11 vectors to store intermediate results, where the C++ code only needs to create 1.</p>
</div>
</div>
<div id="rcpp-package" class="section level2" number="25.7">
<h2><span class="header-section-number">25.7</span> Using Rcpp in a package</h2>
<p>The same C++ code that is used with <code>sourceCpp()</code> can also be bundled into a package. There are several benefits of moving code from a stand-alone C++ source file to a package: </p>
<ol style="list-style-type: decimal">
<li><p>Your code can be made available to users without C++ development tools.</p></li>
<li><p>Multiple source files and their dependencies are handled automatically by
the R package build system.</p></li>
<li><p>Packages provide additional infrastructure for testing, documentation, and
consistency.</p></li>
</ol>
<p>To add <code>Rcpp</code> to an existing package, you put your C++ files in the <code>src/</code> directory and create or modify the following configuration files:</p>
<ul>
<li><p>In <code>DESCRIPTION</code> add</p>
<pre><code>LinkingTo: Rcpp
Imports: Rcpp</code></pre></li>
<li><p>Make sure your <code>NAMESPACE</code> includes:</p>
<pre><code>useDynLib(mypackage)
importFrom(Rcpp, sourceCpp)</code></pre>
<p>We need to import something (anything) from Rcpp so that internal Rcpp code
is properly loaded. This is a bug in R and hopefully will be fixed in the
future.</p></li>
</ul>
<p>The easiest way to set this up automatically is to call <code>usethis::use_rcpp()</code>.</p>
<p>Before building the package, you’ll need to run <code>Rcpp::compileAttributes()</code>. This function scans the C++ files for <code>Rcpp::export</code> attributes and generates the code required to make the functions available in R. Re-run <code>compileAttributes()</code> whenever functions are added, removed, or have their signatures changed. This is done automatically by the devtools package and by Rstudio.</p>
<p>For more details see the Rcpp package vignette, <code>vignette("Rcpp-package")</code>.</p>
</div>
<div id="rcpp-more" class="section level2" number="25.8">
<h2><span class="header-section-number">25.8</span> Learning more</h2>
<p>This chapter has only touched on a small part of Rcpp, giving you the basic tools to rewrite poorly performing R code in C++. As noted, Rcpp has many other capabilities that make it easy to interface R to existing C++ code, including:</p>
<ul>
<li><p>Additional features of attributes including specifying default arguments,
linking in external C++ dependencies, and exporting C++ interfaces from
packages. These features and more are covered in the Rcpp attributes vignette,
<code>vignette("Rcpp-attributes")</code>.</p></li>
<li><p>Automatically creating wrappers between C++ data structures and R data
structures, including mapping C++ classes to reference classes. A good
introduction to this topic is the Rcpp modules vignette,
<code>vignette("Rcpp-modules")</code>.</p></li>
<li><p>The Rcpp quick reference guide, <code>vignette("Rcpp-quickref")</code>, contains a useful
summary of Rcpp classes and common programming idioms.</p></li>
</ul>
<p>I strongly recommend keeping an eye on the <a href="http://www.rcpp.org">Rcpp homepage</a> and signing up for the <a href="http://lists.r-forge.r-project.org/cgi-bin/mailman/listinfo/rcpp-devel">Rcpp mailing list</a>.</p>
<p>Other resources I’ve found helpful in learning C++ are:</p>
<ul>
<li><p><em>Effective C++</em><span class="citation"><a href="#fn118" class="footnote-ref" id="fnref118"><sup>118</sup></a></span> and <em>Effective STL</em>.<span class="citation"><a href="#fn119" class="footnote-ref" id="fnref119"><sup>119</sup></a></span></p></li>
<li><p><a href="http://www.icce.rug.nl/documents/cplusplus/cplusplus.html"><em>C++ Annotations</em></a>,
aimed at knowledgeable users of C (or any other language using a C-like
grammar, like Perl or Java) who would like to know more about, or make the
transition to, C++.</p></li>
<li><p><a href="http://www.cs.helsinki.fi/u/tpkarkka/alglib/k06/"><em>Algorithm Libraries</em></a>,
which provides a more technical, but still concise, description of
important STL concepts. (Follow the links under notes.)</p></li>
</ul>
<p>Writing performance code may also require you to rethink your basic approach: a solid understanding of basic data structures and algorithms is very helpful here. That’s beyond the scope of this book, but I’d suggest the <em>Algorithm Design Manual</em>,<span class="citation"><a href="#fn120" class="footnote-ref" id="fnref120"><sup>120</sup></a></span> MIT’s <a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-046j-introduction-to-algorithms-sma-5503-fall-2005/"><em>Introduction to Algorithms</em></a>, <em>Algorithms</em> by Robert Sedgewick and Kevin Wayne which has a free <a href="http://algs4.cs.princeton.edu/home/">online textbook</a> and a matching <a href="https://www.coursera.org/learn/algorithms-part1">Coursera course</a>.</p>
</div>
<div id="acknowledgments" class="section level2" number="25.9">
<h2><span class="header-section-number">25.9</span> Acknowledgments</h2>
<p>I’d like to thank the Rcpp-mailing list for many helpful conversations, particularly Romain Francois and Dirk Eddelbuettel who have not only provided detailed answers to many of my questions, but have been incredibly responsive at improving Rcpp. This chapter would not have been possible without JJ Allaire; he encouraged me to learn C++ and then answered many of my dumb questions along the way.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="117">
<li id="fn117"><p>Dirk Eddelbuettel and Romain François, <span>“<span>Rcpp</span>: Seamless <span>R</span> and <span>C++</span> Integration,”</span> <em>Journal of Statistical Software</em> 40, no. 8 (2011): 1–18, <a href="https://doi.org/10.18637/jss.v040.i08" role="doc-biblioref">https://doi.org/10.18637/jss.v040.i08</a>.<a href="rcpp.html#fnref117" class="footnote-back">↩︎</a></p></li>
<li id="fn118"><p>Scott Meyers, <em>Effective <span>C++</span>: 55 Specific Ways to Improve Your Programs and Designs</em> (Pearson Education, 2005), <a href="http://amzn.com/0321334876" role="doc-biblioref">http://amzn.com/0321334876</a>.<a href="rcpp.html#fnref118" class="footnote-back">↩︎</a></p></li>
<li id="fn119"><p>Scott Meyers, <em>Effective <span>STL</span>: 50 Specific Ways to Improve Your Use of the Standard Template Library</em> (Pearson Education, 2001), <a href="http://amzn.com/0201749629" role="doc-biblioref">http://amzn.com/0201749629</a>.<a href="rcpp.html#fnref119" class="footnote-back">↩︎</a></p></li>
<li id="fn120"><p>Steven S Skiena, <em>The Algorithm Design Manual</em> (Springer, 1998), <a href="http://amzn.com/0387948600" role="doc-biblioref">http://amzn.com/0387948600</a>.<a href="rcpp.html#fnref120" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="perf-improve.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Rcpp.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
